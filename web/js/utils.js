"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Preconditions_1 = require("polar-shared/src/Preconditions");
const Rects_1 = require("./Rects");
function injectScript(src, type) {
    let script = document.createElement('script');
    script.src = src;
    script.async = false;
    script.defer = false;
    if (type) {
        script.type = type;
    }
    return new Promise(function (resolve, reject) {
        document.head.appendChild(script);
        script.addEventListener('load', function () {
            resolve();
        });
        script.addEventListener('error', function (err) {
            reject(err);
        });
    });
}
exports.injectScript = injectScript;
class Delegator {
    constructor(delegates) {
        this.delegates = delegates;
    }
    apply(functionName, ...rest) {
        let args = Array.from(arguments);
        args.splice(0, 1);
        this.delegates.forEach(function (delegate) {
            let func = delegate[functionName];
            func.apply(delegate, args);
        });
    }
}
exports.Delegator = Delegator;
function forDict(dict, callback) {
    Preconditions_1.Preconditions.assertNotNull(dict, "dict");
    Preconditions_1.Preconditions.assertNotNull(callback, "callback");
    let keys = Object.keys(dict);
    keys.forEach(function (key) {
        let value = dict[key];
        callback(key, value);
    });
}
exports.forDict = forDict;
function getBoundingClientRectFromElements(elements) {
    let boundingClientRects = elements.map(current => current.getBoundingClientRect());
    return getBoundingClientRectFromBCRs(boundingClientRects);
}
exports.getBoundingClientRectFromElements = getBoundingClientRectFromElements;
;
function getBoundingClientRectFromBCRs(boundingClientRects) {
    let left = boundingClientRects.map((brc) => brc.left).reduce((a, b) => Math.min(a, b));
    let top = boundingClientRects.map((brc) => brc.top).reduce((a, b) => Math.min(a, b));
    let bottom = boundingClientRects.map((brc) => brc.bottom).reduce((a, b) => Math.max(a, b));
    let right = boundingClientRects.map((brc) => brc.right).reduce((a, b) => Math.max(a, b));
    return { left, top, bottom, right };
}
exports.getBoundingClientRectFromBCRs = getBoundingClientRectFromBCRs;
;
function elementOffset(element) {
    let result = {
        left: element.offsetLeft,
        top: element.offsetTop,
        width: element.offsetWidth,
        height: element.offsetHeight,
        right: 0,
        bottom: 0
    };
    result.right = result.left + result.width;
    result.bottom = result.top + result.height;
    return Rects_1.Rects.validate(result);
}
exports.elementOffset = elementOffset;
class OffsetCalculator {
    static calculate(element, rootElement) {
        let offset = { left: 0, top: 0, width: 0, height: 0, right: 0, bottom: 0 };
        while (true) {
            if (element == null)
                break;
            offset.left += this._toInt(element.offsetLeft);
            offset.top += this._toInt(element.offsetTop);
            offset.width = this._toInt(element.offsetWidth);
            offset.height = this._toInt(element.offsetHeight);
            if (element === rootElement)
                break;
            element = element.offsetParent;
        }
        offset.right = offset.left + offset.width;
        offset.bottom = offset.top + offset.height;
        return Rects_1.Rects.validate(offset);
    }
    static _toInt(value) {
        if (isNaN(value)) {
            return 0;
        }
        return value;
    }
}
exports.OffsetCalculator = OffsetCalculator;
class Styles {
    static parseTransformScaleX(transform) {
        let result = transform;
        if (!result)
            return null;
        result = result.replace("scaleX(", "");
        result = result.replace(")", "");
        return parseFloat(result);
    }
    static parsePixels(value) {
        value = value.replace("px", "");
        return parseInt(value);
    }
}
exports.Styles = Styles;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGtFQUErRDtBQUMvRCxtQ0FBZ0M7QUFFaEMsU0FBZ0IsWUFBWSxDQUFDLEdBQVcsRUFBRSxJQUFhO0lBRW5ELElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDOUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFJakIsTUFBTSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDckIsTUFBTSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFFckIsSUFBRyxJQUFJLEVBQUU7UUFDTCxNQUFNLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztLQUN0QjtJQUVELE9BQU8sSUFBSSxPQUFPLENBQUMsVUFBVSxPQUFPLEVBQUUsTUFBTTtRQUV4QyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVsQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFO1lBQzVCLE9BQU8sRUFBRSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVMsR0FBRztZQUN6QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQUM7SUFFUCxDQUFDLENBQUMsQ0FBQztBQUVQLENBQUM7QUE1QkQsb0NBNEJDO0FBTUQsTUFBYSxTQUFTO0lBSWxCLFlBQVksU0FBZ0I7UUFDeEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFDL0IsQ0FBQztJQUtNLEtBQUssQ0FBQyxZQUFvQixFQUFFLEdBQUcsSUFBVztRQUU3QyxJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FB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LE1BQU0sQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO1FBRTNDLE9BQU8sYUFBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUVsQyxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFVO1FBRXBCLElBQUssS0FBSyxDQUFFLEtBQUssQ0FBRSxFQUFHO1lBQ2xCLE9BQU8sQ0FBQyxDQUFDO1NBQ1o7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUVqQixDQUFDO0NBRUo7QUF6Q0QsNENBeUNDO0FBRUQsTUFBYSxNQUFNO0lBRWYsTUFBTSxDQUFDLG9CQUFvQixDQUFDLFNBQWM7UUFFdEMsSUFBSSxNQUFNLEdBQUcsU0FBUyxDQUFDO1FBRXZCLElBQUksQ0FBRSxNQUFNO1lBQ1IsT0FBTyxJQUFJLENBQUM7UUFFaEIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQyxPQUFPLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUU5QixDQUFDO0lBS0QsTUFBTSxDQUFDLFdBQVcsQ0FBQyxLQUFVO1FBRXpCLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNoQyxPQUFPLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUUzQixDQUFDO0NBRUo7QUExQkQsd0JBMEJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJlY29uZGl0aW9ucyB9IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL1ByZWNvbmRpdGlvbnNcIjtcbmltcG9ydCB7IFJlY3RzIH0gZnJvbSBcIi4vUmVjdHNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGluamVjdFNjcmlwdChzcmM6IHN0cmluZywgdHlwZT86IHN0cmluZykge1xuXG4gICAgbGV0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgIHNjcmlwdC5zcmMgPSBzcmM7XG5cbiAgICAvLyBsb2FkaW5nIGFzeW5jIGlzIHVnbHkgYnV0IHdlJ3JlIGdvaW5nIHRvIG1vdmUgdG8gd2VicGFjayBhbmQgY2xlYW4gdGhpc1xuICAgIC8vIHVwIGV2ZW50dWFsbHkuXG4gICAgc2NyaXB0LmFzeW5jID0gZmFsc2U7XG4gICAgc2NyaXB0LmRlZmVyID0gZmFsc2U7XG5cbiAgICBpZih0eXBlKSB7XG4gICAgICAgIHNjcmlwdC50eXBlID0gdHlwZTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcblxuICAgICAgICBzY3JpcHQuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzY3JpcHQuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9KTtcblxuICAgIH0pO1xuXG59XG5cbi8qKlxuICogQXBwbHkgYSBnaXZlbiBmdW5jdGlvbiwgd2l0aCBhcmd1bWVudHMsIHRvIGEgbGlzdCBvZiBkZWxlZ2F0ZXMgd2hpY2ggaGF2ZVxuICogdGhhdCBmdW5jdGlvbiBuYW1lIGRlZmluZWQuXG4gKi9cbmV4cG9ydCBjbGFzcyBEZWxlZ2F0b3Ige1xuXG4gICAgcHJpdmF0ZSBkZWxlZ2F0ZXM6IGFueVtdXG5cbiAgICBjb25zdHJ1Y3RvcihkZWxlZ2F0ZXM6IGFueVtdKSB7XG4gICAgICAgIHRoaXMuZGVsZWdhdGVzID0gZGVsZWdhdGVzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwcGx5IHRoZSBnaXZlbiBmdW5jdGlvbiB0byBhbGwgdGhlIGRlbGVnYXRlcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgYXBwbHkoZnVuY3Rpb25OYW1lOiBzdHJpbmcsIC4uLnJlc3Q6IGFueVtdKSB7XG5cbiAgICAgICAgbGV0IGFyZ3MgPSBBcnJheS5mcm9tKGFyZ3VtZW50cyk7XG4gICAgICAgIGFyZ3Muc3BsaWNlKDAsMSk7XG5cbiAgICAgICAgdGhpcy5kZWxlZ2F0ZXMuZm9yRWFjaChmdW5jdGlvbiAoZGVsZWdhdGUpIHtcbiAgICAgICAgICAgIGxldCBmdW5jID0gZGVsZWdhdGVbZnVuY3Rpb25OYW1lXTtcbiAgICAgICAgICAgIGZ1bmMuYXBwbHkoZGVsZWdhdGUsIGFyZ3MpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn1cblxuLy8gQERlcHJlY2F0ZWQgdXNlIEZ1bmN0aW9ucy5mb3JEaWN0XG5leHBvcnQgZnVuY3Rpb24gZm9yRGljdChkaWN0OiBhbnksIGNhbGxiYWNrOiBhbnkpIHtcblxuICAgIFByZWNvbmRpdGlvbnMuYXNzZXJ0Tm90TnVsbChkaWN0LCBcImRpY3RcIik7XG4gICAgUHJlY29uZGl0aW9ucy5hc3NlcnROb3ROdWxsKGNhbGxiYWNrLCBcImNhbGxiYWNrXCIpO1xuXG4gICAgLy8gZ2V0IHRoZSBrZXlzIGZpcnN0LCB0aGF0IHdheSB3ZSBjYW4gbXV0YXRlIHRoZSBkaWN0aW9uYXJ5IHdoaWxlIGl0ZXJhdGluZ1xuICAgIC8vIHRocm91Z2ggaXQgaWYgbmVjZXNzYXJ5LlxuICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMoZGljdCk7XG5cbiAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBsZXQgdmFsdWUgPSBkaWN0W2tleV07XG4gICAgICAgIGNhbGxiYWNrKGtleSx2YWx1ZSk7XG4gICAgfSlcblxufVxuXG4vKipcbiAqIEdldCB0aGUgYm91bmRpbmcgYm94IGZvciBhIGxpc3Qgb2YgZWxlbWVudHMsIG5vdCBqdXN0IG9uZS4gIFRoaXMgd291bGQgYmVcbiAqIHRoZSBtaW5pbXVtIGJvdW5kaW5nIGJveCBmb3IgYWxsIHRoZSBlbGVtZW50cy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEJvdW5kaW5nQ2xpZW50UmVjdEZyb21FbGVtZW50cyhlbGVtZW50czogYW55W10pIHtcblxuICAgIGxldCBib3VuZGluZ0NsaWVudFJlY3RzID0gZWxlbWVudHMubWFwKGN1cnJlbnQgPT4gY3VycmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7XG4gICAgcmV0dXJuIGdldEJvdW5kaW5nQ2xpZW50UmVjdEZyb21CQ1JzKGJvdW5kaW5nQ2xpZW50UmVjdHMpO1xuXG59O1xuXG4vKipcbiAqIEdldCB0aGUgYm91bmRpbmcgYm94IGZyb20gYSBsaXN0IG9mIEJDUnMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRCb3VuZGluZ0NsaWVudFJlY3RGcm9tQkNScyhib3VuZGluZ0NsaWVudFJlY3RzOiBhbnlbXSkge1xuXG4gICAgbGV0IGxlZnQgPSBib3VuZGluZ0NsaWVudFJlY3RzLm1hcCgoYnJjKSA9PiBicmMubGVmdCkucmVkdWNlKChhLGIpID0+IE1hdGgubWluKGEsYikpO1xuICAgIGxldCB0b3AgPSBib3VuZGluZ0NsaWVudFJlY3RzLm1hcCgoYnJjKSA9PiBicmMudG9wKS5yZWR1Y2UoKGEsYikgPT4gTWF0aC5taW4oYSxiKSk7XG4gICAgbGV0IGJvdHRvbSA9IGJvdW5kaW5nQ2xpZW50UmVjdHMubWFwKChicmMpID0+IGJyYy5ib3R0b20pLnJlZHVjZSgoYSxiKSA9PiBNYXRoLm1heChhLGIpKTtcbiAgICBsZXQgcmlnaHQgPSBib3VuZGluZ0NsaWVudFJlY3RzLm1hcCgoYnJjKSA9PiBicmMucmlnaHQpLnJlZHVjZSgoYSxiKSA9PiBNYXRoLm1heChhLGIpKTtcblxuICAgIHJldHVybiB7bGVmdCwgdG9wLCBib3R0b20sIHJpZ2h0fTtcblxufTtcblxuLyoqXG4gKiBARGVwcmVjYXRlZCB1c2UgRWxlbWVudHMub2Zmc2V0IGluc3RlYWQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbGVtZW50T2Zmc2V0KGVsZW1lbnQ6IGFueSkge1xuXG4gICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgbGVmdDogZWxlbWVudC5vZmZzZXRMZWZ0LFxuICAgICAgICB0b3A6IGVsZW1lbnQub2Zmc2V0VG9wLFxuICAgICAgICB3aWR0aDogZWxlbWVudC5vZmZzZXRXaWR0aCxcbiAgICAgICAgaGVpZ2h0OiBlbGVtZW50Lm9mZnNldEhlaWdodCxcbiAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgIGJvdHRvbTogMFxuICAgIH07XG5cbiAgICByZXN1bHQucmlnaHQgPSByZXN1bHQubGVmdCArIHJlc3VsdC53aWR0aDtcbiAgICByZXN1bHQuYm90dG9tID0gcmVzdWx0LnRvcCArIHJlc3VsdC5oZWlnaHQ7XG5cbiAgICByZXR1cm4gUmVjdHMudmFsaWRhdGUocmVzdWx0KTtcblxufVxuXG4vKipcbiAqIFN1cHBvcnQgdGhlIGFiaWxpdHkgdG8gY2FsY3VsYXRlIGFuIG9mZnNldCByZWxhdGl2ZSB0byBhbm90aGVyIGVsZW1lbnQuXG4gKi9cbmV4cG9ydCBjbGFzcyBPZmZzZXRDYWxjdWxhdG9ye1xuXG4gICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTU5ODc0My9maW5kaW5nLWVsZW1lbnRzLXBvc2l0aW9uLXJlbGF0aXZlLXRvLXRoZS1kb2N1bWVudFxuICAgIHN0YXRpYyBjYWxjdWxhdGUoZWxlbWVudDogYW55LCByb290RWxlbWVudDogYW55KSB7XG5cbiAgICAgICAgbGV0IG9mZnNldCA9IHtsZWZ0OiAwLCB0b3A6IDAsIHdpZHRoOiAwLCBoZWlnaHQ6IDAsIHJpZ2h0OiAwLCBib3R0b206IDB9O1xuXG4gICAgICAgIHdoaWxlKHRydWUpIHtcblxuICAgICAgICAgICAgaWYoZWxlbWVudCA9PSBudWxsKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBvZmZzZXQubGVmdCArPSB0aGlzLl90b0ludChlbGVtZW50Lm9mZnNldExlZnQpO1xuICAgICAgICAgICAgb2Zmc2V0LnRvcCArPSB0aGlzLl90b0ludChlbGVtZW50Lm9mZnNldFRvcCk7XG4gICAgICAgICAgICBvZmZzZXQud2lkdGggPSB0aGlzLl90b0ludChlbGVtZW50Lm9mZnNldFdpZHRoKTtcbiAgICAgICAgICAgIG9mZnNldC5oZWlnaHQgPSB0aGlzLl90b0ludChlbGVtZW50Lm9mZnNldEhlaWdodCk7XG5cbiAgICAgICAgICAgIGlmKGVsZW1lbnQgPT09IHJvb3RFbGVtZW50KVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIG9mZnNldC5yaWdodCA9IG9mZnNldC5sZWZ0ICsgb2Zmc2V0LndpZHRoO1xuICAgICAgICBvZmZzZXQuYm90dG9tID0gb2Zmc2V0LnRvcCArIG9mZnNldC5oZWlnaHQ7XG5cbiAgICAgICAgcmV0dXJuIFJlY3RzLnZhbGlkYXRlKG9mZnNldCk7XG5cbiAgICB9XG5cbiAgICBzdGF0aWMgX3RvSW50KHZhbHVlOiBhbnkpIHtcblxuICAgICAgICBpZiAoIGlzTmFOKCB2YWx1ZSApICkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsdWU7XG5cbiAgICB9XG5cbn1cblxuZXhwb3J0IGNsYXNzIFN0eWxlcyB7XG5cbiAgICBzdGF0aWMgcGFyc2VUcmFuc2Zvcm1TY2FsZVgodHJhbnNmb3JtOiBhbnkpIHtcblxuICAgICAgICBsZXQgcmVzdWx0ID0gdHJhbnNmb3JtO1xuXG4gICAgICAgIGlmKCAhIHJlc3VsdClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKFwic2NhbGVYKFwiLCBcIlwiKTtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoXCIpXCIsIFwiXCIpO1xuXG4gICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHJlc3VsdCk7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUYWtlIGEgc3RyaW5nIG9mICc1MHB4JyBhbmQgcmV0dXJuIGEgbnVtYmVyIG9mIGp1c3QgdGhlIHBpeGVsIGNvdW50LlxuICAgICAqL1xuICAgIHN0YXRpYyBwYXJzZVBpeGVscyh2YWx1ZTogYW55KSB7XG5cbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKFwicHhcIiwgXCJcIik7XG4gICAgICAgIHJldHVybiBwYXJzZUludCh2YWx1ZSk7XG5cbiAgICB9XG5cbn1cbiJdfQ==