"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Logger_1 = require("polar-shared/src/logger/Logger");
const Optional_1 = require("polar-shared/src/util/ts/Optional");
const ID = 'polar-determinate-progress-bar';
const log = Logger_1.Logger.create();
const FAST_PROGRESS_CUTOFF = 300;
class DeterminateProgressBar {
    static update(value) {
        const progress = typeof value === 'number' ? value : value.progress;
        if (!progress || progress < 0 || progress > 100) {
            return;
        }
        if (!(typeof value === 'number')) {
            if (value.duration < FAST_PROGRESS_CUTOFF && progress < 100) {
                return;
            }
        }
        if (progress === 100 && !this.get().isPresent()) {
            return;
        }
        const progressElement = this.getOrCreate();
        progressElement.value = progress;
        if (progress >= 100) {
            this.destroy();
        }
    }
    static destroy() {
        const timeout = 350;
        const doDestroy = () => {
            const progressElement = this.get().getOrUndefined();
            if (progressElement) {
                if (progressElement.parentElement !== null) {
                    progressElement.parentElement.removeChild(progressElement);
                }
                else {
                    log.warn("No parent element for progress bar.");
                }
            }
            else {
            }
        };
        setTimeout(() => {
            const progressElement = this.get();
            if (!progressElement.isPresent() || progressElement.get().value !== 100) {
                return;
            }
            doDestroy();
        }, timeout);
    }
    static getOrCreate() {
        const result = this.get();
        if (result.isPresent()) {
            return result.get();
        }
        return this.create();
    }
    static get() {
        const element = document.getElementById(ID);
        return Optional_1.Optional.of(element);
    }
    static create() {
        const element = document.createElement('progress');
        element.value = 0;
        element.max = 100;
        element.id = ID;
        element.style.height = '4px';
        element.style.width = `100%`;
        element.style.position = 'fixed';
        element.style.top = '0';
        element.style.left = '0';
        element.style.zIndex = '99999999999';
        element.style.borderTop = '0';
        element.style.borderLeft = '0';
        element.style.borderRight = '0';
        element.style.borderBottom = '0';
        document.body.appendChild(element);
        return element;
    }
}
exports.DeterminateProgressBar = DeterminateProgressBar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGV0ZXJtaW5hdGVQcm9ncmVzc0Jhci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkRldGVybWluYXRlUHJvZ3Jlc3NCYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSwyREFBc0Q7QUFDdEQsZ0VBQTJEO0FBRzNELE1BQU0sRUFBRSxHQUFHLGdDQUFnQyxDQUFDO0FBRTVDLE1BQU0sR0FBRyxHQUFHLGVBQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUU1QixNQUFNLG9CQUFvQixHQUFHLEdBQUcsQ0FBQztBQU9qQyxNQUFhLHNCQUFzQjtJQUd4QixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQXdCO1FBRXpDLE1BQU0sUUFBUSxHQUNWLE9BQU8sS0FBSyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1FBRXZELElBQUksQ0FBRSxRQUFRLElBQUksUUFBUSxHQUFHLENBQUMsSUFBSSxRQUFRLEdBQUcsR0FBRyxFQUFFO1lBRTlDLE9BQU87U0FDVjtRQUVELElBQUksQ0FBRSxDQUFDLE9BQU8sS0FBSyxLQUFLLFFBQVEsQ0FBQyxFQUFFO1lBRS9CLElBQUksS0FBSyxDQUFDLFFBQVEsR0FBRyxvQkFBb0IsSUFBSSxRQUFRLEdBQUcsR0FBRyxFQUFFO2dCQUN6RCxPQUFPO2FBQ1Y7U0FFSjtRQUVELElBQUksUUFBUSxLQUFLLEdBQUcsSUFBSSxDQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQU05QyxPQUFPO1NBQ1Y7UUFFRCxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0MsZUFBZSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUM7UUFFakMsSUFBSSxRQUFRLElBQUksR0FBRyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUNsQjtJQUVMLENBQUM7SUFFTyxNQUFNLENBQUMsT0FBTztRQUVsQixNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUM7UUFFcEIsTUFBTSxTQUFTLEdBQUcsR0FBRyxFQUFFO1lBRW5CLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUVwRCxJQUFJLGVBQWUsRUFBRTtnQkFFakIsSUFBSSxlQUFlLENBQUMsYUFBYSxLQUFLLElBQUksRUFBRTtvQkFDeEMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUM7aUJBQzlEO3FCQUFNO29CQUNILEdBQUcsQ0FBQyxJQUFJLENBQUMscUNBQXFDLENBQUMsQ0FBQztpQkFDbkQ7YUFFSjtpQkFBTTthQUVOO1FBRUwsQ0FBQyxDQUFDO1FBRUYsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUVaLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVuQyxJQUFJLENBQUUsZUFBZSxDQUFDLFNBQVMsRUFBRSxJQUFJLGVBQWUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFLLEtBQUssR0FBRyxFQUFFO2dCQUN0RSxPQUFPO2FBQ1Y7WUFFRCxTQUFTLEVBQUUsQ0FBQztRQUVoQixDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFFaEIsQ0FBQztJQUVPLE1BQU0sQ0FBQyxXQUFXO1FBRXRCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUUxQixJQUFJLE1BQU0sQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUNwQixPQUFPLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztTQUN2QjtRQUVELE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBRXpCLENBQUM7SUFFTyxNQUFNLENBQUMsR0FBRztRQUNkLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDNUMsT0FBTyxtQkFBUSxDQUFDLEVBQUUsQ0FBdUIsT0FBTyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVPLE1BQU0sQ0FBQyxNQUFNO1FBRWpCLE1BQU0sT0FBTyxHQUF3QixRQUFRLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXhFLE9BQU8sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLE9BQU8sQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO1FBRWxCLE9BQU8sQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBRWhCLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUU3QixPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUM7UUFJN0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDO1FBQ2pDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUN4QixPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7UUFDekIsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsYUFBYSxDQUFDO1FBQ3JDLE9BQU8sQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztRQUM5QixPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUM7UUFDL0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDO1FBQ2hDLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQztRQUlqQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVuQyxPQUFPLE9BQU8sQ0FBQztJQUVuQixDQUFDO0NBRUo7QUE1SEQsd0RBNEhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtQcm9ncmVzc30gZnJvbSAncG9sYXItc2hhcmVkL3NyYy91dGlsL1Byb2dyZXNzVHJhY2tlcic7XG5pbXBvcnQge0xvZ2dlcn0gZnJvbSAncG9sYXItc2hhcmVkL3NyYy9sb2dnZXIvTG9nZ2VyJztcbmltcG9ydCB7T3B0aW9uYWx9IGZyb20gJ3BvbGFyLXNoYXJlZC9zcmMvdXRpbC90cy9PcHRpb25hbCc7XG5pbXBvcnQge1ByZWNvbmRpdGlvbnN9IGZyb20gJ3BvbGFyLXNoYXJlZC9zcmMvUHJlY29uZGl0aW9ucyc7XG5cbmNvbnN0IElEID0gJ3BvbGFyLWRldGVybWluYXRlLXByb2dyZXNzLWJhcic7XG5cbmNvbnN0IGxvZyA9IExvZ2dlci5jcmVhdGUoKTtcblxuY29uc3QgRkFTVF9QUk9HUkVTU19DVVRPRkYgPSAzMDA7XG5cbi8qKlxuICogU2ltcGxlIHByb2dyZXNzIGJhciB0aGF0IHdlIGNhbiBkaXNwbGF5IGF0IGFueSB0aW1lIG9uIGEgcGFnZSB3aXRob3V0XG4gKiBjb21wbGljYXRlZCByZW5kZXJpbmcgaXNzdWVzIG9yIHJlcXVpcmluZyBSZWFjdCB0byBiZSB1c2VkLiAgVGhpcyBhbGxvd3NcbiAqIHVzIHRvIGVhc2lseSBzaG93IGEgR1VJIGZvciBhIGRvd25sb2FkIGF0IGFueSBwb2ludCBpbiB0aW1lLlxuICovXG5leHBvcnQgY2xhc3MgRGV0ZXJtaW5hdGVQcm9ncmVzc0JhciB7XG5cbiAgICAvLyBUT0RPOiB3ZSBhY2NlcHQgYSBwcm9ncmVzcyBvYmplY3QgdG9vXG4gICAgcHVibGljIHN0YXRpYyB1cGRhdGUodmFsdWU6IG51bWJlciB8IFByb2dyZXNzKSB7XG5cbiAgICAgICAgY29uc3QgcHJvZ3Jlc3M6IG51bWJlciA9XG4gICAgICAgICAgICB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInID8gdmFsdWUgOiB2YWx1ZS5wcm9ncmVzcztcblxuICAgICAgICBpZiAoISBwcm9ncmVzcyB8fCBwcm9ncmVzcyA8IDAgfHwgcHJvZ3Jlc3MgPiAxMDApIHtcbiAgICAgICAgICAgIC8vIHRoaXMgaXMgYW4gaW52YWxpZCB2YWx1ZS4uLlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCEgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpKSB7XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZS5kdXJhdGlvbiA8IEZBU1RfUFJPR1JFU1NfQ1VUT0ZGICYmIHByb2dyZXNzIDwgMTAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHJvZ3Jlc3MgPT09IDEwMCAmJiAhIHRoaXMuZ2V0KCkuaXNQcmVzZW50KCkpIHtcbiAgICAgICAgICAgIC8vIHRoZXJlJ3Mgbm90aGluZyB0aGF0IG5lZWRzIHRvIGJlIGFjdHVhbGx5IGRvbmUgaGVyZS4gIFdlJ3ZlIGJlZW5cbiAgICAgICAgICAgIC8vIHRvbGQgc29tZXRoaW5nIHdhcyBjb21wbGV0ZWQgYnV0IHdlIG5ldmVyIGFjdHVhbGx5IGxvZ2dlZCB0aGF0XG4gICAgICAgICAgICAvLyBpdCB3YXMgcHJvY2Vzc2luZyB3aGljaCBtaWdodCBoYXBwZW4gc29tZXRpbWVzIGlmIHdlJ3JlIGdpdmVuXG4gICAgICAgICAgICAvLyB0aGUgbGFzdCBqb2IuICBFaXRoZXIgd2F5IGV2ZW4gaWYgaXQncyBhIHByb2dyYW1tZXJzIGVycm9yIHRoZXJlXG4gICAgICAgICAgICAvLyBpcyBubyBuZWVkIHRvIHVwZGF0ZSB0aGUgVUkgaGVyZS5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHByb2dyZXNzRWxlbWVudCA9IHRoaXMuZ2V0T3JDcmVhdGUoKTtcbiAgICAgICAgcHJvZ3Jlc3NFbGVtZW50LnZhbHVlID0gcHJvZ3Jlc3M7XG5cbiAgICAgICAgaWYgKHByb2dyZXNzID49IDEwMCkge1xuICAgICAgICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGRlc3Ryb3koKSB7XG5cbiAgICAgICAgY29uc3QgdGltZW91dCA9IDM1MDtcblxuICAgICAgICBjb25zdCBkb0Rlc3Ryb3kgPSAoKSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzRWxlbWVudCA9IHRoaXMuZ2V0KCkuZ2V0T3JVbmRlZmluZWQoKTtcblxuICAgICAgICAgICAgaWYgKHByb2dyZXNzRWxlbWVudCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzRWxlbWVudC5wYXJlbnRFbGVtZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2dyZXNzRWxlbWVudC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHByb2dyZXNzRWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oXCJObyBwYXJlbnQgZWxlbWVudCBmb3IgcHJvZ3Jlc3MgYmFyLlwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gbG9nLndhcm4oXCJObyBwcm9ncmVzcyBiYXIgdG8gZGVzdHJveS5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcblxuICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3NFbGVtZW50ID0gdGhpcy5nZXQoKTtcblxuICAgICAgICAgICAgaWYgKCEgcHJvZ3Jlc3NFbGVtZW50LmlzUHJlc2VudCgpIHx8IHByb2dyZXNzRWxlbWVudC5nZXQoKS52YWx1ZSAhPT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkb0Rlc3Ryb3koKTtcblxuICAgICAgICB9LCB0aW1lb3V0KTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGdldE9yQ3JlYXRlKCkge1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZ2V0KCk7XG5cbiAgICAgICAgaWYgKHJlc3VsdC5pc1ByZXNlbnQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZSgpO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZ2V0KCk6IE9wdGlvbmFsPEhUTUxQcm9ncmVzc0VsZW1lbnQ+IHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKElEKTtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm9mKDxIVE1MUHJvZ3Jlc3NFbGVtZW50PiBlbGVtZW50KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBjcmVhdGUoKTogSFRNTFByb2dyZXNzRWxlbWVudCB7XG5cbiAgICAgICAgY29uc3QgZWxlbWVudDogSFRNTFByb2dyZXNzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Byb2dyZXNzJyk7XG5cbiAgICAgICAgZWxlbWVudC52YWx1ZSA9IDA7XG4gICAgICAgIGVsZW1lbnQubWF4ID0gMTAwO1xuXG4gICAgICAgIGVsZW1lbnQuaWQgPSBJRDtcblxuICAgICAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9ICc0cHgnO1xuXG4gICAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSBgMTAwJWA7XG5cbiAgICAgICAgLy8vIHByb2dyZXNzLnN0eWxlLmJhY2tncm91bmRDb2xvcj0nIzg5QURGRCc7XG4gICAgICAgIC8vIHByb2dyZXNzLnN0eWxlLmNvbG9yPScjODlBREZEJztcbiAgICAgICAgZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUudG9wID0gJzAnO1xuICAgICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSAnMCc7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUuekluZGV4ID0gJzk5OTk5OTk5OTk5JztcbiAgICAgICAgZWxlbWVudC5zdHlsZS5ib3JkZXJUb3AgPSAnMCc7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUuYm9yZGVyTGVmdCA9ICcwJztcbiAgICAgICAgZWxlbWVudC5zdHlsZS5ib3JkZXJSaWdodCA9ICcwJztcbiAgICAgICAgZWxlbWVudC5zdHlsZS5ib3JkZXJCb3R0b20gPSAnMCc7XG4gICAgICAgIC8vIGVsZW1lbnQuc3R5bGUud2Via2l0QXBwZWFyYW5jZSA9ICdub25lJztcbiAgICAgICAgLy8gZWxlbWVudC5zdHlsZS5ib3JkZXJSYWRpdXMgPSAnMCc7XG5cbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTtcblxuICAgICAgICByZXR1cm4gZWxlbWVudDtcblxuICAgIH1cblxufVxuXG4iXX0=