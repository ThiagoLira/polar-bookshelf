"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const React = __importStar(require("react"));
const SplashLifecycle_1 = require("../../../../apps/repository/js/splash2/SplashLifecycle");
const LifecycleEvents_1 = require("../util/LifecycleEvents");
const LocalPrefs_1 = require("../../util/LocalPrefs");
const RendererAnalytics_1 = require("../../ga/RendererAnalytics");
const Logger_1 = require("polar-shared/src/logger/Logger");
const Numbers_1 = require("polar-shared/src/util/Numbers");
const log = Logger_1.Logger.create();
class PrioritizedComponentManager extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        const NullComponent = () => {
            return (React.createElement("div", null));
        };
        if (!LocalPrefs_1.LocalPrefs.isMarked(LifecycleEvents_1.LifecycleEvents.TOUR_TERMINATED)) {
            return React.createElement(NullComponent, null);
        }
        const datastoreOverview = this.props.datastoreOverview;
        const canShow = SplashLifecycle_1.SplashLifecycle.canShow();
        const sorted = [...this.props.prioritizedComponentRefs]
            .filter(current => current.priority(datastoreOverview) !== undefined)
            .sort((o1, o2) => Numbers_1.Numbers.compare(o1.priority(datastoreOverview), o2.priority(datastoreOverview)) * -1);
        log.debug("Remaining prioritized splashes: ", sorted);
        if (sorted.length === 0 || document.location.hash !== '') {
            return React.createElement(NullComponent, null);
        }
        const prioritizedComponentRef = sorted[0];
        SplashLifecycle_1.SplashLifecycle.markShown();
        RendererAnalytics_1.RendererAnalytics.event({ category: 'splashes', action: 'shown' });
        RendererAnalytics_1.RendererAnalytics.event({ category: 'splashes-shown', action: prioritizedComponentRef.id });
        return prioritizedComponentRef.create();
    }
}
exports.PrioritizedComponentManager = PrioritizedComponentManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJpb3JpdGl6ZWRDb21wb25lbnRNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiUHJpb3JpdGl6ZWRDb21wb25lbnRNYW5hZ2VyLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSw2Q0FBK0I7QUFDL0IsNEZBQXVGO0FBQ3ZGLDZEQUF3RDtBQUN4RCxzREFBaUQ7QUFDakQsa0VBQTZEO0FBRTdELDJEQUFzRDtBQUN0RCwyREFBc0Q7QUFFdEQsTUFBTSxHQUFHLEdBQUcsZUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRTVCLE1BQWEsMkJBQTRCLFNBQVEsS0FBSyxDQUFDLFNBQXlCO0lBRTVFLFlBQVksS0FBYTtRQUNyQixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFakIsQ0FBQztJQUVNLE1BQU07UUFFVCxNQUFNLGFBQWEsR0FBRyxHQUFHLEVBQUU7WUFDdkIsT0FBTyxDQUFDLGdDQUFXLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUM7UUFFRixJQUFJLENBQUUsdUJBQVUsQ0FBQyxRQUFRLENBQUMsaUNBQWUsQ0FBQyxlQUFlLENBQUMsRUFBRTtZQUV4RCxPQUFPLG9CQUFDLGFBQWEsT0FBRSxDQUFDO1NBQzNCO1FBRUQsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDO1FBRXZELE1BQU0sT0FBTyxHQUFHLGlDQUFlLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFMUMsTUFBTSxNQUFNLEdBQ1IsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsd0JBQXdCLENBQUM7YUFDbkMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLFNBQVMsQ0FBQzthQUNwRSxJQUFJLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxpQkFBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVoSCxHQUFHLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxFQUFHLE1BQU0sQ0FBQyxDQUFDO1FBRXZELElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksUUFBUSxDQUFDLFFBQVMsQ0FBQyxJQUFJLEtBQUssRUFBRSxFQUFFO1lBS3ZELE9BQU8sb0JBQUMsYUFBYSxPQUFFLENBQUM7U0FDM0I7UUFFRCxNQUFNLHVCQUF1QixHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUcxQyxpQ0FBZSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBRTVCLHFDQUFpQixDQUFDLEtBQUssQ0FBQyxFQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7UUFFakUscUNBQWlCLENBQUMsS0FBSyxDQUFDLEVBQUMsUUFBUSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sRUFBRSx1QkFBdUIsQ0FBQyxFQUFFLEVBQUMsQ0FBQyxDQUFDO1FBRzFGLE9BQU8sdUJBQXVCLENBQUMsTUFBTSxFQUFFLENBQUM7SUFFNUMsQ0FBQztDQUVKO0FBbkRELGtFQW1EQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7U3BsYXNoTGlmZWN5Y2xlfSBmcm9tICcuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvc3BsYXNoMi9TcGxhc2hMaWZlY3ljbGUnO1xuaW1wb3J0IHtMaWZlY3ljbGVFdmVudHN9IGZyb20gJy4uL3V0aWwvTGlmZWN5Y2xlRXZlbnRzJztcbmltcG9ydCB7TG9jYWxQcmVmc30gZnJvbSAnLi4vLi4vdXRpbC9Mb2NhbFByZWZzJztcbmltcG9ydCB7UmVuZGVyZXJBbmFseXRpY3N9IGZyb20gJy4uLy4uL2dhL1JlbmRlcmVyQW5hbHl0aWNzJztcbmltcG9ydCB7RGF0YXN0b3JlT3ZlcnZpZXd9IGZyb20gJy4uLy4uL2RhdGFzdG9yZS9EYXRhc3RvcmUnO1xuaW1wb3J0IHtMb2dnZXJ9IGZyb20gJ3BvbGFyLXNoYXJlZC9zcmMvbG9nZ2VyL0xvZ2dlcic7XG5pbXBvcnQge051bWJlcnN9IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL3V0aWwvTnVtYmVyc1wiO1xuXG5jb25zdCBsb2cgPSBMb2dnZXIuY3JlYXRlKCk7XG5cbmV4cG9ydCBjbGFzcyBQcmlvcml0aXplZENvbXBvbmVudE1hbmFnZXIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlcigpIHtcblxuICAgICAgICBjb25zdCBOdWxsQ29tcG9uZW50ID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICg8ZGl2PjwvZGl2Pik7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCEgTG9jYWxQcmVmcy5pc01hcmtlZChMaWZlY3ljbGVFdmVudHMuVE9VUl9URVJNSU5BVEVEKSkge1xuICAgICAgICAgICAgLy8gbm8gc3BsYXNoZXMgdW5sZXNzIHdlIGhhdmUgdGhlIHRvdXIuXG4gICAgICAgICAgICByZXR1cm4gPE51bGxDb21wb25lbnQvPjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRhdGFzdG9yZU92ZXJ2aWV3ID0gdGhpcy5wcm9wcy5kYXRhc3RvcmVPdmVydmlldztcblxuICAgICAgICBjb25zdCBjYW5TaG93ID0gU3BsYXNoTGlmZWN5Y2xlLmNhblNob3coKTtcblxuICAgICAgICBjb25zdCBzb3J0ZWQgPVxuICAgICAgICAgICAgWy4uLnRoaXMucHJvcHMucHJpb3JpdGl6ZWRDb21wb25lbnRSZWZzXVxuICAgICAgICAgICAgICAgIC5maWx0ZXIoY3VycmVudCA9PiBjdXJyZW50LnByaW9yaXR5KGRhdGFzdG9yZU92ZXJ2aWV3KSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgIC5zb3J0KChvMSwgbzIpID0+IE51bWJlcnMuY29tcGFyZShvMS5wcmlvcml0eShkYXRhc3RvcmVPdmVydmlldyksIG8yLnByaW9yaXR5KGRhdGFzdG9yZU92ZXJ2aWV3KSkgKiAtMSk7XG5cbiAgICAgICAgbG9nLmRlYnVnKFwiUmVtYWluaW5nIHByaW9yaXRpemVkIHNwbGFzaGVzOiBcIiAsIHNvcnRlZCk7XG5cbiAgICAgICAgaWYgKHNvcnRlZC5sZW5ndGggPT09IDAgfHwgZG9jdW1lbnQubG9jYXRpb24hLmhhc2ggIT09ICcnKSB7XG4gICAgICAgICAgICAvLyByZXR1cm4gYW4gZW1wdHkgZGl2IGlmIHdlIGhhdmUgbm8gc3BsYXNoZXMgT1IgaWYgd2UgaGF2ZSBhXG4gICAgICAgICAgICAvLyBzcGVjaWZpYyBoYXNoIFVSTCB0byBsb2FkLiAgVGhlIHNwbGFzaGVzIHNob3VsZCBvbmx5IGdvIG9uIHRoZVxuICAgICAgICAgICAgLy8gaG9tZSBwYWdlIG9uIGxvYWQuXG5cbiAgICAgICAgICAgIHJldHVybiA8TnVsbENvbXBvbmVudC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcHJpb3JpdGl6ZWRDb21wb25lbnRSZWYgPSBzb3J0ZWRbMF07XG5cbiAgICAgICAgLy8gbWFyayB0aGlzIGFzIHNob3duIHNvIHRoYXQgd2UgZGVsYXkgdGhlIG5leHQgc3BsYXNoLCBldmVuIG9uIHJlZnJlc2hcbiAgICAgICAgU3BsYXNoTGlmZWN5Y2xlLm1hcmtTaG93bigpO1xuXG4gICAgICAgIFJlbmRlcmVyQW5hbHl0aWNzLmV2ZW50KHtjYXRlZ29yeTogJ3NwbGFzaGVzJywgYWN0aW9uOiAnc2hvd24nfSk7XG5cbiAgICAgICAgUmVuZGVyZXJBbmFseXRpY3MuZXZlbnQoe2NhdGVnb3J5OiAnc3BsYXNoZXMtc2hvd24nLCBhY3Rpb246IHByaW9yaXRpemVkQ29tcG9uZW50UmVmLmlkfSk7XG5cbiAgICAgICAgLy8gcmV0dXJuIHRoZSB0b3AgcmFua2luZyBlbGVtZW50LlxuICAgICAgICByZXR1cm4gcHJpb3JpdGl6ZWRDb21wb25lbnRSZWYuY3JlYXRlKCk7XG5cbiAgICB9XG5cbn1cblxuLyoqXG4gKiBBbGxvd3MgdXMgdG8gZ2l2ZSBhIHNldCBvciBjb21wb25lbnRzIHRvIHRoZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFByaW9yaXRpemVkQ29tcG9uZW50IHtcblxuICAgIC8qKlxuICAgICAqIEFsbG93cyB0aGUgY29tcG9uZW50IHRvIGRldGVybWluZSBpdHMgcHJpb3JpdHkuICBUaGlzIGNvdWxkIGJlIHVzZWRcbiAgICAgKiB0byBzZWUgaWYgaXQgbmVlZHMgdG8gcG9wdXAgbm93IG9yIGp1c3Qgc29tZSBzb3J0IG9mIHN0YXRpYyBwcmlvcml0eS5cbiAgICAgKlxuICAgICAqIFJldHVybiB1bmRlZmluZWQgaWYgdGhlIGNvbXBvbmVudCBzaG91bGQgbm90IGJlIGRpc3BsYXllZC4gIFRoaXMgY2FuIGJlXG4gICAgICogdXNlZCBpZiB0aGUgdXNlciBoYXMgYWxyZWFkeSBwZXJmb3JtZWQgYSBnaXZlbiBhY3Rpb24uXG4gICAgICovXG4gICAgcHJpb3JpdHkoKTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJpb3JpdGl6ZWRDb21wb25lbnRSZWYge1xuXG4gICAgaWQ6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEFsbG93cyB0aGUgY29tcG9uZW50IHRvIGRldGVybWluZSBpdHMgcHJpb3JpdHkuICBUaGlzIGNvdWxkIGJlIHVzZWRcbiAgICAgKiB0byBzZWUgaWYgaXQgbmVlZHMgdG8gcG9wdXAgbm93IG9yIGp1c3Qgc29tZSBzb3J0IG9mIHN0YXRpYyBwcmlvcml0eS5cbiAgICAgKlxuICAgICAqIFJldHVybiB1bmRlZmluZWQgaWYgdGhlIGNvbXBvbmVudCBzaG91bGQgbm90IGJlIGRpc3BsYXllZC4gIFRoaXMgY2FuIGJlXG4gICAgICogdXNlZCBpZiB0aGUgdXNlciBoYXMgYWxyZWFkeSBwZXJmb3JtZWQgYSBnaXZlbiBhY3Rpb24uXG4gICAgICovXG4gICAgcHJpb3JpdHkoZGF0YXN0b3JlT3ZlcnZpZXc6IERhdGFzdG9yZU92ZXJ2aWV3KTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSBjb21wb25lbnQgd2hlbiB3ZSdyZSByZWFkeSBmb3IgaXQuXG4gICAgICovXG4gICAgY3JlYXRlKCk6IEpTWC5FbGVtZW50O1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVByb3BzIHtcblxuICAgIHJlYWRvbmx5IHByaW9yaXRpemVkQ29tcG9uZW50UmVmczogUmVhZG9ubHlBcnJheTxQcmlvcml0aXplZENvbXBvbmVudFJlZj47XG5cbiAgICByZWFkb25seSBkYXRhc3RvcmVPdmVydmlldzogRGF0YXN0b3JlT3ZlcnZpZXc7XG5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJU3RhdGUge1xuXG59XG5cbiJdfQ==