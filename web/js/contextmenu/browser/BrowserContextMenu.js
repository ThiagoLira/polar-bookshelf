"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const react_context_menu_wrapper_1 = require("@burtonator/react-context-menu-wrapper");
const React = __importStar(require("react"));
const ContextMenu_1 = require("../../ui/context_menu/ContextMenu");
const react_dropdown_1 = require("@burtonator/react-dropdown");
const ContextMenuMessages_1 = require("../ContextMenuMessages");
const ContextMenuType_1 = require("../ContextMenuType");
const AnnotationSidebarClient_1 = require("../../annotation_sidebar/AnnotationSidebarClient");
const PagemarkModes_1 = require("../../metadata/PagemarkModes");
class BrowserContextMenu extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            selectionContexts: {
                page: false,
                areaHighlight: false,
                textHighlight: false,
                pagemark: false
            }
        };
        const id = this.props.id;
        react_context_menu_wrapper_1.addContextMenuEventListener(id, (eventName, data) => {
            const triggerEvent = data;
            const state = Object.assign(Object.assign({}, this.state), { triggerEvent });
            if (triggerEvent) {
                state.selectionContexts.page = triggerEvent.contextMenuTypes.includes(ContextMenuType_1.ContextMenuType.PAGE);
                state.selectionContexts.textHighlight = triggerEvent.contextMenuTypes.includes(ContextMenuType_1.ContextMenuType.TEXT_HIGHLIGHT);
                state.selectionContexts.areaHighlight = triggerEvent.contextMenuTypes.includes(ContextMenuType_1.ContextMenuType.AREA_HIGHLIGHT);
                state.selectionContexts.pagemark = triggerEvent.contextMenuTypes.includes(ContextMenuType_1.ContextMenuType.PAGEMARK);
            }
            this.setState(state);
        });
    }
    render() {
        const triggerEvent = this.state.triggerEvent;
        const CreateModeSubmenuItems = () => {
            return React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.pagemark },
                "Pagemark",
                React.createElement(react_dropdown_1.MenuItem, null,
                    "Set Mode",
                    PagemarkModes_1.PagemarkModes.toDescriptors().map(current => {
                        return (React.createElement(react_dropdown_1.MenuItem, { key: current.key, hidden: !this.state.selectionContexts.pagemark, onSelect: () => ContextMenuMessages_1.ContextMenuMessages.postContextMenuMessage("set-pagemark-mode-" + current.key, triggerEvent) }, current.title));
                    })),
                React.createElement(react_dropdown_1.MenuItem, { divider: true }),
                React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.pagemark, onSelect: () => ContextMenuMessages_1.ContextMenuMessages.postContextMenuMessage("delete-pagemark", triggerEvent) },
                    React.createElement("div", { className: "text-danger" }, "Delete")));
        };
        return (React.createElement(ContextMenu_1.ContextMenu, { id: this.props.id },
            React.createElement(react_dropdown_1.DropdownMenu, null,
                React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.page, onSelect: () => ContextMenuMessages_1.ContextMenuMessages.postContextMenuMessage("create-pagemark-to-point", triggerEvent) }, "Create Pagemark to Point"),
                React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.page, onSelect: () => ContextMenuMessages_1.ContextMenuMessages.postContextMenuMessage("create-pagemark", triggerEvent) }, "Create Pagemark Box"),
                React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.page, onSelect: () => ContextMenuMessages_1.ContextMenuMessages.postContextMenuMessage("create-area-highlight", triggerEvent) }, "Create Area Highlight"),
                React.createElement(react_dropdown_1.MenuItem, { divider: true, hidden: !this.state.selectionContexts.pagemark }),
                React.createElement(CreateModeSubmenuItems, null),
                React.createElement(react_dropdown_1.MenuItem, { divider: true, hidden: !this.state.selectionContexts.textHighlight }),
                React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.textHighlight },
                    "Text Highlight",
                    React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.textHighlight, onSelect: () => ContextMenuMessages_1.ContextMenuMessages.postContextMenuMessage("scroll-to-text-highlight", triggerEvent) }, "Scroll Into View"),
                    React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.textHighlight, onSelect: () => ContextMenuMessages_1.ContextMenuMessages.postContextMenuMessage("delete-text-highlight", triggerEvent) },
                        React.createElement("div", { className: "text-danger" }, "Delete"))),
                React.createElement(react_dropdown_1.MenuItem, { divider: true, hidden: !this.state.selectionContexts.areaHighlight }),
                React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.areaHighlight },
                    "Area Highlight",
                    React.createElement(react_dropdown_1.MenuItem, { hidden: !this.state.selectionContexts.areaHighlight, onSelect: () => ContextMenuMessages_1.ContextMenuMessages.postContextMenuMessage("delete-area-highlight", triggerEvent) },
                        React.createElement("div", { className: "text-danger" }, "Delete"))),
                React.createElement(react_dropdown_1.MenuItem, { divider: true }),
                React.createElement(react_dropdown_1.MenuItem, { onSelect: () => AnnotationSidebarClient_1.AnnotationSidebarClient.toggleAnnotationSidebar() }, "Toggle Annotation Sidebar"))));
    }
}
exports.BrowserContextMenu = BrowserContextMenu;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnJvd3NlckNvbnRleHRNZW51LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQnJvd3NlckNvbnRleHRNZW51LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSx1RkFBdUc7QUFFdkcsNkNBQStCO0FBRS9CLG1FQUE4RDtBQUM5RCwrREFBNEU7QUFFNUUsZ0VBQTJEO0FBQzNELHdEQUFtRDtBQUNuRCw4RkFBeUY7QUFDekYsZ0VBQTJEO0FBRTNELE1BQWEsa0JBQW1CLFNBQVEsS0FBSyxDQUFDLFNBQXlCO0lBRW5FLFlBQVksS0FBYTtRQUNyQixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFYixJQUFJLENBQUMsS0FBSyxHQUFHO1lBRVQsaUJBQWlCLEVBQUU7Z0JBQ2YsSUFBSSxFQUFFLEtBQUs7Z0JBQ1gsYUFBYSxFQUFFLEtBQUs7Z0JBQ3BCLGFBQWEsRUFBRSxLQUFLO2dCQUNwQixRQUFRLEVBQUUsS0FBSzthQUNsQjtTQUVKLENBQUM7UUFFRixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUV6Qix3REFBMkIsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxTQUFpQixFQUFFLElBQXlCLEVBQUUsRUFBRTtZQUU3RSxNQUFNLFlBQVksR0FBaUIsSUFBSyxDQUFDO1lBRXpDLE1BQU0sS0FBSyxtQ0FBTyxJQUFJLENBQUMsS0FBSyxLQUFFLFlBQVksR0FBQyxDQUFDO1lBRTVDLElBQUksWUFBWSxFQUFFO2dCQUVkLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxpQ0FBZSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUM1RixLQUFLLENBQUMsaUJBQWlCLENBQUMsYUFBYSxHQUFHLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsaUNBQWUsQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDL0csS0FBSyxDQUFDLGlCQUFpQixD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RUEsQ0FFTCxDQUNqQixDQUFDO0lBRU4sQ0FBQztDQUVKO0FBaEtELGdEQWdLQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29udGV4dE1lbnVXcmFwcGVyLCBhZGRDb250ZXh0TWVudUV2ZW50TGlzdGVuZXJ9IGZyb20gJ0BidXJ0b25hdG9yL3JlYWN0LWNvbnRleHQtbWVudS13cmFwcGVyJztcbmltcG9ydCB7VGVzdE1lbnV9IGZyb20gJy4uLy4uLy4uL3NwZWN0cm9uMC91aS1jb21wb25lbnRzL1Rlc3RNZW51JztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCAqIGFzIFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQge0NvbnRleHRNZW51fSBmcm9tICcuLi8uLi91aS9jb250ZXh0X21lbnUvQ29udGV4dE1lbnUnO1xuaW1wb3J0IERyb3Bkb3duLCB7RHJvcGRvd25NZW51LCBNZW51SXRlbX0gZnJvbSBcIkBidXJ0b25hdG9yL3JlYWN0LWRyb3Bkb3duXCI7XG5pbXBvcnQge1RyaWdnZXJFdmVudH0gZnJvbSAnLi4vVHJpZ2dlckV2ZW50JztcbmltcG9ydCB7Q29udGV4dE1lbnVNZXNzYWdlc30gZnJvbSAnLi4vQ29udGV4dE1lbnVNZXNzYWdlcyc7XG5pbXBvcnQge0NvbnRleHRNZW51VHlwZX0gZnJvbSAnLi4vQ29udGV4dE1lbnVUeXBlJztcbmltcG9ydCB7QW5ub3RhdGlvblNpZGViYXJDbGllbnR9IGZyb20gJy4uLy4uL2Fubm90YXRpb25fc2lkZWJhci9Bbm5vdGF0aW9uU2lkZWJhckNsaWVudCc7XG5pbXBvcnQge1BhZ2VtYXJrTW9kZXN9IGZyb20gJy4uLy4uL21ldGFkYXRhL1BhZ2VtYXJrTW9kZXMnO1xuXG5leHBvcnQgY2xhc3MgQnJvd3NlckNvbnRleHRNZW51IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuXG4gICAgICAgICAgICBzZWxlY3Rpb25Db250ZXh0czoge1xuICAgICAgICAgICAgICAgIHBhZ2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGFyZWFIaWdobGlnaHQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRleHRIaWdobGlnaHQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHBhZ2VtYXJrOiBmYWxzZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLnByb3BzLmlkO1xuXG4gICAgICAgIGFkZENvbnRleHRNZW51RXZlbnRMaXN0ZW5lcihpZCwgKGV2ZW50TmFtZTogc3RyaW5nLCBkYXRhOiBUcmlnZ2VyRXZlbnQgfCBudWxsKSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IHRyaWdnZXJFdmVudDogVHJpZ2dlckV2ZW50ID0gZGF0YSE7XG5cbiAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gey4uLnRoaXMuc3RhdGUsIHRyaWdnZXJFdmVudH07XG5cbiAgICAgICAgICAgIGlmICh0cmlnZ2VyRXZlbnQpIHtcblxuICAgICAgICAgICAgICAgIHN0YXRlLnNlbGVjdGlvbkNvbnRleHRzLnBhZ2UgPSB0cmlnZ2VyRXZlbnQuY29udGV4dE1lbnVUeXBlcy5pbmNsdWRlcyhDb250ZXh0TWVudVR5cGUuUEFHRSk7XG4gICAgICAgICAgICAgICAgc3RhdGUuc2VsZWN0aW9uQ29udGV4dHMudGV4dEhpZ2hsaWdodCA9IHRyaWdnZXJFdmVudC5jb250ZXh0TWVudVR5cGVzLmluY2x1ZGVzKENvbnRleHRNZW51VHlwZS5URVhUX0hJR0hMSUdIVCk7XG4gICAgICAgICAgICAgICAgc3RhdGUuc2VsZWN0aW9uQ29udGV4dHMuYXJlYUhpZ2hsaWdodCA9IHRyaWdnZXJFdmVudC5jb250ZXh0TWVudVR5cGVzLmluY2x1ZGVzKENvbnRleHRNZW51VHlwZS5BUkVBX0hJR0hMSUdIVCk7XG4gICAgICAgICAgICAgICAgc3RhdGUuc2VsZWN0aW9uQ29udGV4dHMucGFnZW1hcmsgPSB0cmlnZ2VyRXZlbnQuY29udGV4dE1lbnVUeXBlcy5pbmNsdWRlcyhDb250ZXh0TWVudVR5cGUuUEFHRU1BUkspO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlKTtcblxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG5cbiAgICAgICAgY29uc3QgdHJpZ2dlckV2ZW50ID0gdGhpcy5zdGF0ZS50cmlnZ2VyRXZlbnQhO1xuXG4gICAgICAgIGNvbnN0IENyZWF0ZU1vZGVTdWJtZW51SXRlbXMgPSAoKSA9PiB7XG5cbiAgICAgICAgICAgIHJldHVybiA8TWVudUl0ZW0gaGlkZGVuPXshdGhpcy5zdGF0ZS5zZWxlY3Rpb25Db250ZXh0cy5wYWdlbWFya30+XG5cbiAgICAgICAgICAgICAgICBQYWdlbWFya1xuXG4gICAgICAgICAgICAgICAgPE1lbnVJdGVtPlxuXG4gICAgICAgICAgICAgICAgICAgIFNldCBNb2RlXG5cbiAgICAgICAgICAgICAgICAgICAge1BhZ2VtYXJrTW9kZXMudG9EZXNjcmlwdG9ycygpLm1hcChjdXJyZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoPE1lbnVJdGVtIGtleT17Y3VycmVudC5rZXl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW49eyF0aGlzLnN0YXRlLnNlbGVjdGlvbkNvbnRleHRzLnBhZ2VtYXJrfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TZWxlY3Q9eygpID0+IENvbnRleHRNZW51TWVzc2FnZXMucG9zdENvbnRleHRNZW51TWVzc2FnZShcInNldC1wYWdlbWFyay1tb2RlLVwiICsgY3VycmVudC5rZXksIHRyaWdnZXJFdmVudCl9PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge2N1cnJlbnQudGl0bGV9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvTWVudUl0ZW0+KTtcbiAgICAgICAgICAgICAgICAgICAgfSl9XG5cbiAgICAgICAgICAgICAgICA8L01lbnVJdGVtPlxuXG4gICAgICAgICAgICAgICAgPE1lbnVJdGVtIGRpdmlkZXIvPlxuXG4gICAgICAgICAgICAgICAgPE1lbnVJdGVtIGhpZGRlbj17IXRoaXMuc3RhdGUuc2VsZWN0aW9uQ29udGV4dHMucGFnZW1hcmt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0PXsoKSA9PiBDb250ZXh0TWVudU1lc3NhZ2VzLnBvc3RDb250ZXh0TWVudU1lc3NhZ2UoXCJkZWxldGUtcGFnZW1hcmtcIiwgdHJpZ2dlckV2ZW50KX0+XG5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LWRhbmdlclwiPkRlbGV0ZTwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPC9NZW51SXRlbT5cblxuICAgICAgICAgICAgPC9NZW51SXRlbT47XG5cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gKFxuXG4gICAgICAgICAgICA8Q29udGV4dE1lbnUgaWQ9e3RoaXMucHJvcHMuaWR9PlxuXG4gICAgICAgICAgICAgICAgPERyb3Bkb3duTWVudT5cblxuICAgICAgICAgICAgICAgICAgICA8TWVudUl0ZW0gaGlkZGVuPXshdGhpcy5zdGF0ZS5zZWxlY3Rpb25Db250ZXh0cy5wYWdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TZWxlY3Q9eygpID0+IENvbnRleHRNZW51TWVzc2FnZXMucG9zdENvbnRleHRNZW51TWVzc2FnZShcImNyZWF0ZS1wYWdlbWFyay10by1wb2ludFwiLCB0cmlnZ2VyRXZlbnQpfT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlIFBhZ2VtYXJrIHRvIFBvaW50XG5cbiAgICAgICAgICAgICAgICAgICAgPC9NZW51SXRlbT5cblxuICAgICAgICAgICAgICAgICAgICA8TWVudUl0ZW0gaGlkZGVuPXshdGhpcy5zdGF0ZS5zZWxlY3Rpb25Db250ZXh0cy5wYWdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TZWxlY3Q9eygpID0+IENvbnRleHRNZW51TWVzc2FnZXMucG9zdENvbnRleHRNZW51TWVzc2FnZShcImNyZWF0ZS1wYWdlbWFya1wiLCB0cmlnZ2VyRXZlbnQpfT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlIFBhZ2VtYXJrIEJveFxuXG4gICAgICAgICAgICAgICAgICAgIDwvTWVudUl0ZW0+XG5cbiAgICAgICAgICAgICAgICAgICAgPE1lbnVJdGVtIGhpZGRlbj17IXRoaXMuc3RhdGUuc2VsZWN0aW9uQ29udGV4dHMucGFnZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0PXsoKSA9PiBDb250ZXh0TWVudU1lc3NhZ2VzLnBvc3RDb250ZXh0TWVudU1lc3NhZ2UoXCJjcmVhdGUtYXJlYS1oaWdobGlnaHRcIiwgdHJpZ2dlckV2ZW50KX0+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIENyZWF0ZSBBcmVhIEhpZ2hsaWdodFxuXG4gICAgICAgICAgICAgICAgICAgIDwvTWVudUl0ZW0+XG5cbiAgICAgICAgICAgICAgICAgICAgPE1lbnVJdGVtIGRpdmlkZXIgaGlkZGVuPXshdGhpcy5zdGF0ZS5zZWxlY3Rpb25Db250ZXh0cy5wYWdlbWFya30vPlxuXG4gICAgICAgICAgICAgICAgICAgIDxDcmVhdGVNb2RlU3VibWVudUl0ZW1zLz5cblxuICAgICAgICAgICAgICAgICAgICA8TWVudUl0ZW0gZGl2aWRlciBoaWRkZW49eyF0aGlzLnN0YXRlLnNlbGVjdGlvbkNvbnRleHRzLnRleHRIaWdobGlnaHR9Lz5cblxuICAgICAgICAgICAgICAgICAgICA8TWVudUl0ZW0gaGlkZGVuPXshdGhpcy5zdGF0ZS5zZWxlY3Rpb25Db250ZXh0cy50ZXh0SGlnaGxpZ2h0fT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCBIaWdobGlnaHRcblxuICAgICAgICAgICAgICAgICAgICAgICAgPE1lbnVJdGVtIGhpZGRlbj17IXRoaXMuc3RhdGUuc2VsZWN0aW9uQ29udGV4dHMudGV4dEhpZ2hsaWdodH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdD17KCkgPT4gQ29udGV4dE1lbnVNZXNzYWdlcy5wb3N0Q29udGV4dE1lbnVNZXNzYWdlKFwic2Nyb2xsLXRvLXRleHQtaGlnaGxpZ2h0XCIsIHRyaWdnZXJFdmVudCl9PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2Nyb2xsIEludG8gVmlld1xuXG4gICAgICAgICAgICAgICAgICAgICAgICA8L01lbnVJdGVtPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8TWVudUl0ZW0gaGlkZGVuPXshdGhpcy5zdGF0ZS5zZWxlY3Rpb25Db250ZXh0cy50ZXh0SGlnaGxpZ2h0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0PXsoKSA9PiBDb250ZXh0TWVudU1lc3NhZ2VzLnBvc3RDb250ZXh0TWVudU1lc3NhZ2UoXCJkZWxldGUtdGV4dC1oaWdobGlnaHRcIiwgdHJpZ2dlckV2ZW50KX0+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtZGFuZ2VyXCI+RGVsZXRlPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvTWVudUl0ZW0+XG5cbiAgICAgICAgICAgICAgICAgICAgPC9NZW51SXRlbT5cblxuICAgICAgICAgICAgICAgICAgICA8TWVudUl0ZW0gZGl2aWRlciBoaWRkZW49eyF0aGlzLnN0YXRlLnNlbGVjdGlvbkNvbnRleHRzLmFyZWFIaWdobGlnaHR9Lz5cblxuICAgICAgICAgICAgICAgICAgICA8TWVudUl0ZW0gaGlkZGVuPXshdGhpcy5zdGF0ZS5zZWxlY3Rpb25Db250ZXh0cy5hcmVhSGlnaGxpZ2h0fT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgQXJlYSBIaWdobGlnaHRcblxuICAgICAgICAgICAgICAgICAgICAgICAgPE1lbnVJdGVtIGhpZGRlbj17IXRoaXMuc3RhdGUuc2VsZWN0aW9uQ29udGV4dHMuYXJlYUhpZ2hsaWdodH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdD17KCkgPT4gQ29udGV4dE1lbnVNZXNzYWdlcy5wb3N0Q29udGV4dE1lbnVNZXNzYWdlKFwiZGVsZXRlLWFyZWEtaGlnaGxpZ2h0XCIsIHRyaWdnZXJFdmVudCl9PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LWRhbmdlclwiPkRlbGV0ZTwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8L01lbnVJdGVtPlxuXG4gICAgICAgICAgICAgICAgICAgIDwvTWVudUl0ZW0+XG5cbiAgICAgICAgICAgICAgICAgICAgPE1lbnVJdGVtIGRpdmlkZXIvPlxuXG4gICAgICAgICAgICAgICAgICAgIDxNZW51SXRlbSBvblNlbGVjdD17KCkgPT4gQW5ub3RhdGlvblNpZGViYXJDbGllbnQudG9nZ2xlQW5ub3RhdGlvblNpZGViYXIoKX0+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIFRvZ2dsZSBBbm5vdGF0aW9uIFNpZGViYXJcblxuICAgICAgICAgICAgICAgICAgICA8L01lbnVJdGVtPlxuXG4gICAgICAgICAgICAgICAgPC9Ecm9wZG93bk1lbnU+XG5cbiAgICAgICAgICAgIDwvQ29udGV4dE1lbnU+XG4gICAgICAgICk7XG5cbiAgICB9XG5cbn1cblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgcmVhZG9ubHkgaWQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgcmVhZG9ubHkgc2VsZWN0aW9uQ29udGV4dHM6IFNlbGVjdGlvbkNvbnRleHRzO1xuICAgIHJlYWRvbmx5IHRyaWdnZXJFdmVudD86IFRyaWdnZXJFdmVudDtcbn1cblxuXG5pbnRlcmZhY2UgU2VsZWN0aW9uQ29udGV4dHMge1xuICAgIHBhZ2U6IGJvb2xlYW47XG4gICAgdGV4dEhpZ2hsaWdodDogYm9vbGVhbjtcbiAgICBhcmVhSGlnaGxpZ2h0OiBib29sZWFuO1xuICAgIHBhZ2VtYXJrOiBib29sZWFuO1xufVxuIl19