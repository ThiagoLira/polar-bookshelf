"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const ReactDOM = __importStar(require("react-dom"));
const React = __importStar(require("react"));
const FileImportController_1 = require("./FileImportController");
const SimpleReactor_1 = require("../../reactor/SimpleReactor");
const AppInstance_1 = require("../../electron/framework/AppInstance");
const PersistenceLayerManager_1 = require("../../datastore/PersistenceLayerManager");
const react_router_dom_1 = require("react-router-dom");
const SyncBar_1 = require("../../ui/sync_bar/SyncBar");
const DocRepoAnkiSyncController_1 = require("../../controller/DocRepoAnkiSyncController");
const AnnotationRepoScreen_1 = __importDefault(require("../../../../apps/repository/js/annotation_repo/AnnotationRepoScreen"));
const Logger_1 = require("polar-shared/src/logger/Logger");
const UpdatesController_1 = require("../../auto_updates/UpdatesController");
const RepoDocMetaManager_1 = require("../../../../apps/repository/js/RepoDocMetaManager");
const CloudService_1 = require("../../../../apps/repository/js/cloud/CloudService");
const RepoDocMetaLoader_1 = require("../../../../apps/repository/js/RepoDocMetaLoader");
const WhatsNewScreen_1 = __importDefault(require("../../../../apps/repository/js/whats_new/WhatsNewScreen"));
const CommunityScreen_1 = __importDefault(require("../../../../apps/repository/js/community/CommunityScreen"));
const StatsScreen_1 = __importDefault(require("../../../../apps/repository/js/stats/StatsScreen"));
const LogsScreen_1 = __importDefault(require("../../../../apps/repository/js/logs/LogsScreen"));
const ToasterService_1 = require("../../ui/toaster/ToasterService");
const ProgressService_1 = require("../../ui/progress_bar/ProgressService");
const ProgressTracker_1 = require("polar-shared/src/util/ProgressTracker");
const RepoDocMetas_1 = require("../../../../apps/repository/js/RepoDocMetas");
const EditorsPicksScreen_1 = __importDefault(require("../../../../apps/repository/js/editors_picks/EditorsPicksScreen"));
const RendererAnalytics_1 = require("../../ga/RendererAnalytics");
const Version_1 = require("polar-shared/src/util/Version");
const LoadExampleDocs_1 = require("./onboarding/LoadExampleDocs");
const RepositoryTour_1 = require("./RepositoryTour");
const LocalPrefs_1 = require("../../util/LocalPrefs");
const LifecycleEvents_1 = require("../../ui/util/LifecycleEvents");
const Platforms_1 = require("polar-shared/src/util/Platforms");
const AppOrigin_1 = require("../AppOrigin");
const AppRuntime_1 = require("../../AppRuntime");
const AuthHandler_1 = require("./auth_handler/AuthHandler");
const Input_1 = __importDefault(require("reactstrap/lib/Input"));
const Splashes_1 = require("../../../../apps/repository/js/splash2/Splashes");
const MachineDatastores_1 = require("../../telemetry/MachineDatastores");
const MailingList_1 = require("./auth_handler/MailingList");
const UniqueMachines_1 = require("../../telemetry/UniqueMachines");
const PremiumScreen_1 = require("../../../../apps/repository/js/splash/splashes/premium/PremiumScreen");
const Accounts_1 = require("../../accounts/Accounts");
const SupportScreen_1 = require("../../../../apps/repository/js/support/SupportScreen");
const DocRepoScreen_1 = __importDefault(require("../../../../apps/repository/js/doc_repo/DocRepoScreen"));
const CreateGroupScreen_1 = require("../../../../apps/repository/js/groups/create/CreateGroupScreen");
const GroupsScreen_1 = require("../../../../apps/repository/js/groups/GroupsScreen");
const GroupScreen_1 = require("../../../../apps/repository/js/group/GroupScreen");
const AuthRequired_1 = require("../../../../apps/repository/js/AuthRequired");
const UIModes_1 = require("../../ui/uimodes/UIModes");
const HighlightsScreen_1 = require("../../../../apps/repository/js/group/highlights/HighlightsScreen");
const ReactRouters_1 = require("../../ui/ReactRouters");
const GroupHighlightScreen_1 = require("../../../../apps/repository/js/group/highlight/GroupHighlightScreen");
const PrefetchedUserGroupsBackgroundListener_1 = require("../../datastore/sharing/db/PrefetchedUserGroupsBackgroundListener");
const PlatformStyles_1 = require("../../ui/PlatformStyles");
const Devices_1 = require("../../util/Devices");
const PDFModernTextLayers_1 = require("polar-pdf/src/pdf/PDFModernTextLayers");
const AccountProvider_1 = require("../../accounts/AccountProvider");
const log = Logger_1.Logger.create();
class RepositoryApp {
    constructor() {
        this.persistenceLayerManager = new PersistenceLayerManager_1.PersistenceLayerManager();
        this.repoDocInfoManager = new RepoDocMetaManager_1.RepoDocMetaManager(this.persistenceLayerManager);
        this.repoDocInfoLoader = new RepoDocMetaLoader_1.RepoDocMetaLoader(this.persistenceLayerManager);
    }
    start() {
        return __awaiter(this, void 0, void 0, function* () {
            log.info("Running with Polar version: " + Version_1.Version.get());
            UIModes_1.UIModes.register();
            PlatformStyles_1.PlatformStyles.assign();
            AppOrigin_1.AppOrigin.configure();
            PDFModernTextLayers_1.PDFModernTextLayers.configure();
            const updatedDocInfoEventDispatcher = new SimpleReactor_1.SimpleReactor();
            const syncBarProgress = new SimpleReactor_1.SimpleReactor();
            const authHandler = AuthHandler_1.AuthHandlers.get();
            const authStatus = yield authHandler.status();
            const userInfo = yield authHandler.userInfo();
            const account = yield Accounts_1.Accounts.get();
            yield AccountProvider_1.AccountProvider.init();
            const platform = Platforms_1.Platforms.get();
            log.notice("Running on platform: " + platform);
            if (authStatus !== 'needs-authentication') {
                MailingList_1.MailingList.subscribeWhenNecessary()
                    .catch(err => log.error(err));
                new FileImportController_1.FileImportController(this.persistenceLayerManager, updatedDocInfoEventDispatcher)
                    .start();
                new DocRepoAnkiSyncController_1.DocRepoAnkiSyncController(this.persistenceLayerManager, syncBarProgress)
                    .start();
                new UpdatesController_1.UpdatesController().start();
                new ToasterService_1.ToasterService().start();
                new ProgressService_1.ProgressService().start();
                yield PrefetchedUserGroupsBackgroundListener_1.PrefetchedUserGroupsBackgroundListener.start();
                yield this.doLoadExampleDocs();
                MachineDatastores_1.MachineDatastores.triggerBackgroundUpdates(this.persistenceLayerManager);
                UniqueMachines_1.UniqueMachines.trigger();
                updatedDocInfoEventDispatcher.addEventListener(docInfo => {
                    this.onUpdatedDocInfo(docInfo);
                });
                this.persistenceLayerManager.addEventListener(event => {
                    if (event.state === 'changed') {
                        event.persistenceLayer.addEventListener((persistenceLayerEvent) => {
                            this.onUpdatedDocInfo(persistenceLayerEvent.docInfo);
                        });
                    }
                });
            }
            const renderDocRepoScreen = () => {
                return (React.createElement(AuthRequired_1.AuthRequired, { authStatus: authStatus },
                    React.createElement(DocRepoScreen_1.default, { persistenceLayerManager: this.persistenceLayerManager, updatedDocInfoEventDispatcher: updatedDocInfoEventDispatcher, repoDocMetaManager: this.repoDocInfoManager, repoDocMetaLoader: this.repoDocInfoLoader })));
            };
            const renderAnnotationRepoScreen = () => {
                return (React.createElement(AuthRequired_1.AuthRequired, { authStatus: authStatus },
                    React.createElement(AnnotationRepoScreen_1.default, { persistenceLayerManager: this.persistenceLayerManager, updatedDocInfoEventDispatcher: updatedDocInfoEventDispatcher, repoDocMetaManager: this.repoDocInfoManager, repoDocMetaLoader: this.repoDocInfoLoader, syncBarProgress: syncBarProgress })));
            };
            const renderDefaultScreenByDevice = () => {
                if (Devices_1.Devices.get() === 'phone' || Platforms_1.Platforms.isMobile()) {
                    return renderAnnotationRepoScreen();
                }
                return renderDocRepoScreen();
            };
            const renderWhatsNewScreen = () => {
                return (React.createElement(WhatsNewScreen_1.default, { persistenceLayerManager: this.persistenceLayerManager }));
            };
            const renderCommunityScreen = () => {
                return (React.createElement(AuthRequired_1.AuthRequired, { authStatus: authStatus },
                    React.createElement(CommunityScreen_1.default, { persistenceLayerManager: this.persistenceLayerManager })));
            };
            const renderStatsScreen = () => {
                return (React.createElement(AuthRequired_1.AuthRequired, { authStatus: authStatus },
                    React.createElement(StatsScreen_1.default, { persistenceLayerManager: this.persistenceLayerManager, repoDocMetaManager: this.repoDocInfoManager })));
            };
            const renderLogsScreen = () => {
                return (React.createElement(AuthRequired_1.AuthRequired, { authStatus: authStatus },
                    React.createElement(LogsScreen_1.default, { persistenceLayerManager: this.persistenceLayerManager })));
            };
            const editorsPicksScreen = () => {
                return (React.createElement(AuthRequired_1.AuthRequired, { authStatus: authStatus },
                    React.createElement(EditorsPicksScreen_1.default, { persistenceLayerManager: this.persistenceLayerManager })));
            };
            const renderCreateGroupScreen = () => {
                return (React.createElement(AuthRequired_1.AuthRequired, { authStatus: authStatus },
                    React.createElement(CreateGroupScreen_1.CreateGroupScreen, { persistenceLayerManager: this.persistenceLayerManager, repoDocMetaManager: this.repoDocInfoManager })));
            };
            const plan = account ? account.plan : 'free';
            const premiumScreen = () => {
                return (React.createElement(PremiumScreen_1.PremiumScreen, { persistenceLayerManager: this.persistenceLayerManager, plan: plan, userInfo: userInfo.getOrUndefined() }));
            };
            const supportScreen = () => {
                return (React.createElement(SupportScreen_1.SupportScreen, { persistenceLayerManager: this.persistenceLayerManager, plan: plan }));
            };
            const renderGroupScreen = () => {
                return (React.createElement(GroupScreen_1.GroupScreen, { persistenceLayerManager: this.persistenceLayerManager }));
            };
            const renderGroupsScreen = () => {
                return (React.createElement(GroupsScreen_1.GroupsScreen, { persistenceLayerManager: this.persistenceLayerManager }));
            };
            const renderGroupHighlightsScreen = () => {
                return (React.createElement(HighlightsScreen_1.HighlightsScreen, { persistenceLayerManager: this.persistenceLayerManager }));
            };
            const renderGroupHighlightScreen = () => {
                return (React.createElement(GroupHighlightScreen_1.GroupHighlightScreen, { persistenceLayerManager: this.persistenceLayerManager }));
            };
            const onNavChange = () => {
                try {
                    const url = new URL(document.location.href);
                    const path = url.pathname + url.hash || "";
                    const hostname = url.hostname;
                    const title = document.title;
                    log.info("Navigating to: ", { path, hostname, title });
                    RendererAnalytics_1.RendererAnalytics.pageview(path, hostname, document.title);
                }
                catch (e) {
                    log.error("Unable to handle hash change", e);
                }
            };
            onNavChange();
            window.addEventListener("hashchange", () => onNavChange(), false);
            this.sendAnalytics();
            Accounts_1.Accounts.listenForPlanUpgrades()
                .catch(err => log.error("Unable to listen for plan upgrades: ", err));
            const rootElement = document.getElementById('root');
            if (!rootElement) {
                throw new Error("No root element to render to");
            }
            ReactDOM.render(React.createElement("div", { style: { height: '100%' } },
                React.createElement(Splashes_1.Splashes, { persistenceLayerManager: this.persistenceLayerManager }),
                React.createElement(SyncBar_1.SyncBar, { progress: syncBarProgress }),
                React.createElement(RepositoryTour_1.RepositoryTour, null),
                React.createElement(react_router_dom_1.BrowserRouter, null,
                    React.createElement(react_router_dom_1.Switch, { location: ReactRouters_1.ReactRouters.createLocationWithPathnameHash() },
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#annotations', render: renderAnnotationRepoScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#whats-new', render: renderWhatsNewScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#(logout|overview|login|configured|invite|premium)?', render: renderDocRepoScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#community', render: renderCommunityScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#stats', render: renderStatsScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#logs', render: renderLogsScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#editors-picks', render: editorsPicksScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#plans', render: premiumScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#support', render: supportScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/#premium', render: premiumScreen }),
                        React.createElement(react_router_dom_1.Route, { path: '/group/:group/highlights', render: renderGroupHighlightsScreen }),
                        React.createElement(react_router_dom_1.Route, { path: '/group/:group/docs', render: renderGroupScreen }),
                        React.createElement(react_router_dom_1.Route, { path: '/group/:group/highlight/:id', render: renderGroupHighlightScreen }),
                        React.createElement(react_router_dom_1.Route, { path: '/group/:group', render: renderGroupHighlightsScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/groups', render: renderGroupsScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/groups/create', render: renderCreateGroupScreen }),
                        React.createElement(react_router_dom_1.Route, { exact: true, path: '/', render: renderDefaultScreenByDevice }))),
                React.createElement(Input_1.default, { type: "file", id: "file-upload", name: "file-upload", accept: ".pdf, .PDF", multiple: true, onChange: () => this.onFileUpload(), style: { display: 'none' } })), rootElement);
            if (authStatus !== 'needs-authentication') {
                this.handleRepoDocInfoEvents();
                yield this.repoDocInfoLoader.start();
                new CloudService_1.CloudService(this.persistenceLayerManager)
                    .start();
                yield this.persistenceLayerManager.start();
                log.info("Started repo doc loader.");
            }
            AppInstance_1.AppInstance.notifyStarted('RepositoryApp');
        });
    }
    onFileUpload() {
        window.postMessage({ type: 'file-uploaded' }, '*');
    }
    handleRepoDocInfoEvents() {
        this.repoDocInfoLoader.addEventListener(event => {
            for (const mutation of event.mutations) {
                if (mutation.mutationType === 'created' || mutation.mutationType === 'updated') {
                    this.repoDocInfoManager.updateFromRepoDocMeta(mutation.fingerprint, mutation.repoDocMeta);
                }
                else {
                    this.repoDocInfoManager.updateFromRepoDocMeta(mutation.fingerprint);
                }
            }
        });
    }
    sendAnalytics() {
        const version = Version_1.Version.get();
        const platform = Platforms_1.Platforms.toSymbol(Platforms_1.Platforms.get());
        const screen = `${window.screen.width}x${window.screen.height}`;
        const runtime = AppRuntime_1.AppRuntime.type();
        RendererAnalytics_1.RendererAnalytics.event({ category: 'app', action: 'version-' + version });
        RendererAnalytics_1.RendererAnalytics.event({ category: 'platform', action: `${platform}` });
        RendererAnalytics_1.RendererAnalytics.event({ category: 'screen', action: screen });
        RendererAnalytics_1.RendererAnalytics.event({ category: 'runtime', action: runtime });
    }
    doLoadExampleDocs() {
        return __awaiter(this, void 0, void 0, function* () {
            const doLoad = () => __awaiter(this, void 0, void 0, function* () {
                yield LocalPrefs_1.LocalPrefs.markOnceExecuted(LifecycleEvents_1.LifecycleEvents.HAS_EXAMPLE_DOCS, () => __awaiter(this, void 0, void 0, function* () {
                    const loadExampleDocs = new LoadExampleDocs_1.LoadExampleDocs(this.persistenceLayerManager.get());
                    yield loadExampleDocs.load(docInfo => {
                        this.onUpdatedDocInfo(docInfo);
                    });
                }), () => __awaiter(this, void 0, void 0, function* () {
                    log.debug("Docs already exist in repo");
                }));
            });
            this.persistenceLayerManager.addEventListener(event => {
                if (event.state === 'initialized') {
                    doLoad()
                        .catch(err => log.error("Unable to load example docs: ", err));
                }
            });
        });
    }
    onUpdatedDocInfo(docInfo) {
        const persistenceLayerProvider = () => this.persistenceLayerManager.get();
        const handleUpdatedDocInfo = () => __awaiter(this, void 0, void 0, function* () {
            log.info("Received DocInfo update");
            const docMeta = yield this.persistenceLayerManager.get().getDocMeta(docInfo.fingerprint);
            const repoDocMeta = RepoDocMetas_1.RepoDocMetas.convert(persistenceLayerProvider, docInfo.fingerprint, docMeta);
            const validity = RepoDocMetas_1.RepoDocMetas.isValid(repoDocMeta);
            if (validity === 'valid') {
                this.repoDocInfoManager.updateFromRepoDocMeta(docInfo.fingerprint, repoDocMeta);
                const progress = new ProgressTracker_1.ProgressTracker({ total: 1, id: 'doc-info-update' }).terminate();
                this.repoDocInfoLoader.dispatchEvent({
                    mutations: [
                        {
                            mutationType: 'created',
                            fingerprint: docInfo.fingerprint,
                            repoDocMeta
                        }
                    ],
                    progress
                });
                const persistenceLayer = this.persistenceLayerManager.get();
                if (PersistenceLayerManager_1.PersistenceLayerTypes.get() === 'cloud') {
                    const handleWriteDocMeta = () => __awaiter(this, void 0, void 0, function* () {
                        yield persistenceLayer.synchronizeDocs({ fingerprint: docInfo.fingerprint, docMeta });
                    });
                    handleWriteDocMeta()
                        .catch(err => log.error("Unable to write docMeta to datastore: ", err));
                }
            }
            else {
                log.warn(`We were given an invalid DocInfo which yielded a broken RepoDocMeta ${validity}: `, docInfo, repoDocMeta);
            }
        });
        handleUpdatedDocInfo()
            .catch(err => log.error("Unable to update doc info with fingerprint: " + docInfo.fingerprint, err));
    }
}
exports.RepositoryApp = RepositoryApp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwb3NpdG9yeUFwcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlJlcG9zaXRvcnlBcHAudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLG9EQUFzQztBQUN0Qyw2Q0FBK0I7QUFDL0IsaUVBQTREO0FBQzVELCtEQUE0RTtBQUU1RSxzRUFBaUU7QUFDakUscUZBR2lEO0FBQ2pELHVEQUEwRTtBQUMxRSx1REFBbUU7QUFDbkUsMEZBQXFGO0FBQ3JGLCtIQUMrRTtBQUUvRSwyREFBc0Q7QUFDdEQsNEVBQXVFO0FBRXZFLDBGQUFxRjtBQUNyRixvRkFBK0U7QUFDL0Usd0ZBQW1GO0FBQ25GLDZHQUNtRTtBQUNuRSwrR0FDb0U7QUFDcEUsbUdBQTJFO0FBQzNFLGdHQUF3RTtBQUN4RSxvRUFBK0Q7QUFDL0QsMkVBQXNFO0FBQ3RFLDJFQUFzRTtBQUN0RSw4RUFBeUU7QUFDekUseUhBQzJFO0FBQzNFLGtFQUE2RDtBQUM3RCwyREFBc0Q7QUFDdEQsa0VBQTZEO0FBQzdELHFEQUFnRDtBQUNoRCxzREFBaUQ7QUFDakQsbUVBQThEO0FBQzlELCtEQUEwRDtBQUMxRCw0Q0FBdUM7QUFDdkMsaURBQTRDO0FBQzVDLDREQUF3RDtBQUN4RCxpRUFBeUM7QUFDekMsOEVBQXlFO0FBRXpFLHlFQUFvRTtBQUNwRSw0REFBdUQ7QUFDdkQsbUVBQThEO0FBQzlELHdHQUFtRztBQUNuRyxzREFBaUQ7QUFDakQsd0ZBQW1GO0FBQ25GLDBHQUNpRTtBQUNqRSxzR0FBaUc7QUFDakcscUZBQWdGO0FBQ2hGLGtGQUE2RTtBQUM3RSw4RUFBeUU7QUFDekUsc0RBQWlEO0FBQ2pELHVHQUFrRztBQUNsRyx3REFBbUQ7QUFDbkQsOEdBQXlHO0FBQ3pHLDhIQUF5SDtBQUN6SCw0REFBdUQ7QUFDdkQsZ0RBQTJDO0FBQzNDLCtFQUEwRTtBQUMxRSxvRUFBK0Q7QUFFL0QsTUFBTSxHQUFHLEdBQUcsZUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRTVCLE1BQWEsYUFBYTtJQU10QjtRQUppQiw0QkFBdUIsR0FBRyxJQUFJLGlEQUF1QixFQUFFLENBQUM7UUFLckUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksdUNBQWtCLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDL0UsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUkscUNBQWlCLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7SUFDakYsQ0FBQztJQUVZLEtBQUs7O1lBRWQsR0FBRyxDQUFDLElBQUksQ0FBQyw4QkFBOEIsR0FBRyxpQkFBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFFekQsaUJBQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNuQiwrQkFBYyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBRXhCLHFCQUFTLENBQUMsU0FBUyxFQUFFLENBQUM7WUFFdEIseUNBQW1CLENBQUMsU0FBUyxFQUFFLENBQUM7WUFFaEMsTUFBTSw2QkFBNkIsR0FBK0IsSUFBSSw2QkFBYSxFQUFFLENBQUM7WUFFdEYsTUFBTSxlQUFlLEdBQXNDLElBQUksNkJBQWEsRUFBRSxDQUFDO1lBRS9FLE1BQU0sV0FBVyxHQUFHLDBCQUFZLENBQUMsR0FBRyxFQUFFLENBQUM7WUFFdkMsTUFBTSxVQUFVLEdBQUcsTUFBTSxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7WUFFOUMsTUFBTSxRQUFRLEdBQUcsTUFBTSxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDOUMsTUFBTSxPQUFPLEdBQUcsTUFBTSxtQkFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3JDLE1BQU0saUNBQWUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUU3QixNQUFNLFFBQVEsR0FBRyxxQkFBUyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBRWpDLEdBQUcsQ0FBQyxNQUFNLENBQUMsdUJBQXVCLEdBQUcsUUFBUSxDQUFDLENBQUM7WUFFL0MsSUFBSSxVQUFVLEtBQUssc0JBQXNCLEVBQUU7Z0JBR3ZDLHlCQUFXLENBQUMsc0JBQXNCLEVBQUU7cUJBQy9CLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFFbEMsSUFBSSwyQ0FBb0IsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsNkJBQTZCLENBQUM7cUJBQ2hGLEtBQUssRUFBRSxDQUFDO2dCQUViLElBQUkscURBQXlCLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLGVBQWUsQ0FBQztxQkFDdkUsS0FBSyxFQUFFLENBQUM7Z0JBRWIsSUFBSSxxQ0FBaUIsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUVoQyxJQUFJLCtCQUFjLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFFN0IsSUFBSSxpQ0FBZSxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBRTlCLE1BQU0sK0VBQXNDLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBRXJELE1BQU0sSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBRS9CLHFDQUFpQixDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO2dCQUV6RSwrQkFBYyxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQU16Qiw2QkFBNkIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsRUFBRTtvQkFDckQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNuQyxDQUFDLENBQUMsQ0FBQztnQkFFSCxJQUFJLENBQUMsdUJBQXVCLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLEVBQUU7b0JBRWxELElBQUksS0FBSyxDQUFDLEtBQUssS0FBSyxTQUFTLEVBQUU7d0JBQzNCLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLHFCQUE0QyxFQUFFLEVBQUU7NEJBRXJGLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFekQsQ0FBQyxDQUFDLENBQUM7cUJBQ047Z0JBRUwsQ0FBQyxDQUFDLENBQUM7YUFFTjtZQUVELE1BQU0sbUJBQW1CLEdBQUcsR0FBRyxFQUFFO2dCQUM3QixPQUFPLENBQ0gsb0JBQUMsMkJBQVksSUFBQyxVQUFVLEVBQUUsVUFBVTtvQkFDaEMsb0JBQUMsdUJBQWEsSUFBQyx1QkFBdUIsRUFBRSxJQUFJLENBQUMsdUJBQXVCLEVBQ2hELDZCQUE2QixFQUFFLDZCQUE2QixFQUM1RCxrQkFBa0IsRUFBRSxJQUFJLENBQUMsa0JBQWtCLEVBQzNDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxDQUNyRCxDQUNsQixDQUFDO1lBQ04sQ0FBQyxDQUFDO1lBRUYsTUFBTSwwQkFBMEIsR0FBRyxHQUFHLEVBQUU7Z0JBQ3BDLE9BQU8sQ0FDSCxvQkFBQywyQkFBWSxJQUFDLFVBQVUsRUFBRSxVQUFVO29CQUNoQyxvQkFBQyw4QkFBb0IsSUFBQyx1QkFBdUIsRUFBRSxJQUFJLENBQUMsdUJBQXVCLEVBQ2hELDZCQUE2QixFQUFFLDZCQUE2QixFQUM1RCxrQkFBa0IsRUFBRSxJQUFJLENBQUMsa0JBQWtCLEVBQzNDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxpQkFBaUIsRUFDekMsZUFBZSxFQUFFLGVBQWUsR0FBRyxDQUNuRCxDQUNsQixDQUFDO1lBQ04sQ0FBQyxDQUFDO1lBRUYsTUFBTSwyQkFBMkIsR0FBRyxHQUFHLEVBQUU7Z0JBRXJDLElBQUksaUJBQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSyxPQUFPLElBQUkscUJBQVMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtvQkFFbkQsT0FBTywwQkFBMEIsRUFBRSxDQUFDO2lCQUN2QztnQkFFRCxPQUFPLG1CQUFtQixFQUFFLENBQUM7WUFFakMsQ0FBQyxDQUFDO1lBRUYsTUFBTSxvQkFBb0IsR0FBRyxHQUFHLEVBQUU7Z0JBQzlCLE9BQU8sQ0FBRSxvQkFBQyx3QkFBYyxJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxDQUFFLENBQUM7WUFDeEYsQ0FBQyxDQUFDO1lBRUYsTUFBTSxxQkFBcUIsR0FBRyxHQUFHLEVBQUU7Z0JBQy9CLE9BQU8sQ0FDSCxvQkFBQywyQkFBWSxJQUFDLFVBQVUsRUFBRSxVQUFVO29CQUNoQyxvQkFBQyx5QkFBZSxJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxDQUM5RCxDQUNsQixDQUFDO1lBQ04sQ0FBQyxDQUFDO1lBRUYsTUFBTSxpQkFBaUIsR0FBRyxHQUFHLEVBQUU7Z0JBQzNCLE9BQU8sQ0FDSCxvQkFBQywyQkFBWSxJQUFDLFVBQVUsRUFBRSxVQUFVO29CQUNoQyxvQkFBQyxxQkFBVyxJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsRUFDaEQsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLENBQ3JELENBQUMsQ0FBQztZQUN6QixDQUFDLENBQUM7WUFFRixNQUFNLGdCQUFnQixHQUFHLEdBQUcsRUFBRTtnQkFDMUIsT0FBTyxDQUNILG9CQUFDLDJCQUFZLElBQUMsVUFBVSxFQUFFLFVBQVU7b0JBQ2hDLG9CQUFDLG9CQUFVLElBQUMsdUJBQXVCLEVBQUUsSUFBSSxDQUFDLHVCQUF1QixHQUFHLENBQ3pELENBQ2xCLENBQUM7WUFDTixDQUFDLENBQUM7WUFFRixNQUFNLGtCQUFrQixHQUFHLEdBQUcsRUFBRTtnQkFDNUIsT0FBTyxDQUNILG9CQUFDLDJCQUFZLElBQUMsVUFBVSxFQUFFLFVBQVU7b0JBQ2hDLG9CQUFDLDRCQUFrQixJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxDQUNqRSxDQUNkLENBQUM7WUFDVixDQUFDLENBQUM7WUFFRixNQUFNLHVCQUF1QixHQUFHLEdBQUcsRUFBRTtnQkFFakMsT0FBTyxDQUNILG9CQUFDLDJCQUFZLElBQUMsVUFBVSxFQUFFLFVBQVU7b0JBQ2hDLG9CQUFDLHFDQUFpQixJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsRUFDakQsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLENBQzFELENBQ2xCLENBQUM7WUFDTixDQUFDLENBQUM7WUFFRixNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUU3QyxNQUFNLGFBQWEsR0FBRyxHQUFHLEVBQUU7Z0JBQ3ZCLE9BQU8sQ0FBQyxvQkFBQyw2QkFBYSxJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsRUFDckQsSUFBSSxFQUFFLElBQUksRUFDVixRQUFRLEVBQUUsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNuRSxDQUFDLENBQUM7WUFFRixNQUFNLGFBQWEsR0FBRyxHQUFHLEVBQUU7Z0JBQ3ZCLE9BQU8sQ0FBQyxvQkFBQyw2QkFBYSxJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsRUFDckQsSUFBSSxFQUFFLElBQUksR0FBRyxDQUFDLENBQUM7WUFDMUMsQ0FBQyxDQUFDO1lBRUYsTUFBTSxpQkFBaUIsR0FBRyxHQUFHLEVBQUU7Z0JBQzNCLE9BQU8sQ0FBQyxvQkFBQyx5QkFBVyxJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxDQUFDLENBQUM7WUFDbkYsQ0FBQyxDQUFDO1lBRUYsTUFBTSxrQkFBa0IsR0FBRyxHQUFHLEVBQUU7Z0JBQzVCLE9BQU8sQ0FBQyxvQkFBQywyQkFBWSxJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxDQUFDLENBQUM7WUFDcEYsQ0FBQyxDQUFDO1lBRUYsTUFBTSwyQkFBMkIsR0FBRyxHQUFHLEVBQUU7Z0JBQ3JDLE9BQU8sQ0FBQyxvQkFBQyxtQ0FBZ0IsSUFBQyx1QkFBdUIsRUFBRSxJQUFJLENBQUMsdUJBQXVCLEdBQUcsQ0FBQyxDQUFDO1lBQ3hGLENBQUMsQ0FBQztZQUVGLE1BQU0sMEJBQTBCLEdBQUcsR0FBRyxFQUFFO2dCQUNwQyxPQUFPLENBQUMsb0JBQUMsMkNBQW9CLElBQUMsdUJBQXVCLEVBQUUsSUFBSSxDQUFDLHVCQUF1QixHQUFHLENBQUMsQ0FBQztZQUM1RixDQUFDLENBQUM7WUFDRixNQUFNLFdBQVcsR0FBRyxHQUFHLEVBQUU7Z0JBRXJCLElBQUk7b0JBRUEsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLFFBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFFN0MsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztvQkFDM0MsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztvQkFDOUIsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQztvQkFFN0IsR0FBRyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztvQkFFdkQscUNBQWlCLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUU5RDtnQkFBQyxPQUFPLENBQUMsRUFBRTtvQkFDUixHQUFHLENBQUMsS0FBSyxDQUFDLDhCQUE4QixFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUNoRDtZQUVMLENBQUMsQ0FBQztZQUlGLFdBQVcsRUFBRSxDQUFDO1lBRWQsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUVsRSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFckIsbUJBQVEsQ0FBQyxxQkFBcUIsRUFBRTtpQkFDM0IsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRTFFLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFnQixDQUFDO1lBRW5FLElBQUksQ0FBRSxXQUFXLEVBQUU7Z0JBQ2YsTUFBTSxJQUFJLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO2FBQ25EO1lBRUQsUUFBUSxDQUFDLE1BQU0sQ0FFWCw2QkFBSyxLQUFLLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFDO2dCQUl4QixvQkFBQyxtQkFBUSxJQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsR0FBRztnQkFFbEUsb0JBQUMsaUJBQU8sSUFBQyxRQUFRLEVBQUUsZUFBZSxHQUFHO2dCQUVyQyxvQkFBQywrQkFBYyxPQUFFO2dCQUVqQixvQkFBQyxnQ0FBYTtvQkFFVixvQkFBQyx5QkFBTSxJQUFDLFFBQVEsRUFBRSwyQkFBWSxDQUFDLDhCQUE4QixFQUFFO3dCQUUzRCxvQkFBQyx3QkFBSyxJQUFDLEtBQUssUUFBQyxJQUFJLEVBQUMsZUFBZSxFQUFDLE1BQU0sRUFBRSwwQkFBMEIsR0FBSTt3QkFFeEUsb0JBQUMsd0JBQUssSUFBQyxLQUFLLFFBQUMsSUFBSSxFQUFDLGFBQWEsRUFBQyxNQUFNLEVBQUUsb0JBQW9CLEdBQUk7d0JBRWhFLG9CQUFDLHdCQUFLLElBQUMsS0FBSyxRQUFDLElBQUksRUFBQyxzREFBc0QsRUFBQyxNQUFNLEVBQUUsbUJBQW1CLEdBQUc7d0JBRXZHLG9CQUFDLHdCQUFLLElBQUMsS0FBSyxRQUFDLElBQUksRUFBQyxhQUFhLEVBQUMsTUFBTSxFQUFFLHFCQUFxQixHQUFHO3dCQUVoRSxvQkFBQyx3QkFBSyxJQUFDLEtBQUssUUFBQyxJQUFJLEVBQUMsU0FBUyxFQUFDLE1BQU0sRUFBRSxpQkFBaUIsR0FBRzt3QkFFeEQsb0JBQUMsd0JBQUssSUFBQyxLQUFLLFFBQUMsSUFBSSxFQUFDLFFBQVEsRUFBQyxNQUFNLEVBQUUsZ0JBQWdCLEdBQUc7d0JBRXRELG9CQUFDLHdCQUFLLElBQUMsS0FBSyxRQUFDLElBQUksRUFBQyxpQkFBaUIsRUFBQyxNQUFNLEVBQUUsa0JBQWtCLEdBQUc7d0JBRWpFLG9CQUFDLHdCQUFLLElBQUMsS0FBSyxRQUFDLElBQUksRUFBQyxTQUFTLEVBQUMsTUFBTSxFQUFFLGFBQWEsR0FBRzt3QkFFcEQsb0JBQUMsd0JBQUssSUFBQyxLQUFLLFFBQUMsSUFBSSxFQUFDLFdBQVcsRUFBQyxNQUFNLEVBQUUsYUFBYSxHQUFHO3dCQUV0RCxvQkFBQyx3QkFBSyxJQUFDLEtBQUssUUFBQyxJQUFJLEVBQUMsV0FBVyxFQUFDLE1BQU0sRUFBRSxhQUFhLEdBQUc7d0JBRXRELG9CQUFDLHdCQUFLLElBQUMsSUFBSSxFQUFDLDBCQUEwQixFQUFDLE1BQU0sRUFBRSwyQkFBMkIsR0FBRzt3QkFDN0Usb0JBQUMsd0JBQUssSUFBQyxJQUFJLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSxFQUFFLGlCQUFpQixHQUFHO3dCQUU3RCxvQkFBQyx3QkFBSyxJQUFDLElBQUksRUFBQyw2QkFBNkIsRUFBQyxNQUFNLEVBQUUsMEJBQTBCLEdBQUc7d0JBRS9FLG9CQUFDLHdCQUFLLElBQUMsSUFBSSxFQUFDLGVBQWUsRUFBQyxNQUFNLEVBQUUsMkJBQTJCLEdBQUc7d0JBRWxFLG9CQUFDLHdCQUFLLElBQUMsS0FBSyxRQUFDLElBQUksRUFBQyxTQUFTLEVBQUMsTUFBTSxFQUFFLGtCQUFrQixHQUFHO3dCQUV6RCxvQkFBQyx3QkFBSyxJQUFDLEtBQUssUUFBQyxJQUFJLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSxFQUFFLHVCQUF1QixHQUFHO3dCQUVyRSxvQkFBQyx3QkFBSyxJQUFDLEtBQUssUUFBQyxJQUFJLEVBQUMsR0FBRyxFQUFDLE1BQU0sRUFBRSwyQkFBMkIsR0FBRyxDQUV2RCxDQUVHO2dCQUloQixvQkFBQyxlQUFLLElBQUMsSUFBSSxFQUFDLE1BQU0sRUFDWCxFQUFFLEVBQUMsYUFBYSxFQUNoQixJQUFJLEVBQUMsYUFBYSxFQUNsQixNQUFNLEVBQUMsWUFBWSxFQUNuQixRQUFRLFFBQ1IsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsRUFDbkMsS0FBSyxFQUFFLEVBQUMsT0FBTyxFQUFFLE1BQU0sRUFBQyxHQUFHLENBRWhDLEVBRU4sV0FBVyxDQUVkLENBQUM7WUFFRixJQUFJLFVBQVUsS0FBSyxzQkFBc0IsRUFBRTtnQkFFdkMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7Z0JBRS9CLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUVyQyxJQUFJLDJCQUFZLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDO3FCQUN6QyxLQUFLLEVBQUUsQ0FBQztnQkFFYixNQUFNLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFFM0MsR0FBRyxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO2FBRXhDO1lBRUQseUJBQVcsQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLENBQUM7UUFFL0MsQ0FBQztLQUFBO0lBRU8sWUFBWTtRQUVoQixNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUMsSUFBSSxFQUFFLGVBQWUsRUFBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRXJELENBQUM7SUFFTyx1QkFBdUI7UUFFM0IsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxFQUFFO1lBRTVDLEtBQUssTUFBTSxRQUFRLElBQUksS0FBSyxDQUFDLFNBQVMsRUFBRTtnQkFFcEMsSUFBSSxRQUFRLENBQUMsWUFBWSxLQUFLLFNBQVMsSUFBSSxRQUFRLENBQUMsWUFBWSxLQUFLLFNBQVMsRUFBRTtvQkFDNUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVksQ0FBQyxDQUFDO2lCQUM5RjtxQkFBTTtvQkFDSCxJQUFJLENBQUMsa0JBQWtCLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2lCQUN2RTthQUVKO1FBRUwsQ0FBQyxDQUFDLENBQUM7SUFFUCxDQUFDO0lBRU8sYUFBYTtRQUVqQixNQUFNLE9BQU8sR0FBRyxpQkFBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzlCLE1BQU0sUUFBUSxHQUFHLHFCQUFTLENBQUMsUUFBUSxDQUFDLHFCQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNyRCxNQUFNLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDaEUsTUFBTSxPQUFPLEdBQUcsdUJBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVsQyxxQ0FBaUIsQ0FBQyxLQUFLLENBQUMsRUFBQyxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxVQUFVLEdBQUcsT0FBTyxFQUFDLENBQUMsQ0FBQztRQUN6RSxxQ0FBaUIsQ0FBQyxLQUFLLENBQUMsRUFBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxHQUFHLFFBQVEsRUFBRSxFQUFDLENBQUMsQ0FBQztRQUN2RSxxQ0FBaUIsQ0FBQyxLQUFLLENBQUMsRUFBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO1FBQzlELHFDQUFpQixDQUFDLEtBQUssQ0FBQyxFQUFDLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7SUFFcEUsQ0FBQztJQUVhLGlCQUFpQjs7WUFFM0IsTUFBTSxNQUFNLEdBQUcsR0FBUyxFQUFFO2dCQUl0QixNQUFNLHVCQUFVLENBQUMsZ0JBQWdCLENBQUMsaUNBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFTLEVBQUU7b0JBTTNFLE1BQU0sZUFBZSxHQUFHLElBQUksaUNBQWUsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztvQkFDaEYsTUFBTSxlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFO3dCQUNqQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ25DLENBQUMsQ0FBQyxDQUFDO2dCQUVQLENBQUMsQ0FBQSxFQUFFLEdBQVMsRUFBRTtvQkFDVixHQUFHLENBQUMsS0FBSyxDQUFDLDRCQUE0QixDQUFDLENBQUM7Z0JBQzVDLENBQUMsQ0FBQSxDQUFDLENBQUM7WUFFUCxDQUFDLENBQUEsQ0FBQztZQUVGLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFFbEQsSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLGFBQWEsRUFBRTtvQkFFL0IsTUFBTSxFQUFFO3lCQUNILEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsK0JBQStCLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztpQkFFdEU7WUFFTCxDQUFDLENBQUMsQ0FBQztRQUVQLENBQUM7S0FBQTtJQUtPLGdCQUFnQixDQUFDLE9BQWlCO1FBRXRDLE1BQU0sd0JBQXdCLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRTFFLE1BQU0sb0JBQW9CLEdBQUcsR0FBUyxFQUFFO1lBRXBDLEdBQUcsQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQztZQUVwQyxNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRXpGLE1BQU0sV0FBVyxHQUFHLDJCQUFZLENBQUMsT0FBTyxDQUFDLHdCQUF3QixFQUFFLE9BQU8sQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFakcsTUFBTSxRQUFRLEdBQUcsMkJBQVksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFbkQsSUFBSSxRQUFRLEtBQUssT0FBTyxFQUFFO2dCQUV0QixJQUFJLENBQUMsa0JBQWtCLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUMsQ0FBQztnQkFFaEYsTUFBTSxRQUFRLEdBQUcsSUFBSSxpQ0FBZSxDQUFDLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsaUJBQWlCLEVBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUVwRixJQUFJLENBQUMsaUJBQWlCLENBQUMsYUFBYSxDQUFDO29CQUNoQyxTQUFTLEVBQUU7d0JBQ1A7NEJBQ0ksWUFBWSxFQUFFLFNBQVM7NEJBQ3ZCLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVzs0QkFDaEMsV0FBVzt5QkFDZDtxQkFDSjtvQkFDRCxRQUFRO2lCQUNYLENBQUMsQ0FBQztnQkFLSixNQUFNLGdCQUFnQixHQUFxQixJQUFJLENBQUMsdUJBQXVCLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBRTlFLElBQUksK0NBQXFCLENBQUMsR0FBRyxFQUFFLEtBQUssT0FBTyxFQUFFO29CQUV6QyxNQUFNLGtCQUFrQixHQUFHLEdBQVMsRUFBRTt3QkFDbEMsTUFBTSxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsRUFBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDO29CQUN4RixDQUFDLENBQUEsQ0FBQztvQkFFRixrQkFBa0IsRUFBRTt5QkFDZixLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLHdDQUF3QyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7aUJBRS9FO2FBRUo7aUJBQU07Z0JBRUgsR0FBRyxDQUFDLElBQUksQ0FBQyx1RUFBdUUsUUFBUSxJQUFJLEVBQ25GLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQzthQUVsQztRQUVMLENBQUMsQ0FBQSxDQUFDO1FBRUYsb0JBQW9CLEVBQUU7YUFDakIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyw4Q0FBOEMsR0FBRyxPQUFPLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFFNUcsQ0FBQztDQUVKO0FBemNELHNDQXljQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQge0ZpbGVJbXBvcnRDb250cm9sbGVyfSBmcm9tICcuL0ZpbGVJbXBvcnRDb250cm9sbGVyJztcbmltcG9ydCB7SUV2ZW50RGlzcGF0Y2hlciwgU2ltcGxlUmVhY3Rvcn0gZnJvbSAnLi4vLi4vcmVhY3Rvci9TaW1wbGVSZWFjdG9yJztcbmltcG9ydCB7SURvY0luZm99IGZyb20gJ3BvbGFyLXNoYXJlZC9zcmMvbWV0YWRhdGEvSURvY0luZm8nO1xuaW1wb3J0IHtBcHBJbnN0YW5jZX0gZnJvbSAnLi4vLi4vZWxlY3Ryb24vZnJhbWV3b3JrL0FwcEluc3RhbmNlJztcbmltcG9ydCB7XG4gICAgUGVyc2lzdGVuY2VMYXllck1hbmFnZXIsXG4gICAgUGVyc2lzdGVuY2VMYXllclR5cGVzXG59IGZyb20gJy4uLy4uL2RhdGFzdG9yZS9QZXJzaXN0ZW5jZUxheWVyTWFuYWdlcic7XG5pbXBvcnQge0Jyb3dzZXJSb3V0ZXIsIEhhc2hSb3V0ZXIsIFJvdXRlLCBTd2l0Y2h9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xuaW1wb3J0IHtTeW5jQmFyLCBTeW5jQmFyUHJvZ3Jlc3N9IGZyb20gJy4uLy4uL3VpL3N5bmNfYmFyL1N5bmNCYXInO1xuaW1wb3J0IHtEb2NSZXBvQW5raVN5bmNDb250cm9sbGVyfSBmcm9tICcuLi8uLi9jb250cm9sbGVyL0RvY1JlcG9BbmtpU3luY0NvbnRyb2xsZXInO1xuaW1wb3J0IEFubm90YXRpb25SZXBvU2NyZWVuXG4gICAgZnJvbSAnLi4vLi4vLi4vLi4vYXBwcy9yZXBvc2l0b3J5L2pzL2Fubm90YXRpb25fcmVwby9Bbm5vdGF0aW9uUmVwb1NjcmVlbic7XG5pbXBvcnQge1BlcnNpc3RlbmNlTGF5ZXJ9IGZyb20gJy4uLy4uL2RhdGFzdG9yZS9QZXJzaXN0ZW5jZUxheWVyJztcbmltcG9ydCB7TG9nZ2VyfSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL2xvZ2dlci9Mb2dnZXInO1xuaW1wb3J0IHtVcGRhdGVzQ29udHJvbGxlcn0gZnJvbSAnLi4vLi4vYXV0b191cGRhdGVzL1VwZGF0ZXNDb250cm9sbGVyJztcbmltcG9ydCB7UGVyc2lzdGVuY2VMYXllckV2ZW50fSBmcm9tICcuLi8uLi9kYXRhc3RvcmUvUGVyc2lzdGVuY2VMYXllckV2ZW50JztcbmltcG9ydCB7UmVwb0RvY01ldGFNYW5hZ2VyfSBmcm9tICcuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvUmVwb0RvY01ldGFNYW5hZ2VyJztcbmltcG9ydCB7Q2xvdWRTZXJ2aWNlfSBmcm9tICcuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvY2xvdWQvQ2xvdWRTZXJ2aWNlJztcbmltcG9ydCB7UmVwb0RvY01ldGFMb2FkZXJ9IGZyb20gJy4uLy4uLy4uLy4uL2FwcHMvcmVwb3NpdG9yeS9qcy9SZXBvRG9jTWV0YUxvYWRlcic7XG5pbXBvcnQgV2hhdHNOZXdTY3JlZW5cbiAgICBmcm9tICcuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvd2hhdHNfbmV3L1doYXRzTmV3U2NyZWVuJztcbmltcG9ydCBDb21tdW5pdHlTY3JlZW5cbiAgICBmcm9tICcuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvY29tbXVuaXR5L0NvbW11bml0eVNjcmVlbic7XG5pbXBvcnQgU3RhdHNTY3JlZW4gZnJvbSAnLi4vLi4vLi4vLi4vYXBwcy9yZXBvc2l0b3J5L2pzL3N0YXRzL1N0YXRzU2NyZWVuJztcbmltcG9ydCBMb2dzU2NyZWVuIGZyb20gJy4uLy4uLy4uLy4uL2FwcHMvcmVwb3NpdG9yeS9qcy9sb2dzL0xvZ3NTY3JlZW4nO1xuaW1wb3J0IHtUb2FzdGVyU2VydmljZX0gZnJvbSAnLi4vLi4vdWkvdG9hc3Rlci9Ub2FzdGVyU2VydmljZSc7XG5pbXBvcnQge1Byb2dyZXNzU2VydmljZX0gZnJvbSAnLi4vLi4vdWkvcHJvZ3Jlc3NfYmFyL1Byb2dyZXNzU2VydmljZSc7XG5pbXBvcnQge1Byb2dyZXNzVHJhY2tlcn0gZnJvbSAncG9sYXItc2hhcmVkL3NyYy91dGlsL1Byb2dyZXNzVHJhY2tlcic7XG5pbXBvcnQge1JlcG9Eb2NNZXRhc30gZnJvbSAnLi4vLi4vLi4vLi4vYXBwcy9yZXBvc2l0b3J5L2pzL1JlcG9Eb2NNZXRhcyc7XG5pbXBvcnQgRWRpdG9yc1BpY2tzU2NyZWVuXG4gICAgZnJvbSAnLi4vLi4vLi4vLi4vYXBwcy9yZXBvc2l0b3J5L2pzL2VkaXRvcnNfcGlja3MvRWRpdG9yc1BpY2tzU2NyZWVuJztcbmltcG9ydCB7UmVuZGVyZXJBbmFseXRpY3N9IGZyb20gJy4uLy4uL2dhL1JlbmRlcmVyQW5hbHl0aWNzJztcbmltcG9ydCB7VmVyc2lvbn0gZnJvbSAncG9sYXItc2hhcmVkL3NyYy91dGlsL1ZlcnNpb24nO1xuaW1wb3J0IHtMb2FkRXhhbXBsZURvY3N9IGZyb20gJy4vb25ib2FyZGluZy9Mb2FkRXhhbXBsZURvY3MnO1xuaW1wb3J0IHtSZXBvc2l0b3J5VG91cn0gZnJvbSAnLi9SZXBvc2l0b3J5VG91cic7XG5pbXBvcnQge0xvY2FsUHJlZnN9IGZyb20gJy4uLy4uL3V0aWwvTG9jYWxQcmVmcyc7XG5pbXBvcnQge0xpZmVjeWNsZUV2ZW50c30gZnJvbSAnLi4vLi4vdWkvdXRpbC9MaWZlY3ljbGVFdmVudHMnO1xuaW1wb3J0IHtQbGF0Zm9ybXN9IGZyb20gJ3BvbGFyLXNoYXJlZC9zcmMvdXRpbC9QbGF0Zm9ybXMnO1xuaW1wb3J0IHtBcHBPcmlnaW59IGZyb20gJy4uL0FwcE9yaWdpbic7XG5pbXBvcnQge0FwcFJ1bnRpbWV9IGZyb20gJy4uLy4uL0FwcFJ1bnRpbWUnO1xuaW1wb3J0IHtBdXRoSGFuZGxlcnN9IGZyb20gJy4vYXV0aF9oYW5kbGVyL0F1dGhIYW5kbGVyJztcbmltcG9ydCBJbnB1dCBmcm9tICdyZWFjdHN0cmFwL2xpYi9JbnB1dCc7XG5pbXBvcnQge1NwbGFzaGVzfSBmcm9tICcuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvc3BsYXNoMi9TcGxhc2hlcyc7XG5pbXBvcnQge01vYmlsZURpc2NsYWltZXJzfSBmcm9tICcuL01vYmlsZURpc2NsYWltZXJzJztcbmltcG9ydCB7TWFjaGluZURhdGFzdG9yZXN9IGZyb20gJy4uLy4uL3RlbGVtZXRyeS9NYWNoaW5lRGF0YXN0b3Jlcyc7XG5pbXBvcnQge01haWxpbmdMaXN0fSBmcm9tICcuL2F1dGhfaGFuZGxlci9NYWlsaW5nTGlzdCc7XG5pbXBvcnQge1VuaXF1ZU1hY2hpbmVzfSBmcm9tICcuLi8uLi90ZWxlbWV0cnkvVW5pcXVlTWFjaGluZXMnO1xuaW1wb3J0IHtQcmVtaXVtU2NyZWVufSBmcm9tICcuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvc3BsYXNoL3NwbGFzaGVzL3ByZW1pdW0vUHJlbWl1bVNjcmVlbic7XG5pbXBvcnQge0FjY291bnRzfSBmcm9tICcuLi8uLi9hY2NvdW50cy9BY2NvdW50cyc7XG5pbXBvcnQge1N1cHBvcnRTY3JlZW59IGZyb20gJy4uLy4uLy4uLy4uL2FwcHMvcmVwb3NpdG9yeS9qcy9zdXBwb3J0L1N1cHBvcnRTY3JlZW4nO1xuaW1wb3J0IERvY1JlcG9TY3JlZW5cbiAgICBmcm9tICcuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvZG9jX3JlcG8vRG9jUmVwb1NjcmVlbic7XG5pbXBvcnQge0NyZWF0ZUdyb3VwU2NyZWVufSBmcm9tIFwiLi4vLi4vLi4vLi4vYXBwcy9yZXBvc2l0b3J5L2pzL2dyb3Vwcy9jcmVhdGUvQ3JlYXRlR3JvdXBTY3JlZW5cIjtcbmltcG9ydCB7R3JvdXBzU2NyZWVufSBmcm9tIFwiLi4vLi4vLi4vLi4vYXBwcy9yZXBvc2l0b3J5L2pzL2dyb3Vwcy9Hcm91cHNTY3JlZW5cIjtcbmltcG9ydCB7R3JvdXBTY3JlZW59IGZyb20gXCIuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvZ3JvdXAvR3JvdXBTY3JlZW5cIjtcbmltcG9ydCB7QXV0aFJlcXVpcmVkfSBmcm9tIFwiLi4vLi4vLi4vLi4vYXBwcy9yZXBvc2l0b3J5L2pzL0F1dGhSZXF1aXJlZFwiO1xuaW1wb3J0IHtVSU1vZGVzfSBmcm9tIFwiLi4vLi4vdWkvdWltb2Rlcy9VSU1vZGVzXCI7XG5pbXBvcnQge0hpZ2hsaWdodHNTY3JlZW59IGZyb20gXCIuLi8uLi8uLi8uLi9hcHBzL3JlcG9zaXRvcnkvanMvZ3JvdXAvaGlnaGxpZ2h0cy9IaWdobGlnaHRzU2NyZWVuXCI7XG5pbXBvcnQge1JlYWN0Um91dGVyc30gZnJvbSBcIi4uLy4uL3VpL1JlYWN0Um91dGVyc1wiO1xuaW1wb3J0IHtHcm91cEhpZ2hsaWdodFNjcmVlbn0gZnJvbSBcIi4uLy4uLy4uLy4uL2FwcHMvcmVwb3NpdG9yeS9qcy9ncm91cC9oaWdobGlnaHQvR3JvdXBIaWdobGlnaHRTY3JlZW5cIjtcbmltcG9ydCB7UHJlZmV0Y2hlZFVzZXJHcm91cHNCYWNrZ3JvdW5kTGlzdGVuZXJ9IGZyb20gXCIuLi8uLi9kYXRhc3RvcmUvc2hhcmluZy9kYi9QcmVmZXRjaGVkVXNlckdyb3Vwc0JhY2tncm91bmRMaXN0ZW5lclwiO1xuaW1wb3J0IHtQbGF0Zm9ybVN0eWxlc30gZnJvbSBcIi4uLy4uL3VpL1BsYXRmb3JtU3R5bGVzXCI7XG5pbXBvcnQge0RldmljZXN9IGZyb20gXCIuLi8uLi91dGlsL0RldmljZXNcIjtcbmltcG9ydCB7UERGTW9kZXJuVGV4dExheWVyc30gZnJvbSBcInBvbGFyLXBkZi9zcmMvcGRmL1BERk1vZGVyblRleHRMYXllcnNcIjtcbmltcG9ydCB7QWNjb3VudFByb3ZpZGVyfSBmcm9tIFwiLi4vLi4vYWNjb3VudHMvQWNjb3VudFByb3ZpZGVyXCI7XG5cbmNvbnN0IGxvZyA9IExvZ2dlci5jcmVhdGUoKTtcblxuZXhwb3J0IGNsYXNzIFJlcG9zaXRvcnlBcHAge1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBwZXJzaXN0ZW5jZUxheWVyTWFuYWdlciA9IG5ldyBQZXJzaXN0ZW5jZUxheWVyTWFuYWdlcigpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgcmVwb0RvY0luZm9NYW5hZ2VyOiBSZXBvRG9jTWV0YU1hbmFnZXI7XG4gICAgcHJpdmF0ZSByZWFkb25seSByZXBvRG9jSW5mb0xvYWRlcjogUmVwb0RvY01ldGFMb2FkZXI7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZXBvRG9jSW5mb01hbmFnZXIgPSBuZXcgUmVwb0RvY01ldGFNYW5hZ2VyKHRoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIpO1xuICAgICAgICB0aGlzLnJlcG9Eb2NJbmZvTG9hZGVyID0gbmV3IFJlcG9Eb2NNZXRhTG9hZGVyKHRoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBzdGFydCgpIHtcblxuICAgICAgICBsb2cuaW5mbyhcIlJ1bm5pbmcgd2l0aCBQb2xhciB2ZXJzaW9uOiBcIiArIFZlcnNpb24uZ2V0KCkpO1xuXG4gICAgICAgIFVJTW9kZXMucmVnaXN0ZXIoKTtcbiAgICAgICAgUGxhdGZvcm1TdHlsZXMuYXNzaWduKCk7XG5cbiAgICAgICAgQXBwT3JpZ2luLmNvbmZpZ3VyZSgpO1xuXG4gICAgICAgIFBERk1vZGVyblRleHRMYXllcnMuY29uZmlndXJlKCk7XG5cbiAgICAgICAgY29uc3QgdXBkYXRlZERvY0luZm9FdmVudERpc3BhdGNoZXI6IElFdmVudERpc3BhdGNoZXI8SURvY0luZm8+ID0gbmV3IFNpbXBsZVJlYWN0b3IoKTtcblxuICAgICAgICBjb25zdCBzeW5jQmFyUHJvZ3Jlc3M6IElFdmVudERpc3BhdGNoZXI8U3luY0JhclByb2dyZXNzPiA9IG5ldyBTaW1wbGVSZWFjdG9yKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aEhhbmRsZXIgPSBBdXRoSGFuZGxlcnMuZ2V0KCk7XG5cbiAgICAgICAgY29uc3QgYXV0aFN0YXR1cyA9IGF3YWl0IGF1dGhIYW5kbGVyLnN0YXR1cygpO1xuXG4gICAgICAgIGNvbnN0IHVzZXJJbmZvID0gYXdhaXQgYXV0aEhhbmRsZXIudXNlckluZm8oKTtcbiAgICAgICAgY29uc3QgYWNjb3VudCA9IGF3YWl0IEFjY291bnRzLmdldCgpO1xuICAgICAgICBhd2FpdCBBY2NvdW50UHJvdmlkZXIuaW5pdCgpO1xuXG4gICAgICAgIGNvbnN0IHBsYXRmb3JtID0gUGxhdGZvcm1zLmdldCgpO1xuXG4gICAgICAgIGxvZy5ub3RpY2UoXCJSdW5uaW5nIG9uIHBsYXRmb3JtOiBcIiArIHBsYXRmb3JtKTtcblxuICAgICAgICBpZiAoYXV0aFN0YXR1cyAhPT0gJ25lZWRzLWF1dGhlbnRpY2F0aW9uJykge1xuXG4gICAgICAgICAgICAvLyBzdWJzY3JpYmUgYnV0IGRvIGl0IGluIHRoZSBiYWNrZ3JvdW5kIGFzIHRoaXMgaXNuJ3QgYSBoaWdoIHByaW9yaXR5IFVJIHRhc2suXG4gICAgICAgICAgICBNYWlsaW5nTGlzdC5zdWJzY3JpYmVXaGVuTmVjZXNzYXJ5KClcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IGxvZy5lcnJvcihlcnIpKTtcblxuICAgICAgICAgICAgbmV3IEZpbGVJbXBvcnRDb250cm9sbGVyKHRoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIsIHVwZGF0ZWREb2NJbmZvRXZlbnREaXNwYXRjaGVyKVxuICAgICAgICAgICAgICAgIC5zdGFydCgpO1xuXG4gICAgICAgICAgICBuZXcgRG9jUmVwb0Fua2lTeW5jQ29udHJvbGxlcih0aGlzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyLCBzeW5jQmFyUHJvZ3Jlc3MpXG4gICAgICAgICAgICAgICAgLnN0YXJ0KCk7XG5cbiAgICAgICAgICAgIG5ldyBVcGRhdGVzQ29udHJvbGxlcigpLnN0YXJ0KCk7XG5cbiAgICAgICAgICAgIG5ldyBUb2FzdGVyU2VydmljZSgpLnN0YXJ0KCk7XG5cbiAgICAgICAgICAgIG5ldyBQcm9ncmVzc1NlcnZpY2UoKS5zdGFydCgpO1xuXG4gICAgICAgICAgICBhd2FpdCBQcmVmZXRjaGVkVXNlckdyb3Vwc0JhY2tncm91bmRMaXN0ZW5lci5zdGFydCgpO1xuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmRvTG9hZEV4YW1wbGVEb2NzKCk7XG5cbiAgICAgICAgICAgIE1hY2hpbmVEYXRhc3RvcmVzLnRyaWdnZXJCYWNrZ3JvdW5kVXBkYXRlcyh0aGlzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyKTtcblxuICAgICAgICAgICAgVW5pcXVlTWFjaGluZXMudHJpZ2dlcigpO1xuXG4gICAgICAgICAgICAvLyBQcmV2aWV3RGlzY2xhaW1lcnMuY3JlYXRlV2hlbk5lY2Vzc2FyeSgpO1xuXG4gICAgICAgICAgICAvLyBNb2JpbGVEaXNjbGFpbWVycy5jcmVhdGVXaGVuTmVjZXNzYXJ5KCk7XG5cbiAgICAgICAgICAgIHVwZGF0ZWREb2NJbmZvRXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoZG9jSW5mbyA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vblVwZGF0ZWREb2NJbmZvKGRvY0luZm8pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihldmVudCA9PiB7XG5cbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc3RhdGUgPT09ICdjaGFuZ2VkJykge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wZXJzaXN0ZW5jZUxheWVyLmFkZEV2ZW50TGlzdGVuZXIoKHBlcnNpc3RlbmNlTGF5ZXJFdmVudDogUGVyc2lzdGVuY2VMYXllckV2ZW50KSA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25VcGRhdGVkRG9jSW5mbyhwZXJzaXN0ZW5jZUxheWVyRXZlbnQuZG9jSW5mbyk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVuZGVyRG9jUmVwb1NjcmVlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPEF1dGhSZXF1aXJlZCBhdXRoU3RhdHVzPXthdXRoU3RhdHVzfT5cbiAgICAgICAgICAgICAgICAgICAgPERvY1JlcG9TY3JlZW4gcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZERvY0luZm9FdmVudERpc3BhdGNoZXI9e3VwZGF0ZWREb2NJbmZvRXZlbnREaXNwYXRjaGVyfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9Eb2NNZXRhTWFuYWdlcj17dGhpcy5yZXBvRG9jSW5mb01hbmFnZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb0RvY01ldGFMb2FkZXI9e3RoaXMucmVwb0RvY0luZm9Mb2FkZXJ9Lz5cbiAgICAgICAgICAgICAgICA8L0F1dGhSZXF1aXJlZD5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVuZGVyQW5ub3RhdGlvblJlcG9TY3JlZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxBdXRoUmVxdWlyZWQgYXV0aFN0YXR1cz17YXV0aFN0YXR1c30+XG4gICAgICAgICAgICAgICAgICAgIDxBbm5vdGF0aW9uUmVwb1NjcmVlbiBwZXJzaXN0ZW5jZUxheWVyTWFuYWdlcj17dGhpcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZERvY0luZm9FdmVudERpc3BhdGNoZXI9e3VwZGF0ZWREb2NJbmZvRXZlbnREaXNwYXRjaGVyfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvRG9jTWV0YU1hbmFnZXI9e3RoaXMucmVwb0RvY0luZm9NYW5hZ2VyfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvRG9jTWV0YUxvYWRlcj17dGhpcy5yZXBvRG9jSW5mb0xvYWRlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3luY0JhclByb2dyZXNzPXtzeW5jQmFyUHJvZ3Jlc3N9Lz5cbiAgICAgICAgICAgICAgICA8L0F1dGhSZXF1aXJlZD5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVuZGVyRGVmYXVsdFNjcmVlbkJ5RGV2aWNlID0gKCkgPT4ge1xuXG4gICAgICAgICAgICBpZiAoRGV2aWNlcy5nZXQoKSA9PT0gJ3Bob25lJyB8fCBQbGF0Zm9ybXMuaXNNb2JpbGUoKSkge1xuICAgICAgICAgICAgICAgIC8vIGZvciB0YWJsZXRzIG9yIHBob25lcyB3ZSBuZWVkIHRvIHVzZSB0aGUgYW5ub3RhdGlvbiByZXBvIHNjcmVlblxuICAgICAgICAgICAgICAgIHJldHVybiByZW5kZXJBbm5vdGF0aW9uUmVwb1NjcmVlbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyRG9jUmVwb1NjcmVlbigpO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVuZGVyV2hhdHNOZXdTY3JlZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKCA8V2hhdHNOZXdTY3JlZW4gcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9Lz4gKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZW5kZXJDb21tdW5pdHlTY3JlZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxBdXRoUmVxdWlyZWQgYXV0aFN0YXR1cz17YXV0aFN0YXR1c30+XG4gICAgICAgICAgICAgICAgICAgIDxDb21tdW5pdHlTY3JlZW4gcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9Lz5cbiAgICAgICAgICAgICAgICA8L0F1dGhSZXF1aXJlZD5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVuZGVyU3RhdHNTY3JlZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxBdXRoUmVxdWlyZWQgYXV0aFN0YXR1cz17YXV0aFN0YXR1c30+XG4gICAgICAgICAgICAgICAgICAgIDxTdGF0c1NjcmVlbiBwZXJzaXN0ZW5jZUxheWVyTWFuYWdlcj17dGhpcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb0RvY01ldGFNYW5hZ2VyPXt0aGlzLnJlcG9Eb2NJbmZvTWFuYWdlcn0vPlxuICAgICAgICAgICAgICAgIDwvQXV0aFJlcXVpcmVkPik7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVuZGVyTG9nc1NjcmVlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPEF1dGhSZXF1aXJlZCBhdXRoU3RhdHVzPXthdXRoU3RhdHVzfT5cbiAgICAgICAgICAgICAgICAgICAgPExvZ3NTY3JlZW4gcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9Lz5cbiAgICAgICAgICAgICAgICA8L0F1dGhSZXF1aXJlZD5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZWRpdG9yc1BpY2tzU2NyZWVuID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8QXV0aFJlcXVpcmVkIGF1dGhTdGF0dXM9e2F1dGhTdGF0dXN9PlxuICAgICAgICAgICAgICAgICAgICA8RWRpdG9yc1BpY2tzU2NyZWVuIHBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyPXt0aGlzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyfS8+XG4gICAgICAgICAgICAgICAgPC9BdXRoUmVxdWlyZWQ+XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZW5kZXJDcmVhdGVHcm91cFNjcmVlbiA9ICgpID0+IHtcblxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8QXV0aFJlcXVpcmVkIGF1dGhTdGF0dXM9e2F1dGhTdGF0dXN9PlxuICAgICAgICAgICAgICAgICAgICA8Q3JlYXRlR3JvdXBTY3JlZW4gcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb0RvY01ldGFNYW5hZ2VyPXt0aGlzLnJlcG9Eb2NJbmZvTWFuYWdlcn0vPlxuICAgICAgICAgICAgICAgIDwvQXV0aFJlcXVpcmVkPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBwbGFuID0gYWNjb3VudCA/IGFjY291bnQucGxhbiA6ICdmcmVlJztcblxuICAgICAgICBjb25zdCBwcmVtaXVtU2NyZWVuID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICg8UHJlbWl1bVNjcmVlbiBwZXJzaXN0ZW5jZUxheWVyTWFuYWdlcj17dGhpcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhbj17cGxhbn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlckluZm89e3VzZXJJbmZvLmdldE9yVW5kZWZpbmVkKCl9Lz4pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHN1cHBvcnRTY3JlZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKDxTdXBwb3J0U2NyZWVuIHBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyPXt0aGlzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFuPXtwbGFufS8+KTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZW5kZXJHcm91cFNjcmVlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoPEdyb3VwU2NyZWVuIHBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyPXt0aGlzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyfS8+KTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZW5kZXJHcm91cHNTY3JlZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKDxHcm91cHNTY3JlZW4gcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9Lz4pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlbmRlckdyb3VwSGlnaGxpZ2h0c1NjcmVlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoPEhpZ2hsaWdodHNTY3JlZW4gcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9Lz4pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlbmRlckdyb3VwSGlnaGxpZ2h0U2NyZWVuID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICg8R3JvdXBIaWdobGlnaHRTY3JlZW4gcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9Lz4pO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBvbk5hdkNoYW5nZSA9ICgpID0+IHtcblxuICAgICAgICAgICAgdHJ5IHtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoZG9jdW1lbnQubG9jYXRpb24hLmhyZWYpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aCA9IHVybC5wYXRobmFtZSArIHVybC5oYXNoIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgY29uc3QgaG9zdG5hbWUgPSB1cmwuaG9zdG5hbWU7XG4gICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC50aXRsZTtcblxuICAgICAgICAgICAgICAgIGxvZy5pbmZvKFwiTmF2aWdhdGluZyB0bzogXCIsIHsgcGF0aCwgaG9zdG5hbWUsIHRpdGxlIH0pO1xuXG4gICAgICAgICAgICAgICAgUmVuZGVyZXJBbmFseXRpY3MucGFnZXZpZXcocGF0aCwgaG9zdG5hbWUsIGRvY3VtZW50LnRpdGxlKTtcblxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGxvZy5lcnJvcihcIlVuYWJsZSB0byBoYW5kbGUgaGFzaCBjaGFuZ2VcIiwgZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBtdXN0IGJlIGNhbGxlZCB0aGUgZmlyc3QgdGltZSBzbyB0aGF0IHdlIGhhdmUgYW5hbHl0aWNzIGZvciB0aGUgaG9tZVxuICAgICAgICAvLyBwYWdlIG9uIGZpcnN0IGxvYWQuXG4gICAgICAgIG9uTmF2Q2hhbmdlKCk7XG5cbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJoYXNoY2hhbmdlXCIsICgpID0+IG9uTmF2Q2hhbmdlKCksIGZhbHNlKTtcblxuICAgICAgICB0aGlzLnNlbmRBbmFseXRpY3MoKTtcblxuICAgICAgICBBY2NvdW50cy5saXN0ZW5Gb3JQbGFuVXBncmFkZXMoKVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBsb2cuZXJyb3IoXCJVbmFibGUgdG8gbGlzdGVuIGZvciBwbGFuIHVwZ3JhZGVzOiBcIiwgZXJyKSk7XG5cbiAgICAgICAgY29uc3Qgcm9vdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpIGFzIEhUTUxFbGVtZW50O1xuXG4gICAgICAgIGlmICghIHJvb3RFbGVtZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyByb290IGVsZW1lbnQgdG8gcmVuZGVyIHRvXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgUmVhY3RET00ucmVuZGVyKFxuXG4gICAgICAgICAgICA8ZGl2IHN0eWxlPXt7aGVpZ2h0OiAnMTAwJSd9fT5cblxuICAgICAgICAgICAgey8qPFByaW9yaXRpemVkU3BsYXNoZXMgcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9Lz4qL31cblxuICAgICAgICAgICAgICAgIDxTcGxhc2hlcyBwZXJzaXN0ZW5jZUxheWVyTWFuYWdlcj17dGhpcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlcn0vPlxuXG4gICAgICAgICAgICAgICAgPFN5bmNCYXIgcHJvZ3Jlc3M9e3N5bmNCYXJQcm9ncmVzc30vPlxuXG4gICAgICAgICAgICAgICAgPFJlcG9zaXRvcnlUb3VyLz5cblxuICAgICAgICAgICAgICAgIDxCcm93c2VyUm91dGVyPlxuXG4gICAgICAgICAgICAgICAgICAgIDxTd2l0Y2ggbG9jYXRpb249e1JlYWN0Um91dGVycy5jcmVhdGVMb2NhdGlvbldpdGhQYXRobmFtZUhhc2goKX0+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSb3V0ZSBleGFjdCBwYXRoPScvI2Fubm90YXRpb25zJyByZW5kZXI9e3JlbmRlckFubm90YXRpb25SZXBvU2NyZWVufSAvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8Um91dGUgZXhhY3QgcGF0aD0nLyN3aGF0cy1uZXcnIHJlbmRlcj17cmVuZGVyV2hhdHNOZXdTY3JlZW59IC8+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSb3V0ZSBleGFjdCBwYXRoPScvIyhsb2dvdXR8b3ZlcnZpZXd8bG9naW58Y29uZmlndXJlZHxpbnZpdGV8cHJlbWl1bSk/JyByZW5kZXI9e3JlbmRlckRvY1JlcG9TY3JlZW59Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPFJvdXRlIGV4YWN0IHBhdGg9Jy8jY29tbXVuaXR5JyByZW5kZXI9e3JlbmRlckNvbW11bml0eVNjcmVlbn0vPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8Um91dGUgZXhhY3QgcGF0aD0nLyNzdGF0cycgcmVuZGVyPXtyZW5kZXJTdGF0c1NjcmVlbn0vPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8Um91dGUgZXhhY3QgcGF0aD0nLyNsb2dzJyByZW5kZXI9e3JlbmRlckxvZ3NTY3JlZW59Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPFJvdXRlIGV4YWN0IHBhdGg9Jy8jZWRpdG9ycy1waWNrcycgcmVuZGVyPXtlZGl0b3JzUGlja3NTY3JlZW59Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPFJvdXRlIGV4YWN0IHBhdGg9Jy8jcGxhbnMnIHJlbmRlcj17cHJlbWl1bVNjcmVlbn0vPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8Um91dGUgZXhhY3QgcGF0aD0nLyNzdXBwb3J0JyByZW5kZXI9e3N1cHBvcnRTY3JlZW59Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPFJvdXRlIGV4YWN0IHBhdGg9Jy8jcHJlbWl1bScgcmVuZGVyPXtwcmVtaXVtU2NyZWVufS8+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSb3V0ZSBwYXRoPScvZ3JvdXAvOmdyb3VwL2hpZ2hsaWdodHMnIHJlbmRlcj17cmVuZGVyR3JvdXBIaWdobGlnaHRzU2NyZWVufS8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Um91dGUgcGF0aD0nL2dyb3VwLzpncm91cC9kb2NzJyByZW5kZXI9e3JlbmRlckdyb3VwU2NyZWVufS8+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSb3V0ZSBwYXRoPScvZ3JvdXAvOmdyb3VwL2hpZ2hsaWdodC86aWQnIHJlbmRlcj17cmVuZGVyR3JvdXBIaWdobGlnaHRTY3JlZW59Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPFJvdXRlIHBhdGg9Jy9ncm91cC86Z3JvdXAnIHJlbmRlcj17cmVuZGVyR3JvdXBIaWdobGlnaHRzU2NyZWVufS8+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSb3V0ZSBleGFjdCBwYXRoPScvZ3JvdXBzJyByZW5kZXI9e3JlbmRlckdyb3Vwc1NjcmVlbn0vPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8Um91dGUgZXhhY3QgcGF0aD0nL2dyb3Vwcy9jcmVhdGUnIHJlbmRlcj17cmVuZGVyQ3JlYXRlR3JvdXBTY3JlZW59Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPFJvdXRlIGV4YWN0IHBhdGg9Jy8nIHJlbmRlcj17cmVuZGVyRGVmYXVsdFNjcmVlbkJ5RGV2aWNlfS8+XG5cbiAgICAgICAgICAgICAgICAgICAgPC9Td2l0Y2g+XG5cbiAgICAgICAgICAgICAgICA8L0Jyb3dzZXJSb3V0ZXI+XG5cbiAgICAgICAgICAgICAgICB7LypVc2VkIGZvciBmaWxlIHVwbG9hZHMuICBUaGlzIGhhcyB0byBiZSBvbiB0aGUgcGFnZSBhbmQgY2FuJ3QgYmUqL31cbiAgICAgICAgICAgICAgICB7LypzZWxlY3RpdmVseSBoaWRkZW4gYnkgY29tcG9uZW50cy4qL31cbiAgICAgICAgICAgICAgICA8SW5wdXQgdHlwZT1cImZpbGVcIlxuICAgICAgICAgICAgICAgICAgICAgICBpZD1cImZpbGUtdXBsb2FkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1cImZpbGUtdXBsb2FkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0PVwiLnBkZiwgLlBERlwiXG4gICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlXG4gICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoKSA9PiB0aGlzLm9uRmlsZVVwbG9hZCgpfVxuICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e2Rpc3BsYXk6ICdub25lJ319Lz5cblxuICAgICAgICAgICAgPC9kaXY+LFxuXG4gICAgICAgICAgICByb290RWxlbWVudFxuXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKGF1dGhTdGF0dXMgIT09ICduZWVkcy1hdXRoZW50aWNhdGlvbicpIHtcblxuICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXBvRG9jSW5mb0V2ZW50cygpO1xuXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJlcG9Eb2NJbmZvTG9hZGVyLnN0YXJ0KCk7XG5cbiAgICAgICAgICAgIG5ldyBDbG91ZFNlcnZpY2UodGhpcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlcilcbiAgICAgICAgICAgICAgICAuc3RhcnQoKTtcblxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlci5zdGFydCgpO1xuXG4gICAgICAgICAgICBsb2cuaW5mbyhcIlN0YXJ0ZWQgcmVwbyBkb2MgbG9hZGVyLlwiKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgQXBwSW5zdGFuY2Uubm90aWZ5U3RhcnRlZCgnUmVwb3NpdG9yeUFwcCcpO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkZpbGVVcGxvYWQoKSB7XG5cbiAgICAgICAgd2luZG93LnBvc3RNZXNzYWdlKHt0eXBlOiAnZmlsZS11cGxvYWRlZCd9LCAnKicpO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVSZXBvRG9jSW5mb0V2ZW50cygpIHtcblxuICAgICAgICB0aGlzLnJlcG9Eb2NJbmZvTG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQgPT4ge1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IG11dGF0aW9uIG9mIGV2ZW50Lm11dGF0aW9ucykge1xuXG4gICAgICAgICAgICAgICAgaWYgKG11dGF0aW9uLm11dGF0aW9uVHlwZSA9PT0gJ2NyZWF0ZWQnIHx8IG11dGF0aW9uLm11dGF0aW9uVHlwZSA9PT0gJ3VwZGF0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVwb0RvY0luZm9NYW5hZ2VyLnVwZGF0ZUZyb21SZXBvRG9jTWV0YShtdXRhdGlvbi5maW5nZXJwcmludCwgbXV0YXRpb24ucmVwb0RvY01ldGEhKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcG9Eb2NJbmZvTWFuYWdlci51cGRhdGVGcm9tUmVwb0RvY01ldGEobXV0YXRpb24uZmluZ2VycHJpbnQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZW5kQW5hbHl0aWNzKCkge1xuXG4gICAgICAgIGNvbnN0IHZlcnNpb24gPSBWZXJzaW9uLmdldCgpO1xuICAgICAgICBjb25zdCBwbGF0Zm9ybSA9IFBsYXRmb3Jtcy50b1N5bWJvbChQbGF0Zm9ybXMuZ2V0KCkpO1xuICAgICAgICBjb25zdCBzY3JlZW4gPSBgJHt3aW5kb3cuc2NyZWVuLndpZHRofXgke3dpbmRvdy5zY3JlZW4uaGVpZ2h0fWA7XG4gICAgICAgIGNvbnN0IHJ1bnRpbWUgPSBBcHBSdW50aW1lLnR5cGUoKTtcblxuICAgICAgICBSZW5kZXJlckFuYWx5dGljcy5ldmVudCh7Y2F0ZWdvcnk6ICdhcHAnLCBhY3Rpb246ICd2ZXJzaW9uLScgKyB2ZXJzaW9ufSk7XG4gICAgICAgIFJlbmRlcmVyQW5hbHl0aWNzLmV2ZW50KHtjYXRlZ29yeTogJ3BsYXRmb3JtJywgYWN0aW9uOiBgJHtwbGF0Zm9ybX1gfSk7XG4gICAgICAgIFJlbmRlcmVyQW5hbHl0aWNzLmV2ZW50KHtjYXRlZ29yeTogJ3NjcmVlbicsIGFjdGlvbjogc2NyZWVufSk7XG4gICAgICAgIFJlbmRlcmVyQW5hbHl0aWNzLmV2ZW50KHtjYXRlZ29yeTogJ3J1bnRpbWUnLCBhY3Rpb246IHJ1bnRpbWV9KTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgZG9Mb2FkRXhhbXBsZURvY3MoKSB7XG5cbiAgICAgICAgY29uc3QgZG9Mb2FkID0gYXN5bmMgKCkgPT4ge1xuXG4gICAgICAgICAgICAvLyBUT0RPOiBhbHNvIHVzZSBzeXN0ZW0gcHJlZnMgZm9yIHRoaXMgdG9vLlxuXG4gICAgICAgICAgICBhd2FpdCBMb2NhbFByZWZzLm1hcmtPbmNlRXhlY3V0ZWQoTGlmZWN5Y2xlRXZlbnRzLkhBU19FWEFNUExFX0RPQ1MsIGFzeW5jICgpID0+IHtcblxuICAgICAgICAgICAgICAgIC8vIGxvYWQgdGhlIGV4YW1wbGUgZG9jcyBpbiB0aGUgc3RvcmUuLiBvbiB0aGUgZmlyc3QgbG9hZCB3ZVxuICAgICAgICAgICAgICAgIC8vIHNob3VsZCBwcm9iYWJseSBtYWtlIHN1cmUgdGhpcyBkb2Vzbid0IGhhcHBlbiBtb3JlIHRoYW4gb25jZVxuICAgICAgICAgICAgICAgIC8vIGFzIHRoZSB1c2VyIGNvdWxkIGp1c3QgZGVsZXRlIGFsbCB0aGUgZmlsZXMgaW4gdGhlaXIgcmVwby5cbiAgICAgICAgICAgICAgICAvLyBhd2FpdCBuZXdcbiAgICAgICAgICAgICAgICBjb25zdCBsb2FkRXhhbXBsZURvY3MgPSBuZXcgTG9hZEV4YW1wbGVEb2NzKHRoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIuZ2V0KCkpO1xuICAgICAgICAgICAgICAgIGF3YWl0IGxvYWRFeGFtcGxlRG9jcy5sb2FkKGRvY0luZm8gPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uVXBkYXRlZERvY0luZm8oZG9jSW5mbyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0sIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBsb2cuZGVidWcoXCJEb2NzIGFscmVhZHkgZXhpc3QgaW4gcmVwb1wiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGV2ZW50ID0+IHtcblxuICAgICAgICAgICAgaWYgKGV2ZW50LnN0YXRlID09PSAnaW5pdGlhbGl6ZWQnKSB7XG5cbiAgICAgICAgICAgICAgICBkb0xvYWQoKVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IGxvZy5lcnJvcihcIlVuYWJsZSB0byBsb2FkIGV4YW1wbGUgZG9jczogXCIsIGVycikpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgRG9jSW5mbyB1cGRhdGVzIHNlbnQgZnJvbSB2aWV3ZXJzLlxuICAgICAqL1xuICAgIHByaXZhdGUgb25VcGRhdGVkRG9jSW5mbyhkb2NJbmZvOiBJRG9jSW5mbyk6IHZvaWQge1xuXG4gICAgICAgIGNvbnN0IHBlcnNpc3RlbmNlTGF5ZXJQcm92aWRlciA9ICgpID0+IHRoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIuZ2V0KCk7XG5cbiAgICAgICAgY29uc3QgaGFuZGxlVXBkYXRlZERvY0luZm8gPSBhc3luYyAoKSA9PiB7XG5cbiAgICAgICAgICAgIGxvZy5pbmZvKFwiUmVjZWl2ZWQgRG9jSW5mbyB1cGRhdGVcIik7XG5cbiAgICAgICAgICAgIGNvbnN0IGRvY01ldGEgPSBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyLmdldCgpLmdldERvY01ldGEoZG9jSW5mby5maW5nZXJwcmludCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlcG9Eb2NNZXRhID0gUmVwb0RvY01ldGFzLmNvbnZlcnQocGVyc2lzdGVuY2VMYXllclByb3ZpZGVyLCBkb2NJbmZvLmZpbmdlcnByaW50LCBkb2NNZXRhKTtcblxuICAgICAgICAgICAgY29uc3QgdmFsaWRpdHkgPSBSZXBvRG9jTWV0YXMuaXNWYWxpZChyZXBvRG9jTWV0YSk7XG5cbiAgICAgICAgICAgIGlmICh2YWxpZGl0eSA9PT0gJ3ZhbGlkJykge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5yZXBvRG9jSW5mb01hbmFnZXIudXBkYXRlRnJvbVJlcG9Eb2NNZXRhKGRvY0luZm8uZmluZ2VycHJpbnQsIHJlcG9Eb2NNZXRhKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gbmV3IFByb2dyZXNzVHJhY2tlcih7dG90YWw6IDEsIGlkOiAnZG9jLWluZm8tdXBkYXRlJ30pLnRlcm1pbmF0ZSgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5yZXBvRG9jSW5mb0xvYWRlci5kaXNwYXRjaEV2ZW50KHtcbiAgICAgICAgICAgICAgICAgICAgIG11dGF0aW9uczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRpb25UeXBlOiAnY3JlYXRlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmdlcnByaW50OiBkb2NJbmZvLmZpbmdlcnByaW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvRG9jTWV0YVxuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc1xuICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFRPRE86IHRlY2huaWNhbGx5IEkgZG9uJ3QgdGhpbmsgd2UgbmVlZCB0byB0ZXN0IGlmIHdlJ3JlXG4gICAgICAgICAgICAgICAgLy8gdXNpbmcgdGhlIGNsb3VkIGxheWVyIGFueW1vcmUgYXMgc3luY2hyb25pemVEb2NzIGlzIGEgbm9vcFxuICAgICAgICAgICAgICAgIC8vIGluIGFsbCBvdGhlciBkYXRhc3RvcmVzLlxuICAgICAgICAgICAgICAgIGNvbnN0IHBlcnNpc3RlbmNlTGF5ZXI6IFBlcnNpc3RlbmNlTGF5ZXIgPSB0aGlzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyLmdldCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKFBlcnNpc3RlbmNlTGF5ZXJUeXBlcy5nZXQoKSA9PT0gJ2Nsb3VkJykge1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhbmRsZVdyaXRlRG9jTWV0YSA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHBlcnNpc3RlbmNlTGF5ZXIuc3luY2hyb25pemVEb2NzKHtmaW5nZXJwcmludDogZG9jSW5mby5maW5nZXJwcmludCwgZG9jTWV0YX0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZVdyaXRlRG9jTWV0YSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IGxvZy5lcnJvcihcIlVuYWJsZSB0byB3cml0ZSBkb2NNZXRhIHRvIGRhdGFzdG9yZTogXCIsIGVycikpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgbG9nLndhcm4oYFdlIHdlcmUgZ2l2ZW4gYW4gaW52YWxpZCBEb2NJbmZvIHdoaWNoIHlpZWxkZWQgYSBicm9rZW4gUmVwb0RvY01ldGEgJHt2YWxpZGl0eX06IGAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgZG9jSW5mbywgcmVwb0RvY01ldGEpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICBoYW5kbGVVcGRhdGVkRG9jSW5mbygpXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IGxvZy5lcnJvcihcIlVuYWJsZSB0byB1cGRhdGUgZG9jIGluZm8gd2l0aCBmaW5nZXJwcmludDogXCIgKyBkb2NJbmZvLmZpbmdlcnByaW50LCBlcnIpKTtcblxuICAgIH1cblxufVxuXG4iXX0=