"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const react_1 = __importDefault(require("react"));
const Logger_1 = require("polar-shared/src/logger/Logger");
const Button_1 = __importDefault(require("reactstrap/lib/Button"));
const Input_1 = __importDefault(require("reactstrap/lib/Input"));
const SocialLinks_1 = require("../../util/SocialLinks");
const RendererAnalytics_1 = require("../../ga/RendererAnalytics");
const SplitLayout_1 = require("../../ui/split_layout/SplitLayout");
const SplitLayout_2 = require("../../ui/split_layout/SplitLayout");
const SplitLayoutRight_1 = require("../../ui/split_layout/SplitLayoutRight");
const react_select_1 = __importDefault(require("react-select"));
const Visibility_1 = require("polar-shared/src/datastore/Visibility");
const log = Logger_1.Logger.create();
class Styles {
}
Styles.ShareButton = {
    fontSize: '35px',
    marginTop: 'auto',
    marginBottom: 'auto',
    marginRight: '10px',
};
Styles.ShareImage = {
    maxHeight: '35px',
    maxWidth: '35px',
};
class ShareContentControl extends react_1.default.PureComponent {
    constructor(props) {
        super(props);
        this.onVisibilityChanged = this.onVisibilityChanged.bind(this);
        this.onDone = this.onDone.bind(this);
        this.sharedVia = this.sharedVia.bind(this);
        this.state = {
            visibility: this.props.visibility || Visibility_1.Visibility.PRIVATE
        };
        this.props.createShareLink()
            .then((shareLink) => {
            log.info("Share link resolved to: " + shareLink);
            this.setState(Object.assign(Object.assign({}, this.state), { shareLink }));
        })
            .catch(err => log.error("Unable to create share link: ", err));
    }
    render() {
        const visibility = this.state.visibility;
        const shareLink = this.state.shareLink || "";
        const VisibilityDescription = () => {
            if (visibility === 'private') {
                return react_1.default.createElement("p", null,
                    "Documents that are ",
                    react_1.default.createElement("b", null, "private"),
                    " may only be seen or edited by you and are not available to anyone else including search engines.");
            }
            else {
                return react_1.default.createElement("div", null,
                    react_1.default.createElement("p", null,
                        "Documents that are ",
                        react_1.default.createElement("b", null, "public"),
                        " are ",
                        react_1.default.createElement("i", null, "shared publicly on the Internet"),
                        " with anyone who has access to the URL including search engines. Only you can add annotations which appear on this URL. The user may add the document to their own document repository to add their own annotations."),
                    react_1.default.createElement("div", { className: "mt-1 mb-1" },
                        react_1.default.createElement("b", null, "Link to share:")),
                    react_1.default.createElement("div", { className: "mb-1" },
                        react_1.default.createElement(Input_1.default, { type: "text", className: "pl-1 pr-1", style: {
                                minWidth: '150px',
                                maxWidth: '650px',
                                fontSize: '14px'
                            }, onFocus: (event) => event.target.select(), defaultValue: shareLink })),
                    react_1.default.createElement("div", { className: "mt-2", style: {
                            display: 'flex'
                        } },
                        react_1.default.createElement("div", { className: "text-muted mt-auto mb-auto mr-2 " }, "Share link via:"),
                        react_1.default.createElement("a", { target: "_new", style: Styles.ShareButton, onClick: () => this.sharedVia('twitter'), title: "Twitter", href: SocialLinks_1.SocialLinks.createForTwitter(shareLink) },
                            react_1.default.createElement("img", { style: Styles.ShareImage, alt: "twitter", src: "/web/assets/logos/twitter.svg" })),
                        react_1.default.createElement("a", { target: "_new", style: Styles.ShareButton, onClick: () => this.sharedVia('gmail'), title: "GMail", href: SocialLinks_1.SocialLinks.createForGMail(shareLink) },
                            react_1.default.createElement("img", { style: Styles.ShareImage, alt: "GMail", src: "/web/assets/logos/gmail.svg" })),
                        react_1.default.createElement("a", { target: "_new", style: Styles.ShareButton, onClick: () => this.sharedVia('facebook'), title: "Facebook", href: SocialLinks_1.SocialLinks.createForFacebook(shareLink) },
                            react_1.default.createElement("img", { style: Styles.ShareImage, alt: "Facebook", src: "/web/assets/logos/facebook.svg" }))));
            }
        };
        const WebSharing = () => {
            return react_1.default.createElement("div", { className: "twitter-bootstrap-content" },
                react_1.default.createElement("div", { style: {
                        display: 'flex',
                        verticalAlign: 'top'
                    } },
                    react_1.default.createElement("div", { className: "p-1" },
                        react_1.default.createElement("div", { style: { display: 'block', whiteSpace: 'nowrap' }, className: "mt-2 mb-2" },
                            react_1.default.createElement(Button_1.default, { id: "sharing-button-private", color: colors.PRIVATE, outline: outlines.PRIVATE, size: "md", onClick: () => this.onVisibilityChanged(Visibility_1.Visibility.PRIVATE) },
                                react_1.default.createElement("span", { className: "mr-1" },
                                    react_1.default.createElement("i", { className: "fas fa-lock" })),
                                "Private"),
                            react_1.default.createElement(Button_1.default, { id: "sharing-button-public", color: colors.PUBLIC, outline: outlines.PUBLIC, size: "md", onClick: () => this.onVisibilityChanged(Visibility_1.Visibility.PUBLIC), className: "ml-2" },
                                react_1.default.createElement("span", { className: "mr-1" },
                                    react_1.default.createElement("i", { className: "fas fa-lock-open" })),
                                "Public")),
                        react_1.default.createElement("p", null,
                            "This document is currently ",
                            react_1.default.createElement("b", null, visibility),
                            "."),
                        react_1.default.createElement(VisibilityDescription, null),
                        react_1.default.createElement("div", { className: "mt-1 mb-1" },
                            "TODO: - only accept input that looks like an email address -",
                            react_1.default.createElement(react_select_1.default, { isMulti: true, isClearable: true, autoFocus: true, classNamePrefix: "select", value: [], defaultValue: [], placeholder: "Enter names or email addresses" })),
                        react_1.default.createElement("div", { className: "text-right" },
                            react_1.default.createElement(Button_1.default, { id: "sharing-button-ok", color: "secondary", size: "sm", onClick: () => this.onDone(), className: "ml-1" }, "Done")))));
        };
        const NoSharingEnabled = () => {
            return react_1.default.createElement("div", { className: "twitter-bootstrap-content p-2" },
                react_1.default.createElement(SplitLayout_1.SplitLayout, null,
                    react_1.default.createElement(SplitLayout_2.SplitLayoutLeft, null,
                        react_1.default.createElement("h3", null, "Enable Cloud Sync"),
                        react_1.default.createElement("p", null, "Cloud Sync must be enabled for the Polar desktop app to work with sharing.")),
                    react_1.default.createElement(SplitLayoutRight_1.SplitLayoutRight, null,
                        react_1.default.createElement("i", { className: "fas fa-unlink text-danger", style: { fontSize: '75px' } }))));
        };
        const outlines = {
            PRIVATE: visibility !== Visibility_1.Visibility.PRIVATE,
            PUBLIC: visibility !== Visibility_1.Visibility.PUBLIC,
        };
        const colors = {
            PRIVATE: visibility === Visibility_1.Visibility.PRIVATE ? 'primary' : 'secondary',
            PUBLIC: visibility === Visibility_1.Visibility.PUBLIC ? 'primary' : 'secondary'
        };
        if (this.props.datastoreCapabilities.networkLayers.has('web')) {
            return react_1.default.createElement(WebSharing, null);
        }
        else {
            return react_1.default.createElement(NoSharingEnabled, null);
        }
    }
    onVisibilityChanged(visibility) {
        if (visibility === this.state.visibility) {
            return;
        }
        this.props.onVisibilityChanged(visibility)
            .then(() => {
            this.setState({ visibility });
        })
            .catch(err => log.error("Unable to change visibility: ", err));
    }
    sharedVia(platform) {
        RendererAnalytics_1.RendererAnalytics.event({ category: 'shared-via', action: platform });
    }
    onDone() {
        RendererAnalytics_1.RendererAnalytics.event({ category: 'sharing', action: this.state.visibility });
        this.props.onDone();
    }
}
exports.ShareContentControl = ShareContentControl;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2hhcmVDb250ZW50Q29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlNoYXJlQ29udGVudENvbnRyb2wudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0Esa0RBQTBCO0FBQzFCLDJEQUFzRDtBQUN0RCxtRUFBMkM7QUFFM0MsaUVBQXlDO0FBQ3pDLHdEQUFtRDtBQUNuRCxrRUFBNkQ7QUFDN0QsbUVBQThEO0FBQzlELG1FQUFrRTtBQUNsRSw2RUFBd0U7QUFDeEUsZ0VBQTJDO0FBQzNDLHNFQUFpRTtBQUVqRSxNQUFNLEdBQUcsR0FBRyxlQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7QUFFNUIsTUFBTSxNQUFNOztBQUVNLGtCQUFXLEdBQXdCO0lBQzdDLFFBQVEsRUFBRSxNQUFNO0lBQ2hCLFNBQVMsRUFBRSxNQUFNO0lBQ2pCLFlBQVksRUFBRSxNQUFNO0lBQ3BCLFdBQVcsRUFBRSxNQUFNO0NBQ3RCLENBQUM7QUFFWSxpQkFBVSxHQUF3QjtJQUM1QyxTQUFTLEVBQUUsTUFBTTtJQUNqQixRQUFRLEVBQUUsTUFBTTtDQUNuQixDQUFDO0FBSU4sTUFBYSxtQkFBb0IsU0FBUSxlQUFLLENBQUMsYUFBNkI7SUFFeEUsWUFBWSxLQUFhO1FBQ3JCLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUViLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9ELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUUzQyxJQUFJLENBQUMsS0FBSyxHQUFHO1lBRVQsVUFBVSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxJQUFJLHVCQUFVLENBQUMsT0FB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TUFBTSxFQUFFLENBQUM7SUFDeEIsQ0FBQztDQUVKO0FBaFNELGtEQWdTQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCByZWFjdC9uby1tdWx0aS1jb21wOiAwLCByZWFjdC9wcm9wLXR5cGVzOiAwICovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtMb2dnZXJ9IGZyb20gJ3BvbGFyLXNoYXJlZC9zcmMvbG9nZ2VyL0xvZ2dlcic7XG5pbXBvcnQgQnV0dG9uIGZyb20gJ3JlYWN0c3RyYXAvbGliL0J1dHRvbic7XG5pbXBvcnQge0RhdGFzdG9yZUNhcGFiaWxpdGllc30gZnJvbSAnLi4vLi4vZGF0YXN0b3JlL0RhdGFzdG9yZSc7XG5pbXBvcnQgSW5wdXQgZnJvbSAncmVhY3RzdHJhcC9saWIvSW5wdXQnO1xuaW1wb3J0IHtTb2NpYWxMaW5rc30gZnJvbSAnLi4vLi4vdXRpbC9Tb2NpYWxMaW5rcyc7XG5pbXBvcnQge1JlbmRlcmVyQW5hbHl0aWNzfSBmcm9tICcuLi8uLi9nYS9SZW5kZXJlckFuYWx5dGljcyc7XG5pbXBvcnQge1NwbGl0TGF5b3V0fSBmcm9tICcuLi8uLi91aS9zcGxpdF9sYXlvdXQvU3BsaXRMYXlvdXQnO1xuaW1wb3J0IHtTcGxpdExheW91dExlZnR9IGZyb20gJy4uLy4uL3VpL3NwbGl0X2xheW91dC9TcGxpdExheW91dCc7XG5pbXBvcnQge1NwbGl0TGF5b3V0UmlnaHR9IGZyb20gJy4uLy4uL3VpL3NwbGl0X2xheW91dC9TcGxpdExheW91dFJpZ2h0JztcbmltcG9ydCBDcmVhdGFibGVTZWxlY3QgZnJvbSAncmVhY3Qtc2VsZWN0JztcbmltcG9ydCB7VmlzaWJpbGl0eX0gZnJvbSBcInBvbGFyLXNoYXJlZC9zcmMvZGF0YXN0b3JlL1Zpc2liaWxpdHlcIjtcblxuY29uc3QgbG9nID0gTG9nZ2VyLmNyZWF0ZSgpO1xuXG5jbGFzcyBTdHlsZXMge1xuXG4gICAgcHVibGljIHN0YXRpYyBTaGFyZUJ1dHRvbjogUmVhY3QuQ1NTUHJvcGVydGllcyA9IHtcbiAgICAgICAgZm9udFNpemU6ICczNXB4JyxcbiAgICAgICAgbWFyZ2luVG9wOiAnYXV0bycsXG4gICAgICAgIG1hcmdpbkJvdHRvbTogJ2F1dG8nLFxuICAgICAgICBtYXJnaW5SaWdodDogJzEwcHgnLFxuICAgIH07XG5cbiAgICBwdWJsaWMgc3RhdGljIFNoYXJlSW1hZ2U6IFJlYWN0LkNTU1Byb3BlcnRpZXMgPSB7XG4gICAgICAgIG1heEhlaWdodDogJzM1cHgnLFxuICAgICAgICBtYXhXaWR0aDogJzM1cHgnLFxuICAgIH07XG5cbn1cblxuZXhwb3J0IGNsYXNzIFNoYXJlQ29udGVudENvbnRyb2wgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLm9uVmlzaWJpbGl0eUNoYW5nZWQgPSB0aGlzLm9uVmlzaWJpbGl0eUNoYW5nZWQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5vbkRvbmUgPSB0aGlzLm9uRG9uZS5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLnNoYXJlZFZpYSA9IHRoaXMuc2hhcmVkVmlhLmJpbmQodGhpcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIC8vIHRoZSBjdXJyZW50IHZpc2liaWxpdHkgb3IgcHJpdmF0ZSBieSBkZWZhdWx0LlxuICAgICAgICAgICAgdmlzaWJpbGl0eTogdGhpcy5wcm9wcy52aXNpYmlsaXR5IHx8IFZpc2liaWxpdHkuUFJJVkFURVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucHJvcHMuY3JlYXRlU2hhcmVMaW5rKClcbiAgICAgICAgICAgIC50aGVuKChzaGFyZUxpbmspID0+IHtcbiAgICAgICAgICAgICAgICBsb2cuaW5mbyhcIlNoYXJlIGxpbmsgcmVzb2x2ZWQgdG86IFwiICsgc2hhcmVMaW5rKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsuLi50aGlzLnN0YXRlLCBzaGFyZUxpbmt9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IGxvZy5lcnJvcihcIlVuYWJsZSB0byBjcmVhdGUgc2hhcmUgbGluazogXCIsIGVycikpO1xuXG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlcigpIHtcblxuICAgICAgICBjb25zdCB2aXNpYmlsaXR5ID0gdGhpcy5zdGF0ZS52aXNpYmlsaXR5O1xuXG4gICAgICAgIGNvbnN0IHNoYXJlTGluayA9IHRoaXMuc3RhdGUuc2hhcmVMaW5rIHx8IFwiXCI7XG5cbiAgICAgICAgLy8gRklYTUUgaW5jbHVkZSB0aGUgdGFncyBmb3IgdGhlIGRvY3VtZW50IHRvbyB0aGlzIHdheSB3aGVuIHBlb3BsZVxuICAgICAgICAvLyBzZWFyY2ggdmlhIFR3aXR0ZXIgb3IgRmFjZWJvb2sgdGhlc2UgdGFncyBzaG93IHVwIGFuZCBzbyB3aWxsIHRoZVxuICAgICAgICAvLyBkb2NzIGZyb20gUG9sYXIgd2hlbiB0aGV5IGNsaWNrIHRocm91Z2guXG5cbiAgICAgICAgLy8gVE9ETzogaW5jbHVkZSBhIGxpbmsgYmFjayB0byB0aGUgbWFpbiBQb2xhciBhcHA/XG5cbiAgICAgICAgY29uc3QgVmlzaWJpbGl0eURlc2NyaXB0aW9uID0gKCkgPT4ge1xuXG4gICAgICAgICAgICBpZiAodmlzaWJpbGl0eSA9PT0gJ3ByaXZhdGUnKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gPHA+RG9jdW1lbnRzIHRoYXQgYXJlIDxiPnByaXZhdGU8L2I+IG1heSBvbmx5IGJlIHNlZW4gb3JcbiAgICAgICAgICAgICAgICAgICAgZWRpdGVkIGJ5IHlvdSBhbmQgYXJlIG5vdCBhdmFpbGFibGUgdG8gYW55b25lIGVsc2UgaW5jbHVkaW5nXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaCBlbmdpbmVzLlxuICAgICAgICAgICAgICAgIDwvcD47XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDxkaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgICAgICBEb2N1bWVudHMgdGhhdCBhcmUgPGI+cHVibGljPC9iPiBhcmUgPGk+c2hhcmVkIHB1YmxpY2x5XG4gICAgICAgICAgICAgICAgICAgICAgICBvbiB0aGUgSW50ZXJuZXQ8L2k+IHdpdGggYW55b25lIHdobyBoYXMgYWNjZXNzIHRvIHRoZVxuICAgICAgICAgICAgICAgICAgICAgICAgVVJMIGluY2x1ZGluZyBzZWFyY2ggZW5naW5lcy4gT25seSB5b3UgY2FuIGFkZFxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvbnMgd2hpY2ggYXBwZWFyIG9uIHRoaXMgVVJMLiBUaGUgdXNlciBtYXkgYWRkXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGUgZG9jdW1lbnQgdG8gdGhlaXIgb3duIGRvY3VtZW50IHJlcG9zaXRvcnkgdG8gYWRkXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGVpciBvd24gYW5ub3RhdGlvbnMuXG4gICAgICAgICAgICAgICAgICAgIDwvcD5cblxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm10LTEgbWItMVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGI+TGluayB0byBzaGFyZTo8L2I+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibWItMVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPElucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJwbC0xIHByLTFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbldpZHRoOiAnMTUwcHgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aDogJzY1MHB4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICcxNHB4J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRm9jdXM9eyhldmVudCkgPT4gZXZlbnQudGFyZ2V0LnNlbGVjdCgpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZT17c2hhcmVMaW5rfT48L0lucHV0PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm10LTJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4J1xuICAgICAgICAgICAgICAgICAgICAgICAgIH19PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtbXV0ZWQgbXQtYXV0byBtYi1hdXRvIG1yLTIgXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hhcmUgbGluayB2aWE6XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPGEgdGFyZ2V0PVwiX25ld1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17U3R5bGVzLlNoYXJlQnV0dG9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy5zaGFyZWRWaWEoJ3R3aXR0ZXInKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPVwiVHdpdHRlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBocmVmPXtTb2NpYWxMaW5rcy5jcmVhdGVGb3JUd2l0dGVyKHNoYXJlTGluayl9PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBzdHlsZT17U3R5bGVzLlNoYXJlSW1hZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQ9XCJ0d2l0dGVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYz1cIi93ZWIvYXNzZXRzL2xvZ29zL3R3aXR0ZXIuc3ZnXCIvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2E+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIHRhcmdldD1cIl9uZXdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e1N0eWxlcy5TaGFyZUJ1dHRvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMuc2hhcmVkVmlhKCdnbWFpbCcpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XCJHTWFpbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBocmVmPXtTb2NpYWxMaW5rcy5jcmVhdGVGb3JHTWFpbChzaGFyZUxpbmspfT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbWcgc3R5bGU9e1N0eWxlcy5TaGFyZUltYWdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0PVwiR01haWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPVwiL3dlYi9hc3NldHMvbG9nb3MvZ21haWwuc3ZnXCIvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2E+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIHRhcmdldD1cIl9uZXdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e1N0eWxlcy5TaGFyZUJ1dHRvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMuc2hhcmVkVmlhKCdmYWNlYm9vaycpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XCJGYWNlYm9va1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBocmVmPXtTb2NpYWxMaW5rcy5jcmVhdGVGb3JGYWNlYm9vayhzaGFyZUxpbmspfT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbWcgc3R5bGU9e1N0eWxlcy5TaGFyZUltYWdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0PVwiRmFjZWJvb2tcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPVwiL3dlYi9hc3NldHMvbG9nb3MvZmFjZWJvb2suc3ZnXCIvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2E+XG5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBXZWJTaGFyaW5nID0gKCkgPT4ge1xuXG4gICAgICAgICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJ0d2l0dGVyLWJvb3RzdHJhcC1jb250ZW50XCI+XG5cbiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ3RvcCdcbiAgICAgICAgICAgICAgICB9fT5cblxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInAtMVwiPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7ZGlzcGxheTogJ2Jsb2NrJywgd2hpdGVTcGFjZTogJ25vd3JhcCd9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJtdC0yIG1iLTJcIj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gaWQ9XCJzaGFyaW5nLWJ1dHRvbi1wcml2YXRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPXtjb2xvcnMuUFJJVkFURX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dGxpbmU9e291dGxpbmVzLlBSSVZBVEV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplPVwibWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy5vblZpc2liaWxpdHlDaGFuZ2VkKFZpc2liaWxpdHkuUFJJVkFURSl9PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm1yLTFcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzTmFtZT1cImZhcyBmYS1sb2NrXCI+PC9pPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJpdmF0ZVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIGlkPVwic2hhcmluZy1idXR0b24tcHVibGljXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPXtjb2xvcnMuUFVCTElDfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0bGluZT17b3V0bGluZXMuUFVCTElDfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT1cIm1kXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMub25WaXNpYmlsaXR5Q2hhbmdlZChWaXNpYmlsaXR5LlBVQkxJQyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJtbC0yXCI+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXItMVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPVwiZmFzIGZhLWxvY2stb3BlblwiPjwvaT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFB1YmxpY1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIGRvY3VtZW50IGlzIGN1cnJlbnRseSA8Yj57dmlzaWJpbGl0eX08L2I+LlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9wPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8VmlzaWJpbGl0eURlc2NyaXB0aW9uLz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtdC0xIG1iLTFcIj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRPRE86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gb25seSBhY2NlcHQgaW5wdXQgdGhhdCBsb29rcyBsaWtlIGFuIGVtYWlsIGFkZHJlc3NcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPENyZWF0YWJsZVNlbGVjdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc011bHRpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xlYXJhYmxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Gb2N1c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvbktleURvd249e2V2ZW50ID0+IHRoaXMub25LZXlEb3duKGV2ZW50KX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xhc3NOYW1lPVwiYmFzaWMtbXVsdGktc2VsZWN0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lUHJlZml4PVwic2VsZWN0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25DaGFuZ2U9eyhzZWxlY3RlZE9wdGlvbnMpID0+IHRoaXMuaGFuZGxlQ2hhbmdlKHNlbGVjdGVkT3B0aW9ucyBhcyBUYWdPcHRpb25bXSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtbXX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlPXtbXX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJFbnRlciBuYW1lcyBvciBlbWFpbCBhZGRyZXNzZXNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvcHRpb25zPXthdmFpbGFibGVUYWdPcHRpb25zfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9DcmVhdGFibGVTZWxlY3Q+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtcmlnaHRcIj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gaWQ9XCJzaGFyaW5nLWJ1dHRvbi1va1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj1cInNlY29uZGFyeVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplPVwic21cIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy5vbkRvbmUoKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm1sLTFcIj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEb25lXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPC9kaXY+O1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgTm9TaGFyaW5nRW5hYmxlZCA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cInR3aXR0ZXItYm9vdHN0cmFwLWNvbnRlbnQgcC0yXCI+XG5cbiAgICAgICAgICAgICAgICA8U3BsaXRMYXlvdXQ+XG5cbiAgICAgICAgICAgICAgICAgICAgPFNwbGl0TGF5b3V0TGVmdD5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPGgzPkVuYWJsZSBDbG91ZCBTeW5jPC9oMz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xvdWQgU3luYyBtdXN0IGJlIGVuYWJsZWQgZm9yIHRoZSBQb2xhciBkZXNrdG9wIGFwcCB0byB3b3JrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBzaGFyaW5nLlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9wPlxuXG4gICAgICAgICAgICAgICAgICAgIDwvU3BsaXRMYXlvdXRMZWZ0PlxuXG4gICAgICAgICAgICAgICAgICAgIDxTcGxpdExheW91dFJpZ2h0PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPVwiZmFzIGZhLXVubGluayB0ZXh0LWRhbmdlclwiIHN0eWxlPXt7Zm9udFNpemU6ICc3NXB4J319PjwvaT5cbiAgICAgICAgICAgICAgICAgICAgPC9TcGxpdExheW91dFJpZ2h0PlxuXG4gICAgICAgICAgICAgICAgPC9TcGxpdExheW91dD5cblxuICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG91dGxpbmVzID0ge1xuICAgICAgICAgICAgUFJJVkFURTogdmlzaWJpbGl0eSAhPT0gVmlzaWJpbGl0eS5QUklWQVRFLFxuICAgICAgICAgICAgUFVCTElDOiB2aXNpYmlsaXR5ICE9PSBWaXNpYmlsaXR5LlBVQkxJQyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBjb2xvcnMgPSB7XG4gICAgICAgICAgICBQUklWQVRFOiB2aXNpYmlsaXR5ID09PSBWaXNpYmlsaXR5LlBSSVZBVEUgPyAncHJpbWFyeScgOiAnc2Vjb25kYXJ5JyxcbiAgICAgICAgICAgIFBVQkxJQzogdmlzaWJpbGl0eSA9PT0gVmlzaWJpbGl0eS5QVUJMSUMgPyAncHJpbWFyeScgOiAnc2Vjb25kYXJ5J1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmRhdGFzdG9yZUNhcGFiaWxpdGllcy5uZXR3b3JrTGF5ZXJzLmhhcygnd2ViJykpIHtcbiAgICAgICAgICAgIHJldHVybiA8V2ViU2hhcmluZy8+O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDxOb1NoYXJpbmdFbmFibGVkLz47XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHByaXZhdGUgb25WaXNpYmlsaXR5Q2hhbmdlZCh2aXNpYmlsaXR5OiBWaXNpYmlsaXR5KSB7XG5cbiAgICAgICAgaWYgKHZpc2liaWxpdHkgPT09IHRoaXMuc3RhdGUudmlzaWJpbGl0eSkge1xuICAgICAgICAgICAgLy8gYWxyZWFkeSBkb25lLi4uXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnByb3BzLm9uVmlzaWJpbGl0eUNoYW5nZWQodmlzaWJpbGl0eSlcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHt2aXNpYmlsaXR5fSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBsb2cuZXJyb3IoXCJVbmFibGUgdG8gY2hhbmdlIHZpc2liaWxpdHk6IFwiLCBlcnIpKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgc2hhcmVkVmlhKHBsYXRmb3JtOiBTaGFyZVBsYXRmb3JtKSB7XG4gICAgICAgIFJlbmRlcmVyQW5hbHl0aWNzLmV2ZW50KHtjYXRlZ29yeTogJ3NoYXJlZC12aWEnLCBhY3Rpb246IHBsYXRmb3JtfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkRvbmUoKSB7XG4gICAgICAgIFJlbmRlcmVyQW5hbHl0aWNzLmV2ZW50KHtjYXRlZ29yeTogJ3NoYXJpbmcnLCBhY3Rpb246IHRoaXMuc3RhdGUudmlzaWJpbGl0eX0pO1xuICAgICAgICB0aGlzLnByb3BzLm9uRG9uZSgpO1xuICAgIH1cblxufVxuXG5pbnRlcmZhY2UgSVByb3BzIHtcblxuICAgIHJlYWRvbmx5IGRhdGFzdG9yZUNhcGFiaWxpdGllczogRGF0YXN0b3JlQ2FwYWJpbGl0aWVzO1xuXG4gICAgcmVhZG9ubHkgdmlzaWJpbGl0eT86IFZpc2liaWxpdHk7XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1c2VkIHRvIGNyZWF0ZSB0aGUgbGluayB3aGVuIHdlJ3JlIHNoYXJpbmcgdGhlIGRvY3VtZW50XG4gICAgICogcHVibGljbHkuXG4gICAgICovXG4gICAgcmVhZG9ubHkgY3JlYXRlU2hhcmVMaW5rOiAoKSA9PiBQcm9taXNlPHN0cmluZyB8IHVuZGVmaW5lZD47XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgdmlzaWJpbGl0eSBmb3IgdGhpcyBjb250ZW50IGhhcyBjaGFuZ2VkLlxuICAgICAqL1xuICAgIHJlYWRvbmx5IG9uVmlzaWJpbGl0eUNoYW5nZWQ6ICh2aXNpYmlsaXR5OiBWaXNpYmlsaXR5KSA9PiBQcm9taXNlPHZvaWQ+O1xuXG4gICAgcmVhZG9ubHkgb25Eb25lOiAoKSA9PiB2b2lkO1xuXG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuXG4gICAgcmVhZG9ubHkgdmlzaWJpbGl0eTogVmlzaWJpbGl0eTtcblxuICAgIC8vIHRoZSByZXNvbHZlZCBzaGFyZSBsaW5rXG4gICAgcmVhZG9ubHkgc2hhcmVMaW5rPzogc3RyaW5nO1xuXG59XG5cbmV4cG9ydCB0eXBlIFNoYXJlUGxhdGZvcm0gPSAndHdpdHRlcicgfCAnZmFjZWJvb2snIHwgJ2dtYWlsJztcbiJdfQ==