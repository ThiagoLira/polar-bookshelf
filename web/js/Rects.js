"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Rect_1 = require("./Rect");
const Preconditions_1 = require("polar-shared/src/Preconditions");
const Styles_1 = require("./util/Styles");
const Objects_1 = require("polar-shared/src/util/Objects");
class Rects {
    static isVisible(rect) {
        return rect.height > 0 && rect.width > 0;
    }
    static scale(rect, scale) {
        Preconditions_1.Preconditions.assertPresent(rect, "rect");
        rect = Rects.validate(rect);
        rect = new Rect_1.Rect(rect);
        const result = {};
        Objects_1.Objects.typedKeys(rect).forEach(key => {
            result[key] = Math.floor(rect[key] * scale);
        });
        return Rects.validate(result);
    }
    static validate(rect) {
        Preconditions_1.Preconditions.assertPresent(rect.left, "left");
        Preconditions_1.Preconditions.assertPresent(rect.top, "top");
        Preconditions_1.Preconditions.assertPresent(rect.width, "width");
        Preconditions_1.Preconditions.assertPresent(rect.height, "height");
        Preconditions_1.Preconditions.assertPresent(rect.bottom, "bottom");
        Preconditions_1.Preconditions.assertPresent(rect.right, "right");
        Preconditions_1.Preconditions.assertNumber(rect.left, "left");
        Preconditions_1.Preconditions.assertNumber(rect.top, "top");
        Preconditions_1.Preconditions.assertNumber(rect.width, "width");
        Preconditions_1.Preconditions.assertNumber(rect.height, "height");
        Preconditions_1.Preconditions.assertNumber(rect.bottom, "bottom");
        Preconditions_1.Preconditions.assertNumber(rect.right, "right");
        if (!(rect instanceof Rect_1.Rect)) {
            return new Rect_1.Rect(rect);
        }
        else {
            return rect;
        }
    }
    static relativeTo(point, rect) {
        rect = Rects.validate(rect);
        rect = new Rect_1.Rect(rect);
        rect.left = rect.left + point.x;
        rect.top = rect.top + point.y;
        rect.right = rect.right + point.x;
        rect.bottom = rect.bottom + point.y;
        return Rects.validate(rect);
    }
    static move(rect, dir, absolute) {
        rect = new Rect_1.Rect(rect);
        if (absolute) {
            if (dir.x !== undefined) {
                rect.left = dir.x;
                rect.right = rect.left + rect.width;
            }
            if (dir.y !== undefined) {
                rect.top = dir.y;
                rect.bottom = rect.top + rect.height;
            }
        }
        else {
            if (dir.x !== undefined) {
                rect.left = rect.left + dir.x;
                rect.right = rect.right + dir.x;
            }
            if (dir.y !== undefined) {
                rect.bottom = rect.bottom + dir.y;
                rect.top = rect.top + dir.y;
            }
        }
        return Rects.validate(rect);
    }
    static intersect(a, b) {
        return (a.left <= b.right &&
            b.left <= a.right &&
            a.top <= b.bottom &&
            b.top <= a.bottom);
    }
    static overlap(a, b) {
        return a.toLine("x").overlaps(b.toLine("x")) || a.toLine("y").overlaps(b.toLine("y"));
    }
    static intersection(a, b) {
        return Rects.createFromBasicRect({
            top: Math.max(a.top, b.top),
            bottom: Math.min(a.bottom, b.bottom),
            left: Math.max(a.left, b.left),
            right: Math.min(a.right, b.right),
        });
    }
    static intersectedPositions(a, b) {
        let result = [];
        if (_interval(a.left, b.right, a.right)) {
            result.push("left");
        }
        if (_interval(a.left, b.left, a.right)) {
            result.push("right");
        }
        if (_interval(a.top, b.bottom, a.bottom)) {
            result.push("top");
        }
        if (_interval(a.top, b.top, a.bottom)) {
            result.push("bottom");
        }
        return result;
    }
    static relativePositions(a, b) {
        Rects.validate(a);
        Rects.validate(b);
        let result = {};
        result.top = Math.abs(a.top - b.bottom);
        result.bottom = Math.abs(a.bottom - b.top);
        result.left = Math.abs(a.left - a.right);
        result.right = Math.abs(a.right - b.left);
        return result;
    }
    static subtract(a, b) {
        a = Rects.validate(a);
        b = Rects.validate(b);
        let keys = ["left", "top", "right", "bottom", "width", "height"];
        let result = {};
        keys.forEach(key => {
            result[key] = a[key] - b[key];
        });
        return new Rect_1.Rect(result);
    }
    static add(a, b) {
        a = Rects.validate(a);
        b = Rects.validate(b);
        let keys = ["left", "top", "right", "bottom", "width", "height"];
        let result = {};
        keys.forEach(key => {
            result[key] = a[key] + b[key];
        });
        return new Rect_1.Rect(result);
    }
    static perc(a, b) {
        if (a.width > b.width || a.height > b.height) {
            throw new Error(`Dimensions invalid ${a.dimensions} vs ${b.dimensions}`);
        }
        let result = {
            left: 100 * (a.left / b.width),
            right: 100 * (a.right / b.width),
            top: 100 * (a.top / b.height),
            bottom: 100 * (a.bottom / b.height)
        };
        return Rects.createFromBasicRect(result);
    }
    static createFromBasicRect(rect) {
        rect = new Rect_1.Rect(rect);
        if (!rect.bottom && "top" in rect && "height" in rect) {
            rect.bottom = rect.top + rect.height;
        }
        if (!rect.right && "left" in rect && "width" in rect) {
            rect.right = rect.left + rect.width;
        }
        if (!rect.height && "bottom" in rect && "top" in rect) {
            rect.height = rect.bottom - rect.top;
        }
        if (!rect.width && "right" in rect && "left" in rect) {
            rect.width = rect.right - rect.left;
        }
        return Rects.validate(new Rect_1.Rect(rect));
    }
    static createFromLines(xAxis, yAxis) {
        Preconditions_1.Preconditions.assertNotNull(xAxis, "xAxis");
        Preconditions_1.Preconditions.assertNotNull(yAxis, "yAxis");
        Preconditions_1.Preconditions.assertEqual(xAxis.axis, "x", "xAxis.axis");
        Preconditions_1.Preconditions.assertEqual(yAxis.axis, "y", "yAxis.axis");
        return Rects.createFromBasicRect({
            left: xAxis.start,
            width: xAxis.length,
            top: yAxis.start,
            height: yAxis.length
        });
    }
    static createFromOffset(element) {
        return Rects.createFromBasicRect({
            left: element.offsetLeft,
            top: element.offsetTop,
            width: element.offsetWidth,
            height: element.offsetHeight,
        });
    }
    static fromElementStyle(element) {
        let rect = {
            left: Styles_1.Styles.parsePX(element.style.left),
            top: Styles_1.Styles.parsePX(element.style.top),
            width: Styles_1.Styles.parsePX(element.style.width),
            height: Styles_1.Styles.parsePX(element.style.height)
        };
        return Rects.createFromBasicRect(rect);
    }
}
exports.Rects = Rects;
function _interval(min, point, max) {
    return min <= point && point <= max;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVjdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJSZWN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUE0QjtBQUM1QixrRUFBNkQ7QUFHN0QsMENBQXFDO0FBRXJDLDJEQUFzRDtBQUV0RCxNQUFhLEtBQUs7SUFRZCxNQUFNLENBQUMsU0FBUyxDQUFDLElBQWlDO1FBQzlDLE9BQU8sSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQU9NLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBa0IsRUFBRSxLQUFhO1FBRWpELDZCQUFhLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUcxQyxJQUFJLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU1QixJQUFJLEdBQUcsSUFBSSxXQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFdEIsTUFBTSxNQUFNLEdBQVEsRUFBRSxDQUFDO1FBRXZCLGlCQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNsQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBVSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7UUFDekQsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFbEMsQ0FBQztJQVlNLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBUztRQUU1Qiw2QkFBYSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQy9DLDZCQUFhLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDN0MsNkJBQWEsQ0FB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QyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7WUFDdEMsS0FBSyxFQUFFLGVBQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7WUFDMUMsTUFBTSxFQUFFLGVBQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7U0FFL0MsQ0FBQztRQUVGLE9BQU8sS0FBSyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTNDLENBQUM7Q0FFSjtBQTdhRCxzQkE2YUM7QUFXRCxTQUFTLFNBQVMsQ0FBQyxHQUFXLEVBQUUsS0FBYSxFQUFFLEdBQVc7SUFFdEQsT0FBTyxHQUFHLElBQUksS0FBSyxJQUFJLEtBQUssSUFBSSxHQUFHLENBQUM7QUFDeEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7UmVjdH0gZnJvbSAnLi9SZWN0JztcbmltcG9ydCB7UHJlY29uZGl0aW9uc30gZnJvbSAncG9sYXItc2hhcmVkL3NyYy9QcmVjb25kaXRpb25zJztcbmltcG9ydCB7UG9pbnR9IGZyb20gJy4vUG9pbnQnO1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL3V0aWwvTGluZSc7XG5pbXBvcnQge1N0eWxlc30gZnJvbSAnLi91dGlsL1N0eWxlcyc7XG5pbXBvcnQge0lSZWN0fSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL3V0aWwvcmVjdHMvSVJlY3QnO1xuaW1wb3J0IHtPYmplY3RzfSBmcm9tIFwicG9sYXItc2hhcmVkL3NyYy91dGlsL09iamVjdHNcIjtcblxuZXhwb3J0IGNsYXNzIFJlY3RzIHtcblxuICAgIC8qKlxuICAgICAqIE1ha2Ugc3VyZSB0aGUgcmVjdCBpcyB2aXNpYmxlLiBJZiBpdCBoYXMgYSB6ZXJvIHdpZHRoIG9yIGhlaWdodCBpdCdzXG4gICAgICogbm90IHZpc2libGUuXG4gICAgICogQHBhcmFtIHJlY3Qge1JlY3QgfCBET01SZWN0fVxuICAgICAqIEByZXR1cm4gYm9vbGVhbiBUcnVlIHdoZW4gdGhlIHJlY3QgaXMgdmlzaWJsZS5cbiAgICAgKi9cbiAgICBzdGF0aWMgaXNWaXNpYmxlKHJlY3Q6IFJlY3QgfCBET01SZWN0IHwgQ2xpZW50UmVjdCkge1xuICAgICAgICByZXR1cm4gcmVjdC5oZWlnaHQgPiAwICYmIHJlY3Qud2lkdGggPiAwO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNjYWxlIHRoZSByZWN0IGJhc2VkIG9uIHRoZSBjdXJyZW50IHZhbHVlcyBhbmQgdGhlIGdpdmVuIHNjYWxlLlxuICAgICAqIEBwYXJhbSByZWN0IHtSZWN0fVxuICAgICAqIEBwYXJhbSBzY2FsZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgc2NhbGUocmVjdDogUmVjdCB8IElSZWN0LCBzY2FsZTogbnVtYmVyKSB7XG5cbiAgICAgICAgUHJlY29uZGl0aW9ucy5hc3NlcnRQcmVzZW50KHJlY3QsIFwicmVjdFwiKTtcblxuICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGlucHV0IGlzIHZhbGlkIGJlZm9yZSB3ZSB3b3JrIG9uIGl0LlxuICAgICAgICByZWN0ID0gUmVjdHMudmFsaWRhdGUocmVjdCk7XG5cbiAgICAgICAgcmVjdCA9IG5ldyBSZWN0KHJlY3QpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdDogYW55ID0ge307XG5cbiAgICAgICAgT2JqZWN0cy50eXBlZEtleXMocmVjdCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBNYXRoLmZsb29yKDxudW1iZXI+IHJlY3Rba2V5XSAqIHNjYWxlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIFJlY3RzLnZhbGlkYXRlKHJlc3VsdCk7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYWtlIHN1cmUgdGhlIGdpdmVuIHJlY3QgaGFzIGFsbCB0aGUgY29ycmVjdCBwcm9wZXJ0aWVzIGFuZCB0aGVuIHJldHVyblxuICAgICAqIHRoZSByZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHJlY3Qge09iamVjdH0gQSByZWN0LWxpa2Ugb2JqZWN0IHdpdGggdGhlIGZpZWxkcyB3ZSBuZWVkIHRvIHdvcmtcbiAgICAgKiAgICAgICAgd2l0aC4gIElmIGl0J3Mgbm90IGFjdHVhbGx5IGFuIGluc3RhbmNlIG9mIFJlY3Qgd2UgY3JlYXRlIGEgcmVjdFxuICAgICAqICAgICAgICBhbmQgcmV0dXJuIHRoYXQgaW5zdGVhZC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge1JlY3R9XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyB2YWxpZGF0ZShyZWN0OiBhbnkpOiBSZWN0IHtcblxuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydFByZXNlbnQocmVjdC5sZWZ0LCBcImxlZnRcIik7XG4gICAgICAgIFByZWNvbmRpdGlvbnMuYXNzZXJ0UHJlc2VudChyZWN0LnRvcCwgXCJ0b3BcIik7XG4gICAgICAgIFByZWNvbmRpdGlvbnMuYXNzZXJ0UHJlc2VudChyZWN0LndpZHRoLCBcIndpZHRoXCIpO1xuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydFByZXNlbnQocmVjdC5oZWlnaHQsIFwiaGVpZ2h0XCIpO1xuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydFByZXNlbnQocmVjdC5ib3R0b20sIFwiYm90dG9tXCIpO1xuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydFByZXNlbnQocmVjdC5yaWdodCwgXCJyaWdodFwiKTtcblxuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydE51bWJlcihyZWN0LmxlZnQsIFwibGVmdFwiKTtcbiAgICAgICAgUHJlY29uZGl0aW9ucy5hc3NlcnROdW1iZXIocmVjdC50b3AsIFwidG9wXCIpO1xuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydE51bWJlcihyZWN0LndpZHRoLCBcIndpZHRoXCIpO1xuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydE51bWJlcihyZWN0LmhlaWdodCwgXCJoZWlnaHRcIik7XG4gICAgICAgIFByZWNvbmRpdGlvbnMuYXNzZXJ0TnVtYmVyKHJlY3QuYm90dG9tLCBcImJvdHRvbVwiKTtcbiAgICAgICAgUHJlY29uZGl0aW9ucy5hc3NlcnROdW1iZXIocmVjdC5yaWdodCwgXCJyaWdodFwiKTtcblxuICAgICAgICBpZiAoISAocmVjdCBpbnN0YW5jZW9mIFJlY3QpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY3QocmVjdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcmVjdDtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNzdW1lIHRoYXQgdGhlIGdpdmVuIHJlY3QgaXMgcmVsYXRpdmUgdG8gdGhlIHBvaW50IGFuZCByZXR1cm4gdGhlIG5ld1xuICAgICAqIHJlY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcG9pbnQge1BvaW50fVxuICAgICAqIEBwYXJhbSByZWN0IHtSZWN0fVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVsYXRpdmVUbyhwb2ludDogUG9pbnQsIHJlY3Q6IFJlY3QpIHtcblxuICAgICAgICByZWN0ID0gUmVjdHMudmFsaWRhdGUocmVjdCk7XG4gICAgICAgIHJlY3QgPSBuZXcgUmVjdChyZWN0KTtcblxuICAgICAgICByZWN0LmxlZnQgPSByZWN0LmxlZnQgKyBwb2ludC54O1xuICAgICAgICByZWN0LnRvcCA9IHJlY3QudG9wICsgcG9pbnQueTtcblxuICAgICAgICByZWN0LnJpZ2h0ID0gcmVjdC5yaWdodCArIHBvaW50Lng7XG4gICAgICAgIHJlY3QuYm90dG9tID0gcmVjdC5ib3R0b20gKyBwb2ludC55O1xuXG4gICAgICAgIHJldHVybiBSZWN0cy52YWxpZGF0ZShyZWN0KTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFzc3VtZSB0aGF0IHRoZSBnaXZlbiByZWN0IGlzIHJlbGF0aXZlIHRvIHRoZSBwb2ludCBhbmQgcmV0dXJuIHRoZSBuZXdcbiAgICAgKiByZWN0LlxuICAgICAqXG4gICAgICogVGhpcyBhZGp1c3QgQUxMIHByb3BlcnRpZXMgaW5jbHVkaW5nIHRvcCwgbGVmdCwgYm90dG9tLCByaWdodFxuICAgICAqXG4gICAgICogQHBhcmFtIHJlY3Qge1JlY3R9IFRoZSByZWN0IHRvIG1vdmUuXG4gICAgICogQHBhcmFtIGRpciB7T2JqZWN0fSBNb3ZlIHRoZSByZWN0IGluIHRoZSBnaXZlbiBkaXIgKGRpcmVjdGlvbikgaW4gdGhlXG4gICAgICogeCBhbmQgeSBwbGFuZS4gIFRoZSBkaXIueCBhbmQgZGlyLnkgc3BlY2lmeSBob3cgbXVjaCB0byBtb3ZlIHRoZSByZWN0LlxuICAgICAqIEBwYXJhbSBhYnNvbHV0ZSB7Ym9vbGVhbn0gV2hlbiB0cnVlLCBtb3ZlIHRvIHRoZSBhYnNvbHV0ZSBwb3NpdGlvbiwgbm90XG4gICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZS5cbiAgICAgKiBAcmV0dXJuIHtSZWN0fVxuICAgICAqL1xuICAgIHN0YXRpYyBtb3ZlKHJlY3Q6IFJlY3QsIGRpcjogRGlyZWN0aW9uLCBhYnNvbHV0ZTogYm9vbGVhbikge1xuXG4gICAgICAgIHJlY3QgPSBuZXcgUmVjdChyZWN0KTtcblxuICAgICAgICBpZiAoYWJzb2x1dGUpIHtcblxuICAgICAgICAgICAgaWYgKGRpci54ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZWN0LmxlZnQgPSBkaXIueDtcbiAgICAgICAgICAgICAgICByZWN0LnJpZ2h0ID0gcmVjdC5sZWZ0ICsgcmVjdC53aWR0aDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRpci55ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZWN0LnRvcCA9IGRpci55O1xuICAgICAgICAgICAgICAgIHJlY3QuYm90dG9tID0gcmVjdC50b3AgKyByZWN0LmhlaWdodDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAvLyBUT0RPOiBJIGNvdWxkIGp1c3QgY29udmVydCB0aGUgcmVsYXRpdmUgcG9zaXRpb25zIHRvIGFic29sdXRlIHRvXG4gICAgICAgICAgICAvLyBjbGVhbiB1cCB0aGlzIGNvZGUgYSBiaXQuXG4gICAgICAgICAgICBpZiAoZGlyLnggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJlY3QubGVmdCA9IHJlY3QubGVmdCArIGRpci54O1xuICAgICAgICAgICAgICAgIHJlY3QucmlnaHQgPSByZWN0LnJpZ2h0ICsgZGlyLng7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkaXIueSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVjdC5ib3R0b20gPSByZWN0LmJvdHRvbSArIGRpci55O1xuICAgICAgICAgICAgICAgIHJlY3QudG9wID0gcmVjdC50b3AgKyBkaXIueTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFJlY3RzLnZhbGlkYXRlKHJlY3QpO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHR3byByZWN0cyBpbnRlcnNlY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYSB7UmVjdHxPYmplY3R9XG4gICAgICogQHBhcmFtIGIge1JlY3R8T2JqZWN0fVxuICAgICAqXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBzdGF0aWMgaW50ZXJzZWN0KGE6IFJlY3QsIGI6IFJlY3QpIHtcblxuICAgICAgICAvLyBUT0RPOiBpbnRlcm5hbGx5IHdlIHNob3VsZCBjb252ZXJ0IHRoZSBvYmplY3QgdG8gYSByZWN0IHNvIHdlIGNhblxuICAgICAgICAvLyB2YWxpZGF0ZSBpdC5cblxuICAgICAgICByZXR1cm4gKGEubGVmdCA8PSBiLnJpZ2h0ICYmXG4gICAgICAgICAgICAgICAgYi5sZWZ0IDw9IGEucmlnaHQgJiZcbiAgICAgICAgICAgICAgICBhLnRvcCA8PSBiLmJvdHRvbSAmJlxuICAgICAgICAgICAgICAgIGIudG9wIDw9IGEuYm90dG9tKVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHR3byByZWN0cyBvdmVybGFwLiBUaGlzIGluY2x1ZGVzIGludGVyc2VjdGlvbiBidXQgYWxzb1xuICAgICAqIGluY2x1ZGVzIG9uZSBjb21wbGV0ZWx5IHN3YWxsb3dpbmcgdGhlIG90aGVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIGEge1JlY3R9XG4gICAgICogQHBhcmFtIGIge1JlY3R9XG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgICAqL1xuICAgIHN0YXRpYyBvdmVybGFwKGE6IFJlY3QsIGI6IFJlY3QpIHtcbiAgICAgICAgcmV0dXJuIGEudG9MaW5lKFwieFwiKS5vdmVybGFwcyhiLnRvTGluZShcInhcIikpIHx8IGEudG9MaW5lKFwieVwiKS5vdmVybGFwcyhiLnRvTGluZShcInlcIikpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbXB1dGUgdGhlIGludGVyc2VjdGlvbiBvZiBhIGFuZCBiIGFzIGEgbmV3IHJlY3QuXG4gICAgICpcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhIHtSZWN0fVxuICAgICAqIEBwYXJhbSBiIHtSZWN0fVxuICAgICAqIEByZXR1cm4ge1JlY3R9XG4gICAgICovXG4gICAgc3RhdGljIGludGVyc2VjdGlvbihhOiBSZWN0LCBiOiBSZWN0KSB7XG5cbiAgICAgICAgLy8gVE9ETy9yZWZhY3Rvci4gIE1ha2UgZWFjaCBkaW1lbnNpb24gYSBsaW5lLCB0aGVuIGFkanVzdCB0aGUgbGluZS5cbiAgICAgICAgLy8gVGhpcyB3YXkgdGhlIHNhbWUgZnVuY3Rpb24gaXMgdXNlZCB0d2ljZSB3aXRoIGxlc3MgY29weS9wYXN0ZS5cblxuICAgICAgICByZXR1cm4gUmVjdHMuY3JlYXRlRnJvbUJhc2ljUmVjdCh7XG4gICAgICAgICAgICB0b3A6IE1hdGgubWF4KGEudG9wLCBiLnRvcCksXG4gICAgICAgICAgICBib3R0b206IE1hdGgubWluKGEuYm90dG9tLCBiLmJvdHRvbSksXG4gICAgICAgICAgICBsZWZ0OiBNYXRoLm1heChhLmxlZnQsIGIubGVmdCksXG4gICAgICAgICAgICByaWdodDogTWF0aC5taW4oYS5yaWdodCwgYi5yaWdodCksXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBwb3NpdGlvbnMgd2hlcmUgYGFgIChyZWZlcmVuY2UpIGlzIGludGVyc2VjdGVkIGJ5IGBiYC4gIElmXG4gICAgICogYWxsIGZvdXIgc2l6ZXMgYXJlIHByZXNlbnQgYSBlbnZlbG9wcyBiLlxuICAgICAqXG4gICAgICogQHBhcmFtIGEge1JlY3R9XG4gICAgICogQHBhcmFtIGIge1JlY3R9XG4gICAgICogQHJldHVybiB7QXJyYXk8c3RyaW5nPn1cbiAgICAgKi9cbiAgICBzdGF0aWMgaW50ZXJzZWN0ZWRQb3NpdGlvbnMoYTogUmVjdCwgYjogUmVjdCkge1xuXG4gICAgICAgIGxldCByZXN1bHQgPSBbXTtcblxuICAgICAgICBpZihfaW50ZXJ2YWwoYS5sZWZ0LCBiLnJpZ2h0LCBhLnJpZ2h0KSkge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goXCJsZWZ0XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoX2ludGVydmFsKGEubGVmdCwgYi5sZWZ0LCBhLnJpZ2h0KSkge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goXCJyaWdodFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKF9pbnRlcnZhbChhLnRvcCwgYi5ib3R0b20sIGEuYm90dG9tKSkge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goXCJ0b3BcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZihfaW50ZXJ2YWwoYS50b3AsIGIudG9wLCBhLmJvdHRvbSkpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFwiYm90dG9tXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRha2UgdHdvIHJlY3RzIGFuZCByZXR1cm4gdGhlIHBvc2l0aW9ucyByZWxhdGl2ZSB0byBvbmUgYW5vdGhlci4gIFdlXG4gICAgICogYXNzdW1lIHRoYXQgdGhlIHJlY3RzIHRvIG5vdCBpbnRlcnNlY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYSB7UmVjdH1cbiAgICAgKiBAcGFyYW0gYiB7UmVjdH1cbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAgICovXG4gICAgc3RhdGljIHJlbGF0aXZlUG9zaXRpb25zKGE6IFJlY3QsIGI6IFJlY3QpIHtcblxuICAgICAgICBSZWN0cy52YWxpZGF0ZShhKTtcbiAgICAgICAgUmVjdHMudmFsaWRhdGUoYik7XG5cbiAgICAgICAgbGV0IHJlc3VsdDogYW55ID0ge307XG5cbiAgICAgICAgLy8gYmFzaWNhbGx5IHRoaXMgaXMgdGhlIGRlZ3JlZSBBV0FZIGZyb20gZ2l2ZW4gcG9zaXRpb24uICBOZWdhdGl2ZVxuICAgICAgICAvLyB2YWx1ZXMgd291bGQgYmUgQkVGT1JFIHRoZSBwb3NpdGlvbi5cblxuICAgICAgICByZXN1bHQudG9wID0gTWF0aC5hYnMoYS50b3AgLSBiLmJvdHRvbSk7XG4gICAgICAgIHJlc3VsdC5ib3R0b20gPSBNYXRoLmFicyhhLmJvdHRvbSAtIGIudG9wKTtcbiAgICAgICAgcmVzdWx0LmxlZnQgPSBNYXRoLmFicyhhLmxlZnQgLSBhLnJpZ2h0KTtcbiAgICAgICAgcmVzdWx0LnJpZ2h0ID0gTWF0aC5hYnMoYS5yaWdodCAtIGIubGVmdCk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN1YnRyYWN0IHNlY29uZCByZWN0IGZyb20gdGhlIGZpcnN0IGFuZCByZXR1cm4gYSB2aXJ0dWFsIHJlY3Qgd2l0aCB0aGVcbiAgICAgKiBjaGFuZ2UgaW4gZWxlbWVudHMuIFRoZSBjaGFuZ2UgaXMgdmlydHVhbCBhcyB3ZSBjb3VsZCByZWNvcmQgYSByZWN0IHdpdGhcbiAgICAgKiBuZWdhdGl2ZSB3aWR0aCBmb3IgYSBnaXZlbiBsaW5lIHdoaWNoIHdvdWxkIGJlIGFuIGltYWdpbmFyeSBnZW9tZXRyaWNcbiAgICAgKiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYSB7UmVjdH1cbiAgICAgKiBAcGFyYW0gYiB7UmVjdH1cbiAgICAgKi9cbiAgICBzdGF0aWMgc3VidHJhY3QoYTogUmVjdCwgYjogUmVjdCk6IFJlY3Qge1xuXG4gICAgICAgIGEgPSBSZWN0cy52YWxpZGF0ZShhKTtcbiAgICAgICAgYiA9IFJlY3RzLnZhbGlkYXRlKGIpO1xuXG4gICAgICAgIGxldCBrZXlzOiAoa2V5b2YgUmVjdClbXSA9IFtcImxlZnRcIiwgXCJ0b3BcIiwgXCJyaWdodFwiLCBcImJvdHRvbVwiLCBcIndpZHRoXCIsIFwiaGVpZ2h0XCJdO1xuXG4gICAgICAgIGxldCByZXN1bHQ6IGFueSA9IHt9O1xuXG4gICAgICAgIGtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgcmVzdWx0W2tleV0gPSA8bnVtYmVyPmFba2V5XSAtIDxudW1iZXI+YltrZXldO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gbmV3IFJlY3QocmVzdWx0KTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCB0d28gcmVjdHMgdG9nZXRoZXIgdG8gYnVpbGQgYSBuZXcgcmVjdC4gIFRoZSBzZWNvbmQgcmVjdCBjb3VsZCBiZVxuICAgICAqIHZpcnR1YWwgYW5kIGhhdmUgYSBuZWdhdGl2ZSB3aWR0aCBmb3IgYSBsaW5lLlxuICAgICAqXG4gICAgICogQHBhcmFtIGEge1JlY3R9XG4gICAgICogQHBhcmFtIGIge1JlY3R9XG4gICAgICovXG4gICAgc3RhdGljIGFkZChhOiBSZWN0LCBiOiBSZWN0KSB7XG5cbiAgICAgICAgYSA9IFJlY3RzLnZhbGlkYXRlKGEpO1xuICAgICAgICBiID0gUmVjdHMudmFsaWRhdGUoYik7XG5cbiAgICAgICAgbGV0IGtleXM6IChrZXlvZiBSZWN0KVtdID0gW1wibGVmdFwiLCBcInRvcFwiLCBcInJpZ2h0XCIsIFwiYm90dG9tXCIsIFwid2lkdGhcIiwgXCJoZWlnaHRcIl07XG5cbiAgICAgICAgbGV0IHJlc3VsdDogYW55ID0ge307XG5cbiAgICAgICAga2V5cy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICByZXN1bHRba2V5XSA9IDxudW1iZXI+YVtrZXldICsgPG51bWJlcj5iW2tleV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBuZXcgUmVjdChyZXN1bHQpO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBwZXJjZW50YWdlIHRoYXQgYSB0YWtlcyBvZiBiLCBhIGlzIGFzc3VtZWQgdG8gYmUgPD0gYiBpbiB0ZXJtc1xuICAgICAqIG9mIGRpbWVuc2lvbnMgYW5kIG9uIHRoZSBzYW1lIGNvb3JkaW5hdGUgcGxhbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYSB7UmVjdH1cbiAgICAgKiBAcGFyYW0gYiB7UmVjdH1cbiAgICAgKiBAcmV0dXJuIHtSZWN0fVxuICAgICAqL1xuICAgIHN0YXRpYyBwZXJjKGE6IFJlY3QsIGI6IFJlY3QpIHtcblxuICAgICAgICBpZihhLndpZHRoID4gYi53aWR0aCB8fCBhLmhlaWdodCA+IGIuaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYERpbWVuc2lvbnMgaW52YWxpZCAke2EuZGltZW5zaW9uc30gdnMgJHtiLmRpbWVuc2lvbnN9YCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVzdWx0ID0ge1xuICAgICAgICAgICAgbGVmdDogMTAwICogKGEubGVmdCAvIGIud2lkdGgpLFxuICAgICAgICAgICAgcmlnaHQ6IDEwMCAqIChhLnJpZ2h0IC8gYi53aWR0aCksXG4gICAgICAgICAgICB0b3A6IDEwMCAqIChhLnRvcCAvIGIuaGVpZ2h0KSxcbiAgICAgICAgICAgIGJvdHRvbTogMTAwICogKGEuYm90dG9tIC8gYi5oZWlnaHQpXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY3RzLmNyZWF0ZUZyb21CYXNpY1JlY3QocmVzdWx0KTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGZ1bGwgcmVjdCBmcm9tIGEgcmVjdCB0aGF0IGhhcyB0b3AsIGxlZnQsIHdpZHRoLCBoZWlnaHQgb25seS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSByZWN0IHtSZWN0IHwgT2JqZWN0fVxuICAgICAqIEByZXR1cm4ge1JlY3R9XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGVGcm9tQmFzaWNSZWN0KHJlY3Q6IGFueSk6IFJlY3Qge1xuXG4gICAgICAgIHJlY3QgPSBuZXcgUmVjdChyZWN0KTtcblxuICAgICAgICAvLyBUT0RPOiBhZGQgeCx5IGluIHRoZSBmdXR1cmUuXG5cbiAgICAgICAgLy8gdGhlIG9wdGlvbmFsIG9uZXMgYXJlIGJvdHRvbStyaWdodCBvciB3aWR0aCtoZWlnaHQgYnV0IHdlIGNvdWxkIGFkZFxuICAgICAgICAvLyBzdXBwb3J0IGZvciBvdGhlciBvcHRpb25hbCBvbmVzLi4uXG5cbiAgICAgICAgLy8gaXQgbWlnaHQgYmUgYmV0dGVyIHRvIHNheSwgaWYgdmFyMCBhbmQgdmFyMSBhcmUgZGVmaW5lZCwgSSBjYW4gY29tcHV0ZVxuICAgICAgICAvLyB2YXIyIG9yIHZhciAzLi4uIGFuZCB0aGVuIGRlZmluZSB0aGVtIHdoZW4gdGhleSBhcmUgbm90IGRlZmluZWQuICBGb3JcbiAgICAgICAgLy8gZXhhbXBsZS4gSWYgdG9wIGFuZCBoZWlnaHQgYXJlIGRlZmluZWQsIEkgY2FuIGRlZmluZSBib3R0b20uXG5cbiAgICAgICAgaWYgKCEgcmVjdC5ib3R0b20gJiYgXCJ0b3BcIiBpbiByZWN0ICYmIFwiaGVpZ2h0XCIgaW4gcmVjdCkge1xuICAgICAgICAgICAgcmVjdC5ib3R0b20gPSByZWN0LnRvcCArIHJlY3QuaGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCEgcmVjdC5yaWdodCAmJiBcImxlZnRcIiBpbiByZWN0ICYmIFwid2lkdGhcIiBpbiByZWN0KSB7XG4gICAgICAgICAgICByZWN0LnJpZ2h0ID0gcmVjdC5sZWZ0ICsgcmVjdC53aWR0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghIHJlY3QuaGVpZ2h0ICYmIFwiYm90dG9tXCIgaW4gcmVjdCAmJiBcInRvcFwiIGluIHJlY3QpIHtcbiAgICAgICAgICAgIHJlY3QuaGVpZ2h0ID0gcmVjdC5ib3R0b20gLSByZWN0LnRvcDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghIHJlY3Qud2lkdGggJiYgXCJyaWdodFwiIGluIHJlY3QgJiYgXCJsZWZ0XCIgaW4gcmVjdCkge1xuICAgICAgICAgICAgcmVjdC53aWR0aCA9IHJlY3QucmlnaHQgLSByZWN0LmxlZnQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUmVjdHMudmFsaWRhdGUobmV3IFJlY3QocmVjdCkpO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgbmV3IHJlY3QgZnJvbSB0aGUgZ2l2ZW4gbGluZXNcbiAgICAgKiBAcGFyYW0geEF4aXMge0xpbmV9XG4gICAgICogQHBhcmFtIHlBeGlzIHtMaW5lfVxuICAgICAqIEByZXR1cm4ge1JlY3R9XG4gICAgICovXG4gICAgc3RhdGljIGNyZWF0ZUZyb21MaW5lcyh4QXhpczogTGluZSwgeUF4aXM6IExpbmUpIHtcblxuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydE5vdE51bGwoeEF4aXMsIFwieEF4aXNcIik7XG4gICAgICAgIFByZWNvbmRpdGlvbnMuYXNzZXJ0Tm90TnVsbCh5QXhpcywgXCJ5QXhpc1wiKTtcbiAgICAgICAgUHJlY29uZGl0aW9ucy5hc3NlcnRFcXVhbCh4QXhpcy5heGlzLCBcInhcIiwgXCJ4QXhpcy5heGlzXCIpO1xuICAgICAgICBQcmVjb25kaXRpb25zLmFzc2VydEVxdWFsKHlBeGlzLmF4aXMsIFwieVwiLCBcInlBeGlzLmF4aXNcIik7XG5cbiAgICAgICAgcmV0dXJuIFJlY3RzLmNyZWF0ZUZyb21CYXNpY1JlY3Qoe1xuICAgICAgICAgICAgbGVmdDogeEF4aXMuc3RhcnQsXG4gICAgICAgICAgICB3aWR0aDogeEF4aXMubGVuZ3RoLFxuICAgICAgICAgICAgdG9wOiB5QXhpcy5zdGFydCxcbiAgICAgICAgICAgIGhlaWdodDogeUF4aXMubGVuZ3RoXG4gICAgICAgIH0pXG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBlbGVtZW50IHtIVE1MRWxlbWVudH1cbiAgICAgKiBAcmV0dXJuIHtSZWN0fVxuICAgICAqL1xuICAgIHN0YXRpYyBjcmVhdGVGcm9tT2Zmc2V0KGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XG5cbiAgICAgICAgLy8gRklYTUU6IGlmIEknbSB1c2luZyB0aGlzIGl0IG1pZ2h0IG5vdCBiZSB3aGF0IEkgd2FudC5cblxuICAgICAgICByZXR1cm4gUmVjdHMuY3JlYXRlRnJvbUJhc2ljUmVjdCh7XG4gICAgICAgICAgICBsZWZ0OiBlbGVtZW50Lm9mZnNldExlZnQsXG4gICAgICAgICAgICB0b3A6IGVsZW1lbnQub2Zmc2V0VG9wLFxuICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnQub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnQub2Zmc2V0SGVpZ2h0LFxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBhcnNlIHRoZSBwb3NpdGlvbmluZyBmcm9tIHRoZSBzdHlsZSB3aXRoIGxlZnQsIHRvcCB3aWR0aCBhbmQgaGVpZ2h0IGFuZCB0aGVuXG4gICAgICogcmV0dXJuIHRoaXMgYXMgYSByZWN0LlxuICAgICAqIEBwYXJhbSBlbGVtZW50IHtIVE1MRWxlbWVudH1cbiAgICAgKi9cbiAgICBzdGF0aWMgZnJvbUVsZW1lbnRTdHlsZShlbGVtZW50OiBIVE1MRWxlbWVudCkge1xuXG4gICAgICAgIGxldCByZWN0ID0ge1xuXG4gICAgICAgICAgICBsZWZ0OiBTdHlsZXMucGFyc2VQWChlbGVtZW50LnN0eWxlLmxlZnQpLFxuICAgICAgICAgICAgdG9wOiBTdHlsZXMucGFyc2VQWChlbGVtZW50LnN0eWxlLnRvcCksXG4gICAgICAgICAgICB3aWR0aDogU3R5bGVzLnBhcnNlUFgoZWxlbWVudC5zdHlsZS53aWR0aCksXG4gICAgICAgICAgICBoZWlnaHQ6IFN0eWxlcy5wYXJzZVBYKGVsZW1lbnQuc3R5bGUuaGVpZ2h0KVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY3RzLmNyZWF0ZUZyb21CYXNpY1JlY3QocmVjdCk7XG5cbiAgICB9XG5cbn1cblxuLyoqXG4gKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgcG9pbnQgaXMgd2l0aGluIHRoZSBnaXZlbiBtaW4gYW5kIG1heCBpbnRlcnZhbC5cbiAqXG4gKiBAcGFyYW0gbWluIHtudW1iZXJ9XG4gKiBAcGFyYW0gcG9pbnQge251bWJlcn1cbiAqIEBwYXJhbSBtYXgge251bWJlcn1cbiAqIEBwcml2YXRlXG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBfaW50ZXJ2YWwobWluOiBudW1iZXIsIHBvaW50OiBudW1iZXIsIG1heDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgLy8gVE9ETzogbWlncmF0ZSB0aGlzIHRvIHVzZSBhIExpbmUuaG9sZHNcbiAgICByZXR1cm4gbWluIDw9IHBvaW50ICYmIHBvaW50IDw9IG1heDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEaXJlY3Rpb24ge1xuICAgIHJlYWRvbmx5IHg/OiBudW1iZXI7XG4gICAgcmVhZG9ubHkgeT86IG51bWJlcjtcbn1cbiJdfQ==