"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const React = __importStar(require("react"));
const reactstrap_1 = require("reactstrap");
const Percentages_1 = require("polar-shared/src/util/Percentages");
const Platforms_1 = require("polar-shared/src/util/Platforms");
const Row_1 = require("../../../../web/js/ui/layout/Row");
const FlashcardCard_1 = require("./cards/FlashcardCard");
const ReadingCard_1 = require("./cards/ReadingCard");
class Reviewer extends React.Component {
    constructor(props, context) {
        super(props, context);
        this.onRating = this.onRating.bind(this);
        this.doNext = this.doNext.bind(this);
        this.onSuspended = this.onSuspended.bind(this);
        const pending = [...this.props.taskReps];
        const total = this.props.taskReps.length;
        const taskRep = pending.shift();
        this.state = {
            taskRep, pending, total, finished: 0
        };
    }
    render() {
        const taskRep = this.state.taskRep;
        if (!taskRep) {
            console.log("No tasks were given");
            return React.createElement("div", null);
        }
        const { id, action, created, color } = taskRep;
        const perc = Math.floor(Percentages_1.Percentages.calculate(this.state.finished, this.state.total));
        const createProgressText = () => {
            if (this.state.finished === 0) {
                return "";
            }
            return `${this.state.finished + 1} of ${this.state.total}`;
        };
        const style = {
            display: 'flex',
            flexDirection: 'column',
            background: 'var(--white)'
        };
        if (Platforms_1.Platforms.isMobile()) {
            style.width = '100%';
            style.height = '100%';
        }
        else {
            style.maxHeight = '1000px';
            style.width = '800px';
            style.maxWidth = '800px';
        }
        const DoReadingCard = () => {
            const readingTaskRep = taskRep;
            return React.createElement(ReadingCard_1.ReadingCard, { taskRep: readingTaskRep, onRating: (_, rating) => this.onRating(taskRep, rating) });
        };
        const DoFlashcardCard = () => {
            const flashcardTaskRep = taskRep;
            const flashcardTaskAction = flashcardTaskRep.action;
            const front = flashcardTaskAction.front;
            const back = flashcardTaskAction.back;
            return React.createElement(FlashcardCard_1.FlashcardCard, { taskRep: flashcardTaskRep, front: front, back: back, onRating: (_, rating) => this.onRating(taskRep, rating) });
        };
        const Card = () => {
            if (typeof action === 'string') {
                return React.createElement(DoReadingCard, null);
            }
            else {
                return React.createElement(DoFlashcardCard, null);
            }
        };
        return (React.createElement("div", { style: style, className: "ml-auto mr-auto h-100 border p-1" },
            React.createElement(Row_1.Row, null,
                React.createElement(Row_1.Row.Main, null,
                    React.createElement("b", null, "Review")),
                React.createElement(Row_1.Row.Right, null,
                    React.createElement(reactstrap_1.Button, { size: "md", color: "light", className: "text-muted mr-1", onClick: () => this.onSuspended(taskRep) },
                        React.createElement("i", { className: "fas fa-pause" }),
                        " suspend"),
                    React.createElement(reactstrap_1.Button, { size: "md", color: "light", className: "text-muted", onClick: () => this.props.onFinished(true) },
                        React.createElement("i", { className: "far fa-times-circle" })))),
            React.createElement("div", { className: "pt-1 pb-1" },
                React.createElement(reactstrap_1.Progress, { value: perc }, createProgressText())),
            React.createElement(Card, null)));
    }
    onSuspended(taskRep) {
        this.props.onSuspended(taskRep);
        this.doNext();
    }
    onRating(taskRep, rating) {
        this.props.onRating(taskRep, rating);
        this.doNext();
    }
    doNext() {
        const taskRep = this.state.pending.shift();
        if (!taskRep) {
            this.props.onFinished();
        }
        this.setState(Object.assign(Object.assign({}, this.state), { taskRep, finished: this.state.finished + 1 }));
    }
}
exports.Reviewer = Reviewer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmV2aWV3ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJSZXZpZXdlci50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsNkNBQStCO0FBQy9CLDJDQUE0QztBQUM1QyxtRUFBOEQ7QUFLOUQsK0RBQTBEO0FBQzFELDBEQUFxRDtBQUNyRCx5REFBb0Q7QUFFcEQscURBQWdEO0FBR2hELE1BQWEsUUFBWSxTQUFRLEtBQUssQ0FBQyxTQUErQjtJQUVsRSxZQUFZLEtBQWdCLEVBQUUsT0FBWTtRQUN0QyxLQUFLLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRXRCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRS9DLE1BQU0sT0FBTyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUN6QyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFaEMsSUFBSSxDQUFDLEtBQUssR0FBRztZQUNULE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDO1NBQ3ZDLENBQUM7SUFFTixDQUFDO0lBRU0sTUFBTTtRQUVULE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBRW5DLElBQUksQ0FBRSxPQUFPLEVBQUU7WUFFWCxPQUFPLENBQUMsR0FBRyxDQUFDLHFC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QUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQ25DLENBQUM7SUFFUCxDQUFDO0NBRUo7QUFuT0QsNEJBbU9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtCdXR0b24sIFByb2dyZXNzfSBmcm9tIFwicmVhY3RzdHJhcFwiO1xuaW1wb3J0IHtQZXJjZW50YWdlc30gZnJvbSBcInBvbGFyLXNoYXJlZC9zcmMvdXRpbC9QZXJjZW50YWdlc1wiO1xuaW1wb3J0IHtSYXRpbmd9IGZyb20gXCJwb2xhci1zcGFjZWQtcmVwZXRpdGlvbi1hcGkvc3JjL3NjaGVkdWxlci9TMlBsdXMvUzJQbHVzXCI7XG5pbXBvcnQge1xuICAgIFRhc2tSZXBcbn0gZnJvbSBcInBvbGFyLXNwYWNlZC1yZXBldGl0aW9uL3NyYy9zcGFjZWRfcmVwZXRpdGlvbi9zY2hlZHVsZXIvUzJQbHVzL1Rhc2tzQ2FsY3VsYXRvclwiO1xuaW1wb3J0IHtQbGF0Zm9ybXN9IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL3V0aWwvUGxhdGZvcm1zXCI7XG5pbXBvcnQge1Jvd30gZnJvbSBcIi4uLy4uLy4uLy4uL3dlYi9qcy91aS9sYXlvdXQvUm93XCI7XG5pbXBvcnQge0ZsYXNoY2FyZENhcmR9IGZyb20gXCIuL2NhcmRzL0ZsYXNoY2FyZENhcmRcIjtcbmltcG9ydCB7Rmxhc2hjYXJkVGFza0FjdGlvbn0gZnJvbSBcIi4vY2FyZHMvRmxhc2hjYXJkVGFza0FjdGlvblwiO1xuaW1wb3J0IHtSZWFkaW5nQ2FyZH0gZnJvbSBcIi4vY2FyZHMvUmVhZGluZ0NhcmRcIjtcbmltcG9ydCB7UmVhZGluZ1Rhc2tBY3Rpb259IGZyb20gXCIuL2NhcmRzL1JlYWRpbmdUYXNrQWN0aW9uXCI7XG5cbmV4cG9ydCBjbGFzcyBSZXZpZXdlcjxBPiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHM8QT4sIElTdGF0ZTxBPj4ge1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wczxBPiwgY29udGV4dDogYW55KSB7XG4gICAgICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcblxuICAgICAgICB0aGlzLm9uUmF0aW5nID0gdGhpcy5vblJhdGluZy5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmRvTmV4dCA9IHRoaXMuZG9OZXh0LmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMub25TdXNwZW5kZWQgPSB0aGlzLm9uU3VzcGVuZGVkLmJpbmQodGhpcyk7XG5cbiAgICAgICAgY29uc3QgcGVuZGluZyA9IFsuLi50aGlzLnByb3BzLnRhc2tSZXBzXTtcbiAgICAgICAgY29uc3QgdG90YWwgPSB0aGlzLnByb3BzLnRhc2tSZXBzLmxlbmd0aDtcbiAgICAgICAgY29uc3QgdGFza1JlcCA9IHBlbmRpbmcuc2hpZnQoKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgdGFza1JlcCwgcGVuZGluZywgdG90YWwsIGZpbmlzaGVkOiAwXG4gICAgICAgIH07XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgcmVuZGVyKCkge1xuXG4gICAgICAgIGNvbnN0IHRhc2tSZXAgPSB0aGlzLnN0YXRlLnRhc2tSZXA7XG5cbiAgICAgICAgaWYgKCEgdGFza1JlcCkge1xuICAgICAgICAgICAgLy8gd2UncmUgZG9uZS4uLlxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJObyB0YXNrcyB3ZXJlIGdpdmVuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIDxkaXYvPjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHtpZCwgYWN0aW9uLCBjcmVhdGVkLCBjb2xvcn0gPSB0YXNrUmVwO1xuXG4gICAgICAgIGNvbnN0IHBlcmMgPSBNYXRoLmZsb29yKFBlcmNlbnRhZ2VzLmNhbGN1bGF0ZSh0aGlzLnN0YXRlLmZpbmlzaGVkLCB0aGlzLnN0YXRlLnRvdGFsKSk7XG5cbiAgICAgICAgY29uc3QgY3JlYXRlUHJvZ3Jlc3NUZXh0ID0gKCkgPT4ge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5maW5pc2hlZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5zdGF0ZS5maW5pc2hlZCArIDF9IG9mICR7dGhpcy5zdGF0ZS50b3RhbH1gO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gYWdhaW4sIGhhcmQsIGdvb2QsIGVhc3lcblxuICAgICAgICBjb25zdCBzdHlsZTogUmVhY3QuQ1NTUHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgICAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgICAgICAgICAgYmFja2dyb3VuZDogJ3ZhcigtLXdoaXRlKSdcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoUGxhdGZvcm1zLmlzTW9iaWxlKCkpIHtcbiAgICAgICAgICAgIHN0eWxlLndpZHRoID0gJzEwMCUnO1xuICAgICAgICAgICAgc3R5bGUuaGVpZ2h0ID0gJzEwMCUnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3R5bGUubWF4SGVpZ2h0ID0gJzEwMDBweCc7XG4gICAgICAgICAgICBzdHlsZS53aWR0aCA9ICc4MDBweCc7XG4gICAgICAgICAgICBzdHlsZS5tYXhXaWR0aCA9ICc4MDBweCc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjb25zdCBNYWluID0gKCkgPT4ge1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vICAgICAgICAgcmV0dXJuIDxBbm5vdGF0aW9uUHJldmlldyBpZD17aWR9XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0PXthY3Rpb259XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkPXtjcmVhdGVkfVxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YT17e2NvbG9yfX0vPlxuICAgICAgICAvLyAgICAgfSBlbHNlIHtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgICAgICBjb25zdCBmbGFzaGNhcmRUYXNrQWN0aW9uOiBGbGFzaGNhcmRUYXNrQWN0aW9uXG4gICAgICAgIC8vICAgICAgICAgICAgID0gYWN0aW9uIGFzIGFueSBhcyBGbGFzaGNhcmRUYXNrQWN0aW9uO1xuICAgICAgICAvLyAgICAgICAgIGNvbnN0IGZyb250ID0gZmxhc2hjYXJkVGFza0FjdGlvbi5mcm9udDtcbiAgICAgICAgLy8gICAgICAgICBjb25zdCBiYWNrID0gZmxhc2hjYXJkVGFza0FjdGlvbi5iYWNrO1xuICAgICAgICAvLyAgICAgICAgIGNvbnN0IGFuc3dlcnMgPSA8ZGl2Lz47XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICAgICAgcmV0dXJuIDxGbGFzaGNhcmRDYXJkIGZyb250PXtmcm9udH0gYmFjaz17YmFja30gYW5zd2Vycz17YW5zd2Vyc30vPlxuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvL1xuICAgICAgICAvLyB9O1xuXG4gICAgICAgIGNvbnN0IERvUmVhZGluZ0NhcmQgPSAoKSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlYWRpbmdUYXNrUmVwID0gdGFza1JlcCBhcyBhbnkgYXMgVGFza1JlcDxSZWFkaW5nVGFza0FjdGlvbj47XG5cbiAgICAgICAgICAgIHJldHVybiA8UmVhZGluZ0NhcmQgdGFza1JlcD17cmVhZGluZ1Rhc2tSZXB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uUmF0aW5nPXsoXywgcmF0aW5nKSA9PiB0aGlzLm9uUmF0aW5nKHRhc2tSZXAsIHJhdGluZyl9Lz47XG5cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBEb0ZsYXNoY2FyZENhcmQgPSAoKSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IGZsYXNoY2FyZFRhc2tSZXAgPSB0YXNrUmVwIGFzIGFueSBhcyBUYXNrUmVwPEZsYXNoY2FyZFRhc2tBY3Rpb24+O1xuXG4gICAgICAgICAgICBjb25zdCBmbGFzaGNhcmRUYXNrQWN0aW9uID0gZmxhc2hjYXJkVGFza1JlcC5hY3Rpb247XG4gICAgICAgICAgICBjb25zdCBmcm9udCA9IGZsYXNoY2FyZFRhc2tBY3Rpb24uZnJvbnQ7XG4gICAgICAgICAgICBjb25zdCBiYWNrID0gZmxhc2hjYXJkVGFza0FjdGlvbi5iYWNrO1xuXG4gICAgICAgICAgICByZXR1cm4gPEZsYXNoY2FyZENhcmQgdGFza1JlcD17Zmxhc2hjYXJkVGFza1JlcH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9udD17ZnJvbnR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFjaz17YmFja31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblJhdGluZz17KF8sIHJhdGluZykgPT4gdGhpcy5vblJhdGluZyh0YXNrUmVwLCByYXRpbmcpfS8+O1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IENhcmQgPSAoKSA9PiB7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHJldHVybiA8RG9SZWFkaW5nQ2FyZC8+O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gPERvRmxhc2hjYXJkQ2FyZC8+O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIChcblxuICAgICAgICAgICAgPGRpdiBzdHlsZT17c3R5bGV9XG4gICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm1sLWF1dG8gbXItYXV0byBoLTEwMCBib3JkZXIgcC0xXCI+XG5cbiAgICAgICAgICAgICAgICA8Um93PlxuICAgICAgICAgICAgICAgICAgICA8Um93Lk1haW4+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxiPlJldmlldzwvYj5cblxuICAgICAgICAgICAgICAgICAgICA8L1Jvdy5NYWluPlxuXG4gICAgICAgICAgICAgICAgICAgIDxSb3cuUmlnaHQ+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gc2l6ZT1cIm1kXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I9XCJsaWdodFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cInRleHQtbXV0ZWQgbXItMVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMub25TdXNwZW5kZWQodGFza1JlcCl9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzTmFtZT1cImZhcyBmYS1wYXVzZVwiLz4gc3VzcGVuZFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gc2l6ZT1cIm1kXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I9XCJsaWdodFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cInRleHQtbXV0ZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnByb3BzLm9uRmluaXNoZWQodHJ1ZSl9PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPVwiZmFyIGZhLXRpbWVzLWNpcmNsZVwiLz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG5cbiAgICAgICAgICAgICAgICAgICAgPC9Sb3cuUmlnaHQ+XG5cbiAgICAgICAgICAgICAgICA8L1Jvdz5cblxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicHQtMSBwYi0xXCI+XG5cbiAgICAgICAgICAgICAgICAgICAgPFByb2dyZXNzIHZhbHVlPXtwZXJjfT57Y3JlYXRlUHJvZ3Jlc3NUZXh0KCl9PC9Qcm9ncmVzcz5cblxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG5cbiAgICAgICAgICAgICAgICA8Q2FyZC8+XG5cbiAgICAgICAgICAgICAgICB7Lyo8ZGl2IGNsYXNzTmFtZT1cInAtMVwiKi99XG4gICAgICAgICAgICAgICAgey8qICAgICBzdHlsZT17eyovfVxuICAgICAgICAgICAgICAgIHsvKiAgICAgICAgZmxleEdyb3c6IDEsKi99XG4gICAgICAgICAgICAgICAgey8qICAgICAgICBkaXNwbGF5OiAnZmxleCcsKi99XG4gICAgICAgICAgICAgICAgey8qICAgICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywqL31cbiAgICAgICAgICAgICAgICB7LyogICAgICAgIG92ZXJmbG93WTogJ2F1dG8nKi99XG4gICAgICAgICAgICAgICAgey8qICAgICB9fT4qL31cblxuICAgICAgICAgICAgICAgIHsvKiAgICA8ZGl2IHN0eWxlPXt7Ki99XG4gICAgICAgICAgICAgICAgey8qICAgICAgICAgICAgZmxleEdyb3c6IDEqL31cbiAgICAgICAgICAgICAgICB7LyogICAgICAgICB9fT4qL31cblxuICAgICAgICAgICAgICAgIHsvKiAgICAgICAgPE1haW4vPiovfVxuXG4gICAgICAgICAgICAgICAgey8qICAgIDwvZGl2PiovfVxuXG4gICAgICAgICAgICAgICAgey8qPC9kaXY+Ki99XG5cbiAgICAgICAgICAgICAgICB7Lyo8ZGl2PiovfVxuXG4gICAgICAgICAgICAgICAgey8qICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1zbSB0ZXh0LWdyZXk3MDAgbWItMSBtbC0xXCI+Ki99XG4gICAgICAgICAgICAgICAgey8qICAgICAgICA8Yj5zdGFnZTogPC9iPiB7dGFza1JlcC5zdGFnZX0qL31cbiAgICAgICAgICAgICAgICB7LyogICAgPC9kaXY+Ki99XG5cbiAgICAgICAgICAgICAgICB7LyogICAgPGRpdiBzdHlsZT17eyovfVxuICAgICAgICAgICAgICAgIHsvKiAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JywqL31cbiAgICAgICAgICAgICAgICB7LyogICAgICAgIH19PiovfVxuXG4gICAgICAgICAgICAgICAgey8qICAgICAgICA8UmF0aW5nQnV0dG9ucyB0YXNrUmVwPXt0YXNrUmVwfSovfVxuICAgICAgICAgICAgICAgIHsvKiAgICAgICAgICAgICAgICAgICAgICAgc3RhZ2U9e3Rhc2tSZXAuc3RhZ2V9Ki99XG4gICAgICAgICAgICAgICAgey8qICAgICAgICAgICAgICAgICAgICAgICBvblJhdGluZz17dGhpcy5vblJhdGluZ30vPiovfVxuXG4gICAgICAgICAgICAgICAgey8qICAgIDwvZGl2PiovfVxuXG4gICAgICAgICAgICAgICAgey8qPC9kaXY+Ki99XG5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uU3VzcGVuZGVkKHRhc2tSZXA6IFRhc2tSZXA8QT4pIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblN1c3BlbmRlZCh0YXNrUmVwKTtcbiAgICAgICAgdGhpcy5kb05leHQoKTtcblxuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBvblJhdGluZyh0YXNrUmVwOiBUYXNrUmVwPEE+LCByYXRpbmc6IFJhdGluZykge1xuICAgICAgICB0aGlzLnByb3BzLm9uUmF0aW5nKHRhc2tSZXAsIHJhdGluZyk7XG4gICAgICAgIHRoaXMuZG9OZXh0KCk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGRvTmV4dCgpIHtcblxuICAgICAgICBjb25zdCB0YXNrUmVwID0gdGhpcy5zdGF0ZS5wZW5kaW5nLnNoaWZ0KCk7XG5cbiAgICAgICAgaWYgKCEgdGFza1JlcCkge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIC4uLnRoaXMuc3RhdGUsXG4gICAgICAgICAgICB0YXNrUmVwLFxuICAgICAgICAgICAgZmluaXNoZWQ6IHRoaXMuc3RhdGUuZmluaXNoZWQgKyAxXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG59XG5cbi8qKlxuICogQ2FsbGVkIHdoZW4gd2UncmUgZmluaXNoZWQgYWxsIHRoZSB0YXNrcy5cbiAqXG4gKiBAcGFyYW0gY2FuY2VsbGVkIHRydWUgaWYgdGhlIHVzZXIgZXhwbGljaXRseSBjYW5jZWxsZWQgdGhlIHJldmlldy5cbiAqL1xuZXhwb3J0IHR5cGUgRmluaXNoZWRDYWxsYmFjayA9IChjYW5jZWxsZWQ/OiBib29sZWFuKSA9PiB2b2lkO1xuXG5cbi8qKlxuICogQ2FsbGVkIHdoZW4gd2UncmUgZmluaXNoZWQgYWxsIHRoZSB0YXNrcy5cbiAqXG4gKiBAcGFyYW0gY2FuY2VsbGVkIHRydWUgaWYgdGhlIHVzZXIgZXhwbGljaXRseSBjYW5jZWxsZWQgdGhlIHJldmlldy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSYXRpbmdDYWxsYmFjazxBPiB7XG4gICAgKHRhc2tSZXA6IFRhc2tSZXA8QT4sIHJhdGluZzogUmF0aW5nKTogdm9pZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJUHJvcHM8QT4ge1xuXG4gICAgcmVhZG9ubHkgdGFza1JlcHM6IFJlYWRvbmx5QXJyYXk8VGFza1JlcDxBPj47XG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmb3Igd2hlbiB3ZSByZWNlaXZlIGFuc3dlcnMgYW5kIHRoZWlyIHZhbHVlcy5cbiAgICAgKi9cbiAgICByZWFkb25seSBvblJhdGluZzogUmF0aW5nQ2FsbGJhY2s8QT47XG5cbiAgICByZWFkb25seSBvblN1c3BlbmRlZDogKHRhc2tSZXA6IFRhc2tSZXA8QT4pID0+IHZvaWQ7XG5cbiAgICByZWFkb25seSBvbkZpbmlzaGVkOiBGaW5pc2hlZENhbGxiYWNrO1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVN0YXRlPEE+IHtcblxuICAgIC8qKlxuICAgICAqIFRoZSByZXZpZXcgd2UncmUgd29ya2luZyB3aXRoIG9yIHVuZGVmaW5lZCB3aGVuIHRoZXJlIGFyZSBubyBtb3JlLlxuICAgICAqL1xuICAgIHJlYWRvbmx5IHRhc2tSZXA/OiBUYXNrUmVwPEE+IHwgdW5kZWZpbmVkO1xuXG4gICAgcmVhZG9ubHkgcGVuZGluZzogQXJyYXk8VGFza1JlcDxBPj47XG5cbiAgICByZWFkb25seSBmaW5pc2hlZDogbnVtYmVyO1xuXG4gICAgcmVhZG9ubHkgdG90YWw6IG51bWJlcjtcblxufVxuIl19