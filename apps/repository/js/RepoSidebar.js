"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const React = __importStar(require("react"));
const Blackout_1 = require("../../../web/js/ui/blackout/Blackout");
const NavLogo_1 = require("./nav/NavLogo");
const RepoSidebarItem_1 = require("./sidebar/RepoSidebarItem");
const GDPRNotice_1 = require("../../../web/js/ui/gdpr/GDPRNotice");
const Button_1 = __importDefault(require("reactstrap/lib/Button"));
const ListGroup_1 = __importDefault(require("reactstrap/lib/ListGroup"));
const SimpleTooltipEx_1 = require("../../../web/js/ui/tooltip/SimpleTooltipEx");
const SimpleTabs_1 = require("../../../web/js/ui/simple_tab/SimpleTabs");
const Platforms_1 = require("polar-shared/src/util/Platforms");
const NullCollapse_1 = require("../../../web/js/ui/null_collapse/NullCollapse");
const Styles = {
    sidebar: {
        position: 'absolute',
        top: 0,
        left: 0,
        backgroundColor: '#fff',
        zIndex: 99999,
        height: 'calc(100%)',
        width: '200px',
    },
    subheader: {
        display: 'table'
    },
    subheaderItem: {}
};
class RepoSidebar extends React.Component {
    constructor(props, context) {
        super(props, context);
        this.state = {
            expanded: false
        };
        window.addEventListener('keyup', event => {
            if (event.key === "Escape") {
                if (this.state.expanded) {
                    this.setState({ expanded: false });
                }
            }
        });
    }
    componentDidUpdate(prevProps, prevState, snapshot) {
        if (prevState.expanded !== this.state.expanded) {
            Blackout_1.Blackout.toggle(this.state.expanded);
        }
    }
    render() {
        const display = this.state.expanded ? 'block' : 'none';
        const sidebarStyle = Object.assign({}, Styles.sidebar, { display });
        const NavButtons = () => (React.createElement("div", { style: { display: 'flex' } },
            React.createElement("div", { className: "mt-auto mb-auto" },
                React.createElement(NullCollapse_1.NullCollapse, { open: !isMobile },
                    React.createElement(SimpleTooltipEx_1.SimpleTooltipEx, { text: "Toggle showing the sidebar" },
                        React.createElement("div", { id: "toggle-sidebar", className: "mr-1" },
                            React.createElement(Button_1.default, { color: 'light', onClick: () => this.toggle() },
                                React.createElement("i", { className: "fas fa-bars" })))))),
            React.createElement("div", { className: "mt-auto mb-auto" },
                React.createElement(NavLogo_1.NavLogo, null)),
            React.createElement("div", { className: "mt-auto mb-auto d-none-mobile" },
                React.createElement("div", { className: "ml-4" },
                    React.createElement(SimpleTabs_1.SimpleTabs, null)))));
        const isMobile = Platforms_1.Platforms.isMobile();
        return (React.createElement("div", { className: "repo-sidebar" },
            React.createElement(GDPRNotice_1.GDPRNotice, null),
            React.createElement("div", null,
                React.createElement(NavButtons, null)),
            React.createElement("section", { className: "sidebar", style: sidebarStyle, "data-expanded": this.state.expanded, onKeyUp: event => this.onKeyUp(event) },
                React.createElement("div", { className: "subheader", style: Styles.subheader },
                    React.createElement(NavButtons, null)),
                React.createElement(NullCollapse_1.NullCollapse, { open: !isMobile },
                    React.createElement(ListGroup_1.default, { flush: true },
                        React.createElement(RepoSidebarItem_1.RepoSidebarItem, { id: "sidebar-item-documents", tooltip: "Manage all documents you're reading including filtering and sorting.", target: { pathname: "/" }, onClick: () => this.toggle(), iconClassName: "fas fa-archive", text: "Documents" }),
                        React.createElement(RepoSidebarItem_1.RepoSidebarItem, { id: "sidebar-item-annotations", tooltip: "Manage all annotations of all your documents in one central view.", target: { pathname: "/", hash: "annotations" }, onClick: () => this.toggle(), iconClassName: "fas fa-layer-group", text: "Annotations" }),
                        React.createElement(RepoSidebarItem_1.RepoSidebarItem, { id: "sidebar-item-groups", tooltip: "Show public groups", target: { pathname: "/groups" }, onClick: () => this.toggle(), iconClassName: "fas fa-user-friends", text: "Groups" }),
                        React.createElement(RepoSidebarItem_1.RepoSidebarItem, { id: "sidebar-item-stats", tooltip: "Show stats on your usage of Polar including stats on tags, rate of document addition, etc.", target: { pathname: "/", hash: "stats" }, onClick: () => this.toggle(), iconClassName: "fas fa-chart-line", text: "Statistics" }),
                        React.createElement(RepoSidebarItem_1.RepoSidebarItem, { id: "sidebar-item-logs", tooltip: "Show logs on internal activity during background operations like cloud activity and sync.", target: { pathname: "/", hash: "logs" }, onClick: () => this.toggle(), iconClassName: "fas fa-info-circle", text: "Logs" }),
                        React.createElement(RepoSidebarItem_1.RepoSidebarItem, { id: "sidebar-item-support", tooltip: "Get support for Polar.", target: { pathname: "/", hash: "support" }, onClick: () => this.toggle(), iconClassName: "fas fa-hands-helping", text: "Support" }),
                        React.createElement(RepoSidebarItem_1.RepoSidebarItem, { id: "sidebar-item-upgrade-to-premium", tooltip: "Upgrade to Polar Premium and get the best Polar experience possible.", target: { pathname: "/", hash: "plans" }, onClick: () => this.toggle(), iconClassName: "fas fa-certificate", text: "Upgrade to Premium" }),
                        React.createElement(RepoSidebarItem_1.RepoSidebarItem, { id: "sidebar-item-whatsnew", tooltip: "Find out what's new with each Polar release.", target: { pathname: "/", hash: "whats-new" }, onClick: () => this.toggle(), iconClassName: "fas fa-bullhorn", text: "Whats New" }))))));
    }
    onKeyUp(event) {
    }
    toggle() {
        const expanded = !this.state.expanded;
        Blackout_1.Blackout.toggle(expanded);
        this.setState({
            expanded
        });
    }
}
exports.RepoSidebar = RepoSidebar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwb1NpZGViYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJSZXBvU2lkZWJhci50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQStCO0FBRy9CLG1FQUE4RDtBQUM5RCwyQ0FBc0M7QUFDdEMsK0RBQTBEO0FBQzFELG1FQUE4RDtBQUM5RCxtRUFBMkM7QUFDM0MseUVBQWlEO0FBQ2pELGdGQUEyRTtBQUMzRSx5RUFBb0U7QUFFcEUsK0RBQTBEO0FBQzFELGdGQUEyRTtBQUUzRSxNQUFNLE1BQU0sR0FBYztJQUV0QixPQUFPLEVBQUU7UUFDTCxRQUFRLEVBQUUsVUFBVTtRQUNwQixHQUFHLEVBQUUsQ0FBQztRQUNOLElBQUksRUFBRSxDQUFDO1FBRVAsZUFBZSxFQUFFLE1BQU07UUFDdkIsTUFBTSxFQUFFLEtBQUs7UUFDYixNQUFNLEVBQUUsWUFBWTtRQUNwQixLQUFLLEVBQUUsT0FBTztLQUdqQjtJQUVELFNBQVMsRUFBRTtRQUNQLE9BQU8sRUFBRSxPQUFPO0tBQ25CO0lBRUQsYUFBYSxFQUFFLEVBQ2Q7Q0FFSixDQUFDO0FBTUYsTUFBYSxXQUFZLFNBQVEsS0FBSyxDQUFDLFNBQXlCO0lBRTVELFlBQVksS0FBYSxFQUFFLE9BQVk7UUFDbkMsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUV0QixJQUFJLENBQUMsS0FBSyxHQUFHO1lBQ1QsUUFBUSxFQUFFLEtBQUs7U0FDbEIsQ0FBQztRQUVGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEVBQUU7WUFFckMsSUFBSSxLQUFLLENBQUMsR0FBRyxLQUFLLFFBQVEsRUFBRTtnQkFFeEIsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRTtvQkFDckIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO2lCQUN0QzthQUVKO1FBRUwsQ0FBQyxDQUFD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RTt3QkFFakMsb0JBQUMsaUNBQWUsSUFBQyxFQUFFLEVBQUMsaUNBQWlDLEVBQ3BDLE9BQU8sRUFBQyxzRUFBc0UsRUFDOUUsTUFBTSxFQUFFLEVBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFDLEVBQ3RDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQzVCLGFBQWEsRUFBQyxvQkFBb0IsRUFDbEMsSUFBSSxFQUFDLG9CQUFvQixHQUFFO3dCQUU1QyxvQkFBQyxpQ0FBZSxJQUFDLEVBQUUsRUFBQyx1QkFBdUIsRUFDMUIsT0FBTyxFQUFDLDhDQUE4QyxFQUN0RCxNQUFNLEVBQUUsRUFBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUMsRUFDMUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFDNUIsYUFBYSxFQUFDLGlCQUFpQixFQUMvQixJQUFJLEVBQUMsV0FBVyxHQUFFLENBRTNCLENBRUQsQ0FFVCxDQUNSLENBRVQsQ0FBQztJQUVOLENBQUM7SUFFTyxPQUFPLENBQUMsS0FBdUM7SUFJdkQsQ0FBQztJQUVPLE1BQU07UUFFVixNQUFNLFFBQVEsR0FBRyxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1FBRXZDLG1CQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRTFCLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDVixRQUFRO1NBQ1gsQ0FBQyxDQUFDO0lBS1AsQ0FBQztDQUVKO0FBM01ELGtDQTJNQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7TG9nZ2VyfSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL2xvZ2dlci9Mb2dnZXInO1xuaW1wb3J0IHtJU3R5bGVNYXB9IGZyb20gJy4uLy4uLy4uL3dlYi9qcy9yZWFjdC9JU3R5bGVNYXAnO1xuaW1wb3J0IHtCbGFja291dH0gZnJvbSAnLi4vLi4vLi4vd2ViL2pzL3VpL2JsYWNrb3V0L0JsYWNrb3V0JztcbmltcG9ydCB7TmF2TG9nb30gZnJvbSAnLi9uYXYvTmF2TG9nbyc7XG5pbXBvcnQge1JlcG9TaWRlYmFySXRlbX0gZnJvbSAnLi9zaWRlYmFyL1JlcG9TaWRlYmFySXRlbSc7XG5pbXBvcnQge0dEUFJOb3RpY2V9IGZyb20gJy4uLy4uLy4uL3dlYi9qcy91aS9nZHByL0dEUFJOb3RpY2UnO1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdyZWFjdHN0cmFwL2xpYi9CdXR0b24nO1xuaW1wb3J0IExpc3RHcm91cCBmcm9tICdyZWFjdHN0cmFwL2xpYi9MaXN0R3JvdXAnO1xuaW1wb3J0IHtTaW1wbGVUb29sdGlwRXh9IGZyb20gJy4uLy4uLy4uL3dlYi9qcy91aS90b29sdGlwL1NpbXBsZVRvb2x0aXBFeCc7XG5pbXBvcnQge1NpbXBsZVRhYnN9IGZyb20gXCIuLi8uLi8uLi93ZWIvanMvdWkvc2ltcGxlX3RhYi9TaW1wbGVUYWJzXCI7XG5pbXBvcnQge1NpbXBsZVRhYn0gZnJvbSBcIi4uLy4uLy4uL3dlYi9qcy91aS9zaW1wbGVfdGFiL1NpbXBsZVRhYlwiO1xuaW1wb3J0IHtQbGF0Zm9ybXN9IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL3V0aWwvUGxhdGZvcm1zXCI7XG5pbXBvcnQge051bGxDb2xsYXBzZX0gZnJvbSBcIi4uLy4uLy4uL3dlYi9qcy91aS9udWxsX2NvbGxhcHNlL051bGxDb2xsYXBzZVwiO1xuXG5jb25zdCBTdHlsZXM6IElTdHlsZU1hcCA9IHtcblxuICAgIHNpZGViYXI6IHtcbiAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgLy8gZGlzcGxheTogJ25vbmUnLFxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmJyxcbiAgICAgICAgekluZGV4OiA5OTk5OSxcbiAgICAgICAgaGVpZ2h0OiAnY2FsYygxMDAlKScsXG4gICAgICAgIHdpZHRoOiAnMjAwcHgnLFxuICAgICAgICAvLyBwYWRkaW5nTGVmdDogJzFweCcsXG4gICAgICAgIC8vIHBhZGRpbmdUb3A6ICcxcHgnXG4gICAgfSxcblxuICAgIHN1YmhlYWRlcjoge1xuICAgICAgICBkaXNwbGF5OiAndGFibGUnXG4gICAgfSxcblxuICAgIHN1YmhlYWRlckl0ZW06IHtcbiAgICB9XG5cbn07XG5cbi8qKlxuICogU2ltcGxlIGhlYWRlciBmb3IgdGhlIHJlcG9zaXRvcnkgd2hpY2ggc3VwcG9ydHMgYXJiaXRyYXJ5IGNoaWxkcmVuLlxuICogQERlcHJlY2F0ZWRcbiAqL1xuZXhwb3J0IGNsYXNzIFJlcG9TaWRlYmFyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzLCBjb250ZXh0OiBhbnkpIHtcbiAgICAgICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBleHBhbmRlZDogZmFsc2VcbiAgICAgICAgfTtcblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBldmVudCA9PiB7XG5cbiAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmV4cGFuZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBleHBhbmRlZDogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wczogUmVhZG9ubHk8SVByb3BzPiwgcHJldlN0YXRlOiBSZWFkb25seTxJU3RhdGU+LCBzbmFwc2hvdD86IGFueSk6IHZvaWQge1xuXG4gICAgICAgIGlmIChwcmV2U3RhdGUuZXhwYW5kZWQgIT09IHRoaXMuc3RhdGUuZXhwYW5kZWQpIHtcbiAgICAgICAgICAgIEJsYWNrb3V0LnRvZ2dsZSh0aGlzLnN0YXRlLmV4cGFuZGVkKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlcigpIHtcblxuICAgICAgICBjb25zdCBkaXNwbGF5ID0gdGhpcy5zdGF0ZS5leHBhbmRlZCA/ICdibG9jaycgOiAnbm9uZSc7XG5cbiAgICAgICAgY29uc3Qgc2lkZWJhclN0eWxlID0gT2JqZWN0LmFzc2lnbih7fSwgU3R5bGVzLnNpZGViYXIsIHtkaXNwbGF5fSk7XG5cbiAgICAgICAgY29uc3QgTmF2QnV0dG9ucyA9ICgpID0+IChcblxuICAgICAgICAgICAgPGRpdiBzdHlsZT17e2Rpc3BsYXk6ICdmbGV4J319PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtdC1hdXRvIG1iLWF1dG9cIj5cblxuICAgICAgICAgICAgICAgICAgICA8TnVsbENvbGxhcHNlIG9wZW49eyEgaXNNb2JpbGV9PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8U2ltcGxlVG9vbHRpcEV4IHRleHQ9XCJUb2dnbGUgc2hvd2luZyB0aGUgc2lkZWJhclwiPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cInRvZ2dsZS1zaWRlYmFyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm1yLTFcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBjb2xvcj0nbGlnaHQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy50b2dnbGUoKX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9XCJmYXMgZmEtYmFyc1wiLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvU2ltcGxlVG9vbHRpcEV4PlxuICAgICAgICAgICAgICAgICAgICA8L051bGxDb2xsYXBzZT5cblxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtdC1hdXRvIG1iLWF1dG9cIj5cbiAgICAgICAgICAgICAgICAgICAgPE5hdkxvZ28vPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtdC1hdXRvIG1iLWF1dG8gZC1ub25lLW1vYmlsZVwiPlxuXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibWwtNFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPFNpbXBsZVRhYnM+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qPFNpbXBsZVRhYiB0YXJnZXQ9e3twYXRobmFtZTogXCIvXCIsIGhhc2g6IFwiI1wifX0gdGV4dD1cIkRvY3VtZW50IFJlcG9zaXRvcnlcIi8+Ki99XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qPFNpbXBsZVRhYiB0YXJnZXQ9e3twYXRobmFtZTogXCIvXCIsIGhhc2g6IFwiI2Fubm90YXRpb25zXCJ9fSB0ZXh0PVwiQW5ub3RhdGlvbnNcIi8+Ki99XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qPFNpbXBsZVRhYiB0YXJnZXQ9e3twYXRobmFtZTogXCIvXCIsIGhhc2g6IFwiI3N0YXRzXCJ9fSB0ZXh0PVwiU3RhdGlzdGljc1wiLz4qL31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Lyo8U2ltcGxlVGFiIHRhcmdldD17e3BhdGhuYW1lOiBcIi9ncm91cHNcIn19IHRleHQ9XCJHcm91cHNcIi8+Ki99XG4gICAgICAgICAgICAgICAgICAgICAgICA8L1NpbXBsZVRhYnM+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IGlzTW9iaWxlID0gUGxhdGZvcm1zLmlzTW9iaWxlKCk7XG5cbiAgICAgICAgcmV0dXJuIChcblxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJyZXBvLXNpZGViYXJcIj5cblxuICAgICAgICAgICAgICAgIDxHRFBSTm90aWNlLz5cblxuICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgIDxOYXZCdXR0b25zLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgIHsvKlJld29yayB0aGlzIHNvIHRoYXQgSSBjYW4gYWNjZXB0IHRoZSBFU0Mga2V5IGJpbmRpbmcgaGVyZS4qL31cbiAgICAgICAgICAgICAgICB7LypodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zNzQ0MDQwOC9ob3ctdG8tZGV0ZWN0LWVzYy1rZXktcHJlc3MtaW4tcmVhY3QtYW5kLWhvdy10by1oYW5kbGUtaXQvNDYxMjM5NjIqL31cblxuICAgICAgICAgICAgICAgIDxzZWN0aW9uIGNsYXNzTmFtZT1cInNpZGViYXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXtzaWRlYmFyU3R5bGV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1leHBhbmRlZD17dGhpcy5zdGF0ZS5leHBhbmRlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICBvbktleVVwPXtldmVudCA9PiB0aGlzLm9uS2V5VXAoZXZlbnQpfT5cblxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInN1YmhlYWRlclwiIHN0eWxlPXtTdHlsZXMuc3ViaGVhZGVyfT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPE5hdkJ1dHRvbnMvPlxuXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgIDxOdWxsQ29sbGFwc2Ugb3Blbj17ISBpc01vYmlsZX0+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxMaXN0R3JvdXAgZmx1c2g+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8UmVwb1NpZGViYXJJdGVtIGlkPVwic2lkZWJhci1pdGVtLWRvY3VtZW50c1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwPVwiTWFuYWdlIGFsbCBkb2N1bWVudHMgeW91J3JlIHJlYWRpbmcgaW5jbHVkaW5nIGZpbHRlcmluZyBhbmQgc29ydGluZy5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0PXt7cGF0aG5hbWU6IFwiL1wifX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMudG9nZ2xlKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwiZmFzIGZhLWFyY2hpdmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD1cIkRvY3VtZW50c1wiLz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSZXBvU2lkZWJhckl0ZW0gaWQ9XCJzaWRlYmFyLWl0ZW0tYW5ub3RhdGlvbnNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcD1cIk1hbmFnZSBhbGwgYW5ub3RhdGlvbnMgb2YgYWxsIHlvdXIgZG9jdW1lbnRzIGluIG9uZSBjZW50cmFsIHZpZXcuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldD17e3BhdGhuYW1lOiBcIi9cIiwgaGFzaDogXCJhbm5vdGF0aW9uc1wifX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMudG9nZ2xlKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwiZmFzIGZhLWxheWVyLWdyb3VwXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9XCJBbm5vdGF0aW9uc1wiLz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSZXBvU2lkZWJhckl0ZW0gaWQ9XCJzaWRlYmFyLWl0ZW0tZ3JvdXBzXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXA9XCJTaG93IHB1YmxpYyBncm91cHNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0PXt7cGF0aG5hbWU6IFwiL2dyb3Vwc1wifX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMudG9nZ2xlKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwiZmFzIGZhLXVzZXItZnJpZW5kc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0PVwiR3JvdXBzXCIvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qPFJlcG9TaWRlYmFySXRlbSBocmVmPVwiI2VkaXRvcnMtcGlja3NcIiovfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qb25DbGljaz17KCkgPT4gdGhpcy50b2dnbGUoKX0qL31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKmljb25DbGFzc05hbWU9XCJmYXMgZmEtc3RhclwiKi99XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Lyp0ZXh0PVwiRWRpdG9ycyBQaWNrc1wiLz4qL31cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSZXBvU2lkZWJhckl0ZW0gaWQ9XCJzaWRlYmFyLWl0ZW0tc3RhdHNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcD1cIlNob3cgc3RhdHMgb24geW91ciB1c2FnZSBvZiBQb2xhciBpbmNsdWRpbmcgc3RhdHMgb24gdGFncywgcmF0ZSBvZiBkb2N1bWVudCBhZGRpdGlvbiwgZXRjLlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ9e3twYXRobmFtZTogXCIvXCIsIGhhc2g6IFwic3RhdHNcIn19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnRvZ2dsZSgpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cImZhcyBmYS1jaGFydC1saW5lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9XCJTdGF0aXN0aWNzXCIvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFJlcG9TaWRlYmFySXRlbSBpZD1cInNpZGViYXItaXRlbS1sb2dzXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXA9XCJTaG93IGxvZ3Mgb24gaW50ZXJuYWwgYWN0aXZpdHkgZHVyaW5nIGJhY2tncm91bmQgb3BlcmF0aW9ucyBsaWtlIGNsb3VkIGFjdGl2aXR5IGFuZCBzeW5jLlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ9e3twYXRobmFtZTogXCIvXCIsIGhhc2g6IFwibG9nc1wifX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMudG9nZ2xlKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwiZmFzIGZhLWluZm8tY2lyY2xlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9XCJMb2dzXCIvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFJlcG9TaWRlYmFySXRlbSBpZD1cInNpZGViYXItaXRlbS1zdXBwb3J0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXA9XCJHZXQgc3VwcG9ydCBmb3IgUG9sYXIuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldD17e3BhdGhuYW1lOiBcIi9cIiwgaGFzaDogXCJzdXBwb3J0XCJ9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy50b2dnbGUoKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU9XCJmYXMgZmEtaGFuZHMtaGVscGluZ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0PVwiU3VwcG9ydFwiLz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSZXBvU2lkZWJhckl0ZW0gaWQ9XCJzaWRlYmFyLWl0ZW0tdXBncmFkZS10by1wcmVtaXVtXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXA9XCJVcGdyYWRlIHRvIFBvbGFyIFByZW1pdW0gYW5kIGdldCB0aGUgYmVzdCBQb2xhciBleHBlcmllbmNlIHBvc3NpYmxlLlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ9e3twYXRobmFtZTogXCIvXCIsIGhhc2g6IFwicGxhbnNcIn19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnRvZ2dsZSgpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cImZhcyBmYS1jZXJ0aWZpY2F0ZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0PVwiVXBncmFkZSB0byBQcmVtaXVtXCIvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFJlcG9TaWRlYmFySXRlbSBpZD1cInNpZGViYXItaXRlbS13aGF0c25ld1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwPVwiRmluZCBvdXQgd2hhdCdzIG5ldyB3aXRoIGVhY2ggUG9sYXIgcmVsZWFzZS5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0PXt7cGF0aG5hbWU6IFwiL1wiLCBoYXNoOiBcIndoYXRzLW5ld1wifX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRoaXMudG9nZ2xlKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwiZmFzIGZhLWJ1bGxob3JuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9XCJXaGF0cyBOZXdcIi8+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvTGlzdEdyb3VwPlxuXG4gICAgICAgICAgICAgICAgICAgIDwvTnVsbENvbGxhcHNlPlxuXG4gICAgICAgICAgICAgICAgPC9zZWN0aW9uPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgb25LZXlVcChldmVudDogUmVhY3QuS2V5Ym9hcmRFdmVudDxIVE1MRWxlbWVudD4pIHtcblxuICAgICAgICAvLyBub29wXG5cbiAgICB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZSgpIHtcblxuICAgICAgICBjb25zdCBleHBhbmRlZCA9ICEgdGhpcy5zdGF0ZS5leHBhbmRlZDtcblxuICAgICAgICBCbGFja291dC50b2dnbGUoZXhwYW5kZWQpO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZXhwYW5kZWRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQXBwQWN0aXZpdGllcy5nZXQoKS5kaXNwYXRjaEV2ZW50KHtuYW1lOiAnc2lkZWJhci10b2dnbGVkJywgZGF0YTpcbiAgICAgICAgLy8ge2V4cGFuZGVkfX0pO1xuXG4gICAgfVxuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2lkZWJhclN0YXR1cyB7XG4gICAgcmVhZG9ubHkgZXhwYW5kZWQ6IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBJUHJvcHMge1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICByZWFkb25seSBleHBhbmRlZDogYm9vbGVhbjtcbn1cblxuIl19