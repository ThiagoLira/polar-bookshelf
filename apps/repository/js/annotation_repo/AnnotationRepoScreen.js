"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const React = __importStar(require("react"));
const RepoHeader_1 = require("../repo_header/RepoHeader");
const MessageBanner_1 = require("../MessageBanner");
const FixedNav_1 = require("../FixedNav");
const PreviewAndMainViewDock_1 = __importDefault(require("./PreviewAndMainViewDock"));
const Dock_1 = require("../../../../web/js/ui/dock/Dock");
const TagTree_1 = require("../../../../web/js/ui/tree/TagTree");
const AnnotationRepoFilterEngine_1 = require("./AnnotationRepoFilterEngine");
const PersistenceLayerManagers_1 = require("../../../../web/js/datastore/PersistenceLayerManagers");
const RepoDocMetaLoaders_1 = require("../RepoDocMetaLoaders");
const AnnotationRepoFiltersHandler_1 = require("./AnnotationRepoFiltersHandler");
const ReleasingReactComponent_1 = __importDefault(require("../framework/ReleasingReactComponent"));
const Tags_1 = require("polar-shared/src/tags/Tags");
const FilteredTags_1 = require("../FilteredTags");
const TreeState_1 = require("../../../../web/js/ui/tree/TreeState");
const Row_1 = require("../../../../web/js/ui/layout/Row");
const Reviewers_1 = require("../reviewer/Reviewers");
const TextFilter_1 = require("./filter_bar/TextFilter");
const HighlightColorFilterButton_1 = require("./filter_bar/controls/color/HighlightColorFilterButton");
const AnnotationTypeSelector_1 = require("./filter_bar/controls/annotation_type/AnnotationTypeSelector");
const StartReviewDropdown_1 = require("./filter_bar/StartReviewDropdown");
const RepoFooter_1 = require("../repo_footer/RepoFooter");
class AnnotationRepoScreen extends ReleasingReactComponent_1.default {
    constructor(props, context) {
        super(props, context);
        this.selectedTags = [];
        this.selectedFolders = [];
        this.onSelectedFolders = this.onSelectedFolders.bind(this);
        this.onUpdatedTags = this.onUpdatedTags.bind(this);
        this.startReview = this.startReview.bind(this);
        this.state = {
            data: [],
            tags: [],
        };
        const onSelected = (values) => this.onSelectedFolders(values);
        this.treeState = new TreeState_1.TreeState(onSelected);
        const setStateInBackground = (state) => {
            setTimeout(() => {
                this.setState(state);
            }, 1);
        };
        const onUpdated = repoAnnotations => {
            const tags = this.props.repoDocMetaManager.repoDocAnnotationIndex.toTagDescriptors();
            const state = Object.assign(Object.assign({}, this.state), { data: repoAnnotations, tags });
            setStateInBackground(state);
        };
        const repoAnnotationsProvider = () => this.props.repoDocMetaManager.repoDocAnnotationIndex.values();
        const filterEngine = new AnnotationRepoFilterEngine_1.AnnotationRepoFilterEngine(repoAnnotationsProvider, onUpdated);
        this.filtersHandler = new AnnotationRepoFiltersHandler_1.AnnotationRepoFiltersHandler(filters => filterEngine.onFiltered(filters));
        const doRefresh = () => filterEngine.onProviderUpdated();
        PersistenceLayerManagers_1.PersistenceLayerManagers.onPersistenceManager(this.props.persistenceLayerManager, (persistenceLayer) => {
            this.releaser.register(persistenceLayer.addEventListener(() => doRefresh()));
        });
        this.releaser.register(RepoDocMetaLoaders_1.RepoDocMetaLoaders.addThrottlingEventListener(this.props.repoDocMetaLoader, () => doRefresh()));
        doRefresh();
    }
    render() {
        return (React.createElement(FixedNav_1.FixedNav, { id: "doc-repository", className: "annotations-view" },
            React.createElement("header", null,
                React.createElement(RepoHeader_1.RepoHeader, { persistenceLayerManager: this.props.persistenceLayerManager }),
                React.createElement(Row_1.Row, { id: "header-filter", className: "border-bottom p-1" },
                    React.createElement(Row_1.Row.Main, null,
                        React.createElement(StartReviewDropdown_1.StartReviewDropdown, { onFlashcards: () => this.startReview('flashcard'), onReading: () => this.startReview('reading') })),
                    React.createElement(Row_1.Row.Right, null,
                        React.createElement("div", { style: { display: 'flex' } },
                            React.createElement("div", { className: "mr-1" },
                                React.createElement(AnnotationTypeSelector_1.AnnotationTypeSelector, { selected: this.filtersHandler.filters.annotationTypes || [], onSelected: annotationTypes => this.filtersHandler.update({ annotationTypes }) })),
                            React.createElement("div", { className: "mr-1" },
                                React.createElement(HighlightColorFilterButton_1.HighlightColorFilterButton, { selected: this.filtersHandler.filters.colors, onSelected: selected => this.filtersHandler.update({ colors: selected }) })),
                            React.createElement("div", { className: "d-none-mobile" },
                                React.createElement(TextFilter_1.TextFilter, { updateFilters: filters => this.filtersHandler.update(filters) }))))),
                React.createElement(MessageBanner_1.MessageBanner, null)),
            React.createElement(Dock_1.Dock, { componentClassNames: {
                    left: 'd-none-mobile',
                    splitter: 'd-none-mobile'
                }, left: React.createElement("div", { style: {
                        display: 'flex',
                        flexDirection: 'column',
                        height: '100%',
                        overflow: 'auto',
                    } },
                    React.createElement("div", { className: "m-1" },
                        React.createElement(TagTree_1.TagTree, { tags: this.state.tags, treeState: this.treeState, rootTitle: "Folders", tagType: 'folder', noCreate: true }),
                        React.createElement(TagTree_1.TagTree, { tags: this.state.tags, treeState: this.treeState, rootTitle: "Tags", tagType: 'regular', filterDisabled: true, noCreate: true }))), right: React.createElement(PreviewAndMainViewDock_1.default, Object.assign({ data: this.state.data, updateFilters: filters => this.filtersHandler.update(filters) }, this.props)), side: 'left', initialWidth: 300 }),
            React.createElement(RepoFooter_1.RepoFooter, null)));
    }
    onSelectedFolders(selected) {
        this.selectedFolders = selected.map(current => Tags_1.Tags.create(current));
        this.onUpdatedTags();
    }
    onUpdatedTags() {
        const tags = [...this.selectedTags, ...this.selectedFolders];
        const filteredTags = new FilteredTags_1.FilteredTags();
        filteredTags.set(tags);
        this.filtersHandler.update({ filteredTags });
    }
    startReview(mode = 'reading') {
        const persistenceLayer = this.props.persistenceLayerManager.get();
        const datastoreCapabilities = persistenceLayer.capabilities();
        const prefs = persistenceLayer.datastore.getPrefs();
        Reviewers_1.Reviewers.start(datastoreCapabilities, prefs.get().prefs, this.state.data, mode, 10);
    }
}
exports.default = AnnotationRepoScreen;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5ub3RhdGlvblJlcG9TY3JlZW4uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBbm5vdGF0aW9uUmVwb1NjcmVlbi50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQStCO0FBTy9CLDBEQUFxRDtBQUNyRCxvREFBK0M7QUFDL0MsMENBQXFDO0FBQ3JDLHNGQUE4RDtBQUM5RCwwREFBcUQ7QUFDckQsZ0VBQTJEO0FBQzNELDZFQUF5RjtBQUN6RixvR0FBK0Y7QUFDL0YsOERBQXlEO0FBQ3pELGlGQUE0RTtBQUM1RSxtR0FBMkU7QUFFM0UscURBQTZEO0FBQzdELGtEQUE2QztBQUM3QyxvRUFBK0Q7QUFDL0QsMERBQXFEO0FBQ3JELHFEQUFnRDtBQUNoRCx3REFBbUQ7QUFDbkQsdUdBQWtHO0FBQ2xHLHlHQUFvRztBQUNwRywwRUFBcUU7QUFFckUsMERBQXFEO0FBR3JELE1BQXFCLG9CQUFxQixTQUFRLGlDQUF1QztJQWdCckYsWUFBWSxLQUFhLEVBQUUsT0FBWTtRQUNuQyxLQUFLLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBUmxCLGlCQUFZLEdBQXVCLEVBQUUsQ0FBQztRQUt0QyxvQkFBZSxHQUF1QixFQUFFLENBQUM7UUFLN0MsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRS9DLElBQUksQ0FBQyxLQUFLLEdBQUc7WUFDVCxJQUFJLEVBQUUsRUFBRTtZQUNSLElBQUksRUFBRSxFQUFFO1NBQ1gsQ0FBQztRQUVGLE1BQU0sVUFBVSxHQUFHLENBQUMsTUFBNkIs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Q0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNsRSxNQUFNLHFCQUFxQixHQUFHLGdCQUFnQixDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzlELE1BQU0sS0FBSyxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUVwRCxxQkFBUyxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN6RixDQUFDO0NBRUo7QUFsTUQsdUNBa01DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtSZXBvRG9jTWV0YUxvYWRlcn0gZnJvbSAnLi4vUmVwb0RvY01ldGFMb2FkZXInO1xuaW1wb3J0IHtSZXBvRG9jTWV0YU1hbmFnZXJ9IGZyb20gJy4uL1JlcG9Eb2NNZXRhTWFuYWdlcic7XG5pbXBvcnQge0lEb2NJbmZvfSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL21ldGFkYXRhL0lEb2NJbmZvJztcbmltcG9ydCB7U3luY0JhclByb2dyZXNzfSBmcm9tICcuLi8uLi8uLi8uLi93ZWIvanMvdWkvc3luY19iYXIvU3luY0Jhcic7XG5pbXBvcnQge0lFdmVudERpc3BhdGNoZXJ9IGZyb20gJy4uLy4uLy4uLy4uL3dlYi9qcy9yZWFjdG9yL1NpbXBsZVJlYWN0b3InO1xuaW1wb3J0IHtQZXJzaXN0ZW5jZUxheWVyTWFuYWdlcn0gZnJvbSAnLi4vLi4vLi4vLi4vd2ViL2pzL2RhdGFzdG9yZS9QZXJzaXN0ZW5jZUxheWVyTWFuYWdlcic7XG5pbXBvcnQge1JlcG9IZWFkZXJ9IGZyb20gJy4uL3JlcG9faGVhZGVyL1JlcG9IZWFkZXInO1xuaW1wb3J0IHtNZXNzYWdlQmFubmVyfSBmcm9tICcuLi9NZXNzYWdlQmFubmVyJztcbmltcG9ydCB7Rml4ZWROYXZ9IGZyb20gJy4uL0ZpeGVkTmF2JztcbmltcG9ydCBQcmV2aWV3QW5kTWFpblZpZXdEb2NrIGZyb20gJy4vUHJldmlld0FuZE1haW5WaWV3RG9jayc7XG5pbXBvcnQge0RvY2t9IGZyb20gJy4uLy4uLy4uLy4uL3dlYi9qcy91aS9kb2NrL0RvY2snO1xuaW1wb3J0IHtUYWdUcmVlfSBmcm9tICcuLi8uLi8uLi8uLi93ZWIvanMvdWkvdHJlZS9UYWdUcmVlJztcbmltcG9ydCB7QW5ub3RhdGlvblJlcG9GaWx0ZXJFbmdpbmUsIFVwZGF0ZWRDYWxsYmFja30gZnJvbSAnLi9Bbm5vdGF0aW9uUmVwb0ZpbHRlckVuZ2luZSc7XG5pbXBvcnQge1BlcnNpc3RlbmNlTGF5ZXJNYW5hZ2Vyc30gZnJvbSAnLi4vLi4vLi4vLi4vd2ViL2pzL2RhdGFzdG9yZS9QZXJzaXN0ZW5jZUxheWVyTWFuYWdlcnMnO1xuaW1wb3J0IHtSZXBvRG9jTWV0YUxvYWRlcnN9IGZyb20gJy4uL1JlcG9Eb2NNZXRhTG9hZGVycyc7XG5pbXBvcnQge0Fubm90YXRpb25SZXBvRmlsdGVyc0hhbmRsZXJ9IGZyb20gJy4vQW5ub3RhdGlvblJlcG9GaWx0ZXJzSGFuZGxlcic7XG5pbXBvcnQgUmVsZWFzaW5nUmVhY3RDb21wb25lbnQgZnJvbSAnLi4vZnJhbWV3b3JrL1JlbGVhc2luZ1JlYWN0Q29tcG9uZW50JztcbmltcG9ydCB7VGFnRGVzY3JpcHRvcn0gZnJvbSAnLi4vLi4vLi4vLi4vd2ViL2pzL3RhZ3MvVGFnTm9kZSc7XG5pbXBvcnQge1RhZywgVGFncywgVGFnU3RyfSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL3RhZ3MvVGFncyc7XG5pbXBvcnQge0ZpbHRlcmVkVGFnc30gZnJvbSAnLi4vRmlsdGVyZWRUYWdzJztcbmltcG9ydCB7VHJlZVN0YXRlfSBmcm9tIFwiLi4vLi4vLi4vLi4vd2ViL2pzL3VpL3RyZWUvVHJlZVN0YXRlXCI7XG5pbXBvcnQge1Jvd30gZnJvbSBcIi4uLy4uLy4uLy4uL3dlYi9qcy91aS9sYXlvdXQvUm93XCI7XG5pbXBvcnQge1Jldmlld2Vyc30gZnJvbSBcIi4uL3Jldmlld2VyL1Jldmlld2Vyc1wiO1xuaW1wb3J0IHtUZXh0RmlsdGVyfSBmcm9tIFwiLi9maWx0ZXJfYmFyL1RleHRGaWx0ZXJcIjtcbmltcG9ydCB7SGlnaGxpZ2h0Q29sb3JGaWx0ZXJCdXR0b259IGZyb20gXCIuL2ZpbHRlcl9iYXIvY29udHJvbHMvY29sb3IvSGlnaGxpZ2h0Q29sb3JGaWx0ZXJCdXR0b25cIjtcbmltcG9ydCB7QW5ub3RhdGlvblR5cGVTZWxlY3Rvcn0gZnJvbSBcIi4vZmlsdGVyX2Jhci9jb250cm9scy9hbm5vdGF0aW9uX3R5cGUvQW5ub3RhdGlvblR5cGVTZWxlY3RvclwiO1xuaW1wb3J0IHtTdGFydFJldmlld0Ryb3Bkb3dufSBmcm9tIFwiLi9maWx0ZXJfYmFyL1N0YXJ0UmV2aWV3RHJvcGRvd25cIjtcbmltcG9ydCB7UmVwZXRpdGlvbk1vZGV9IGZyb20gXCJwb2xhci1zcGFjZWQtcmVwZXRpdGlvbi1hcGkvc3JjL3NjaGVkdWxlci9TMlBsdXMvUzJQbHVzXCI7XG5pbXBvcnQge1JlcG9Gb290ZXJ9IGZyb20gXCIuLi9yZXBvX2Zvb3Rlci9SZXBvRm9vdGVyXCI7XG5pbXBvcnQge0lEb2NBbm5vdGF0aW9ufSBmcm9tIFwiLi4vLi4vLi4vLi4vd2ViL2pzL2Fubm90YXRpb25fc2lkZWJhci9Eb2NBbm5vdGF0aW9uXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFubm90YXRpb25SZXBvU2NyZWVuIGV4dGVuZHMgUmVsZWFzaW5nUmVhY3RDb21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgdHJlZVN0YXRlOiBUcmVlU3RhdGU8VGFnRGVzY3JpcHRvcj47XG5cbiAgICBwcml2YXRlIHJlYWRvbmx5IGZpbHRlcnNIYW5kbGVyOiBBbm5vdGF0aW9uUmVwb0ZpbHRlcnNIYW5kbGVyO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHRhZ3MgdGhhdCBhcmUgc2VsZWN0ZWQgYnkgdGhlIHVzZXIuXG4gICAgICovXG4gICAgcHJpdmF0ZSBzZWxlY3RlZFRhZ3M6IFJlYWRvbmx5QXJyYXk8VGFnPiA9IFtdO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHRhZ3MgdGhhdCBhcmUgc2VsZWN0ZWQgYnkgdGhlIHVzZXIuXG4gICAgICovXG4gICAgcHJpdmF0ZSBzZWxlY3RlZEZvbGRlcnM6IFJlYWRvbmx5QXJyYXk8VGFnPiA9IFtdO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcywgY29udGV4dDogYW55KSB7XG4gICAgICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcblxuICAgICAgICB0aGlzLm9uU2VsZWN0ZWRGb2xkZXJzID0gdGhpcy5vblNlbGVjdGVkRm9sZGVycy5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm9uVXBkYXRlZFRhZ3MgPSB0aGlzLm9uVXBkYXRlZFRhZ3MuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5zdGFydFJldmlldyA9IHRoaXMuc3RhcnRSZXZpZXcuYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICB0YWdzOiBbXSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBvblNlbGVjdGVkID0gKHZhbHVlczogUmVhZG9ubHlBcnJheTxUYWdTdHI+KSA9PiB0aGlzLm9uU2VsZWN0ZWRGb2xkZXJzKHZhbHVlcyk7XG5cbiAgICAgICAgdGhpcy50cmVlU3RhdGUgPSBuZXcgVHJlZVN0YXRlKG9uU2VsZWN0ZWQpO1xuXG4gICAgICAgIGNvbnN0IHNldFN0YXRlSW5CYWNrZ3JvdW5kID0gKHN0YXRlOiBJU3RhdGUpID0+IHtcblxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG5cbiAgICAgICAgICAgICAgICAvLyBUaGUgcmVhY3QgdGFibGUgd2lsbCBub3QgdXBkYXRlIHdoZW4gSSBjaGFuZ2UgdGhlIHN0YXRlIGZyb21cbiAgICAgICAgICAgICAgICAvLyB3aXRoaW4gdGhlIGV2ZW50IGxpc3RlbmVyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSk7XG5cbiAgICAgICAgICAgIH0sIDEpO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3Qgb25VcGRhdGVkOiBVcGRhdGVkQ2FsbGJhY2sgPSByZXBvQW5ub3RhdGlvbnMgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCB0YWdzID0gdGhpcy5wcm9wcy5yZXBvRG9jTWV0YU1hbmFnZXIucmVwb0RvY0Fubm90YXRpb25JbmRleC50b1RhZ0Rlc2NyaXB0b3JzKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gey4uLnRoaXMuc3RhdGUsIGRhdGE6IHJlcG9Bbm5vdGF0aW9ucywgdGFnc307XG5cbiAgICAgICAgICAgIHNldFN0YXRlSW5CYWNrZ3JvdW5kKHN0YXRlKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlcG9Bbm5vdGF0aW9uc1Byb3ZpZGVyOiAoKSA9PiBSZWFkb25seUFycmF5PElEb2NBbm5vdGF0aW9uPiA9XG4gICAgICAgICAgICAoKSA9PiB0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTWFuYWdlciEucmVwb0RvY0Fubm90YXRpb25JbmRleC52YWx1ZXMoKTtcblxuICAgICAgICBjb25zdCBmaWx0ZXJFbmdpbmUgPSBuZXcgQW5ub3RhdGlvblJlcG9GaWx0ZXJFbmdpbmUocmVwb0Fubm90YXRpb25zUHJvdmlkZXIsIG9uVXBkYXRlZCk7XG5cbiAgICAgICAgdGhpcy5maWx0ZXJzSGFuZGxlciA9IG5ldyBBbm5vdGF0aW9uUmVwb0ZpbHRlcnNIYW5kbGVyKGZpbHRlcnMgPT4gZmlsdGVyRW5naW5lLm9uRmlsdGVyZWQoZmlsdGVycykpO1xuXG4gICAgICAgIGNvbnN0IGRvUmVmcmVzaCA9ICgpID0+IGZpbHRlckVuZ2luZS5vblByb3ZpZGVyVXBkYXRlZCgpO1xuXG4gICAgICAgIFBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2Vycy5vblBlcnNpc3RlbmNlTWFuYWdlcih0aGlzLnByb3BzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyLCAocGVyc2lzdGVuY2VMYXllcikgPT4ge1xuXG4gICAgICAgICAgICB0aGlzLnJlbGVhc2VyLnJlZ2lzdGVyKFxuICAgICAgICAgICAgICAgIHBlcnNpc3RlbmNlTGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcigoKSA9PiBkb1JlZnJlc2goKSkpO1xuXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucmVsZWFzZXIucmVnaXN0ZXIoXG4gICAgICAgICAgICBSZXBvRG9jTWV0YUxvYWRlcnMuYWRkVGhyb3R0bGluZ0V2ZW50TGlzdGVuZXIodGhpcy5wcm9wcy5yZXBvRG9jTWV0YUxvYWRlciwgKCkgPT4gZG9SZWZyZXNoKCkpKTtcblxuICAgICAgICAvLyBkbyBhbiBpbml0aWFsIHJlZnJlc2ggdG8gZ2V0IHRoZSBmaXJzdCBiYXRjaCBvZiBkYXRhLlxuICAgICAgICBkb1JlZnJlc2goKTtcblxuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG5cbiAgICAgICAgcmV0dXJuIChcblxuICAgICAgICAgICAgPEZpeGVkTmF2IGlkPVwiZG9jLXJlcG9zaXRvcnlcIlxuICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImFubm90YXRpb25zLXZpZXdcIj5cblxuICAgICAgICAgICAgICAgIDxoZWFkZXI+XG4gICAgICAgICAgICAgICAgICAgIDxSZXBvSGVhZGVyIHBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyPXt0aGlzLnByb3BzLnBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyfS8+XG5cbiAgICAgICAgICAgICAgICAgICAgPFJvdyBpZD1cImhlYWRlci1maWx0ZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImJvcmRlci1ib3R0b20gcC0xXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Um93Lk1haW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qPFN0YXJ0UmV2aWV3QnV0dG9uIG9uQ2xpY2s9eygpID0+IHRoaXMuc3RhcnRSZXZpZXcoJ2ZsYXNoY2FyZCcpfS8+Ki99XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFN0YXJ0UmV2aWV3RHJvcGRvd24gb25GbGFzaGNhcmRzPXsoKSA9PiB0aGlzLnN0YXJ0UmV2aWV3KCdmbGFzaGNhcmQnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblJlYWRpbmc9eygpID0+IHRoaXMuc3RhcnRSZXZpZXcoJ3JlYWRpbmcnKX0vPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Sb3cuTWFpbj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPFJvdy5SaWdodD5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiAnZmxleCd9fT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1yLTFcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxBbm5vdGF0aW9uVHlwZVNlbGVjdG9yIHNlbGVjdGVkPXt0aGlzLmZpbHRlcnNIYW5kbGVyLmZpbHRlcnMuYW5ub3RhdGlvblR5cGVzIHx8IFtdfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TZWxlY3RlZD17YW5ub3RhdGlvblR5cGVzID0+IHRoaXMuZmlsdGVyc0hhbmRsZXIudXBkYXRlKHthbm5vdGF0aW9uVHlwZXN9KX0vPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1yLTFcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxIaWdobGlnaHRDb2xvckZpbHRlckJ1dHRvbiBzZWxlY3RlZD17dGhpcy5maWx0ZXJzSGFuZGxlci5maWx0ZXJzLmNvbG9yc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdGVkPXtzZWxlY3RlZCA9PiB0aGlzLmZpbHRlcnNIYW5kbGVyLnVwZGF0ZSh7Y29sb3JzOiBzZWxlY3RlZH0pfS8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZC1ub25lLW1vYmlsZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRleHRGaWx0ZXIgdXBkYXRlRmlsdGVycz17ZmlsdGVycyA9PiB0aGlzLmZpbHRlcnNIYW5kbGVyLnVwZGF0ZShmaWx0ZXJzKX0vPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8L1Jvdy5SaWdodD5cblxuICAgICAgICAgICAgICAgICAgICA8L1Jvdz5cblxuICAgICAgICAgICAgICAgICAgICA8TWVzc2FnZUJhbm5lci8+XG5cbiAgICAgICAgICAgICAgICA8L2hlYWRlcj5cblxuICAgICAgICAgICAgICAgIDxEb2NrIGNvbXBvbmVudENsYXNzTmFtZXM9e3tcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6ICdkLW5vbmUtbW9iaWxlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0dGVyOiAnZC1ub25lLW1vYmlsZSdcbiAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgIGxlZnQ9e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIHRoaXMgc2hvdWxkIGJlIGl0cyBvd24gY29tcG9uZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JyAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfX0+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm0tMVwiPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUYWdUcmVlIHRhZ3M9e3RoaXMuc3RhdGUudGFnc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZVN0YXRlPXt0aGlzLnRyZWVTdGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdFRpdGxlPVwiRm9sZGVyc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ1R5cGU9J2ZvbGRlcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9DcmVhdGU9e3RydWV9Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGFnVHJlZSB0YWdzPXt0aGlzLnN0YXRlLnRhZ3N9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVTdGF0ZT17dGhpcy50cmVlU3RhdGV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RUaXRsZT1cIlRhZ3NcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdUeXBlPSdyZWd1bGFyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJEaXNhYmxlZD17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9DcmVhdGU9e3RydWV9Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgcmlnaHQ9e1xuICAgICAgICAgICAgICAgICAgICAgICAgICA8UHJldmlld0FuZE1haW5WaWV3RG9jayBkYXRhPXt0aGlzLnN0YXRlLmRhdGF9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUZpbHRlcnM9e2ZpbHRlcnMgPT4gdGhpcy5maWx0ZXJzSGFuZGxlci51cGRhdGUoZmlsdGVycyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsuLi50aGlzLnByb3BzfS8+XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIHNpZGU9J2xlZnQnXG4gICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFdpZHRoPXszMDB9Lz5cblxuICAgICAgICAgICAgICAgIDxSZXBvRm9vdGVyLz5cblxuICAgICAgICAgICAgPC9GaXhlZE5hdj5cblxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25TZWxlY3RlZEZvbGRlcnMoc2VsZWN0ZWQ6IFJlYWRvbmx5QXJyYXk8VGFnU3RyPikge1xuICAgICAgICB0aGlzLnNlbGVjdGVkRm9sZGVycyA9IHNlbGVjdGVkLm1hcChjdXJyZW50ID0+IFRhZ3MuY3JlYXRlKGN1cnJlbnQpKTtcbiAgICAgICAgdGhpcy5vblVwZGF0ZWRUYWdzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblVwZGF0ZWRUYWdzKCkge1xuXG4gICAgICAgIGNvbnN0IHRhZ3MgPSBbLi4udGhpcy5zZWxlY3RlZFRhZ3MsIC4uLnRoaXMuc2VsZWN0ZWRGb2xkZXJzXTtcblxuICAgICAgICBjb25zdCBmaWx0ZXJlZFRhZ3MgPSBuZXcgRmlsdGVyZWRUYWdzKCk7XG4gICAgICAgIGZpbHRlcmVkVGFncy5zZXQodGFncyk7XG5cbiAgICAgICAgdGhpcy5maWx0ZXJzSGFuZGxlci51cGRhdGUoe2ZpbHRlcmVkVGFnc30pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhcnRSZXZpZXcobW9kZTogUmVwZXRpdGlvbk1vZGUgPSAncmVhZGluZycpIHtcbiAgICAgICAgY29uc3QgcGVyc2lzdGVuY2VMYXllciA9IHRoaXMucHJvcHMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIuZ2V0KCk7XG4gICAgICAgIGNvbnN0IGRhdGFzdG9yZUNhcGFiaWxpdGllcyA9IHBlcnNpc3RlbmNlTGF5ZXIuY2FwYWJpbGl0aWVzKCk7XG4gICAgICAgIGNvbnN0IHByZWZzID0gcGVyc2lzdGVuY2VMYXllci5kYXRhc3RvcmUuZ2V0UHJlZnMoKTtcblxuICAgICAgICBSZXZpZXdlcnMuc3RhcnQoZGF0YXN0b3JlQ2FwYWJpbGl0aWVzLCBwcmVmcy5nZXQoKS5wcmVmcywgdGhpcy5zdGF0ZS5kYXRhLCBtb2RlLCAxMCk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVByb3BzIHtcblxuICAgIHJlYWRvbmx5IHBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyOiBQZXJzaXN0ZW5jZUxheWVyTWFuYWdlcjtcblxuICAgIHJlYWRvbmx5IHVwZGF0ZWREb2NJbmZvRXZlbnREaXNwYXRjaGVyOiBJRXZlbnREaXNwYXRjaGVyPElEb2NJbmZvPjtcblxuICAgIHJlYWRvbmx5IHN5bmNCYXJQcm9ncmVzczogSUV2ZW50RGlzcGF0Y2hlcjxTeW5jQmFyUHJvZ3Jlc3M+O1xuXG4gICAgcmVhZG9ubHkgcmVwb0RvY01ldGFNYW5hZ2VyOiBSZXBvRG9jTWV0YU1hbmFnZXI7XG5cbiAgICByZWFkb25seSByZXBvRG9jTWV0YUxvYWRlcjogUmVwb0RvY01ldGFMb2FkZXI7XG5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJU3RhdGUge1xuXG4gICAgcmVhZG9ubHkgcmVwb0Fubm90YXRpb24/OiBJRG9jQW5ub3RhdGlvbjtcblxuICAgIHJlYWRvbmx5IGRhdGE6IFJlYWRvbmx5QXJyYXk8SURvY0Fubm90YXRpb24+O1xuXG5cblxuICAgIC8qKlxuICAgICAqIEFsbCBhdmFpbGFibGUgdGFnc1xuICAgICAqL1xuICAgIHJlYWRvbmx5IHRhZ3M6IFJlYWRvbmx5QXJyYXk8VGFnRGVzY3JpcHRvcj47XG5cbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudGx5IHNlbGVjdGVkIHRhZ3MuXG4gICAgICovXG4gICAgLy8gcmVhZG9ubHkgc2VsZWN0ZWQ6IFJlYWRvbmx5QXJyYXk8VGFnU3RyPjtcblxufVxuXG4iXX0=