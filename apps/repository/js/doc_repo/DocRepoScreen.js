"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const React = __importStar(require("react"));
const Logger_1 = require("polar-shared/src/logger/Logger");
const Optional_1 = require("polar-shared/src/util/ts/Optional");
const Tags_1 = require("polar-shared/src/tags/Tags");
const Preconditions_1 = require("polar-shared/src/Preconditions");
const RendererAnalytics_1 = require("../../../../web/js/ga/RendererAnalytics");
const MessageBanner_1 = require("../MessageBanner");
const DocRepoTableDropdown_1 = require("./DocRepoTableDropdown");
const DocRepoTableColumns_1 = require("./DocRepoTableColumns");
const SettingsStore_1 = require("../../../../web/js/datastore/SettingsStore");
const RepoDocMetaLoaders_1 = require("../RepoDocMetaLoaders");
const PersistenceLayerManagers_1 = require("../../../../web/js/datastore/PersistenceLayerManagers");
const SynchronizingDocLoader_1 = require("../util/SynchronizingDocLoader");
const ReleasingReactComponent_1 = __importDefault(require("../framework/ReleasingReactComponent"));
const RepoHeader_1 = require("../repo_header/RepoHeader");
const FixedNav_1 = require("../FixedNav");
const Functions_1 = require("polar-shared/src/util/Functions");
const DocRepoFilterBar_1 = require("./DocRepoFilterBar");
const DocRepoFilters_1 = require("./DocRepoFilters");
const Toaster_1 = require("../../../../web/js/ui/toaster/Toaster");
const ProgressTracker_1 = require("polar-shared/src/util/ProgressTracker");
const ProgressMessages_1 = require("../../../../web/js/ui/progress_bar/ProgressMessages");
const Dialogs_1 = require("../../../../web/js/ui/dialogs/Dialogs");
const DocRepoButtonBar_1 = require("./DocRepoButtonBar");
const DocRepoTable_1 = require("./DocRepoTable");
const Dock_1 = require("../../../../web/js/ui/dock/Dock");
const TagTree_1 = require("../../../../web/js/ui/tree/TagTree");
const Arrays_1 = require("polar-shared/src/util/Arrays");
const Numbers_1 = require("polar-shared/src/util/Numbers");
const SelectedDocs_1 = require("./SelectedDocs");
const TreeState_1 = require("../../../../web/js/ui/tree/TreeState");
const SetArrays_1 = require("polar-shared/src/util/SetArrays");
const log = Logger_1.Logger.create();
class DocRepoScreen extends ReleasingReactComponent_1.default {
    constructor(props, context) {
        super(props, context);
        this.persistenceLayerManager = this.props.persistenceLayerManager;
        this.synchronizingDocLoader = new SynchronizingDocLoader_1.SynchronizingDocLoader(this.props.persistenceLayerManager);
        this.onDocDeleteRequested = this.onDocDeleteRequested.bind(this);
        this.onDocTagged = this.onDocTagged.bind(this);
        this.onDocDeleted = this.onDocDeleted.bind(this);
        this.onDocSetTitle = this.onDocSetTitle.bind(this);
        this.onSelectedColumns = this.onSelectedColumns.bind(this);
        this.onDocSidebarVisible = this.onDocSidebarVisible.bind(this);
        this.onFilterByTitle = this.onFilterByTitle.bind(this);
        this.onToggleFilterArchived = this.onToggleFilterArchived.bind(this);
        this.onToggleFlaggedOnly = this.onToggleFlaggedOnly.bind(this);
        this.clearSelected = this.clearSelected.bind(this);
        this.onSelected = this.onSelected.bind(this);
        this.selectRow = this.selectRow.bind(this);
        this.onMultiTagged = this.onMultiTagged.bind(this);
        this.onMultiDeleted = this.onMultiDeleted.bind(this);
        this.getSelected = this.getSelected.bind(this);
        this.getRow = this.getRow.bind(this);
        this.onDragStart = this.onDragStart.bind(this);
        this.onDragEnd = this.onDragEnd.bind(this);
        this.onRemoveFromFolder = this.onRemoveFromFolder.bind(this);
        this.state = {
            data: [],
            tags: [],
            columns: new DocRepoTableColumns_1.DocRepoTableColumns(),
            selected: [],
            docSidebarVisible: false
        };
        const onRefreshed = repoDocInfos => this.doRefresh(repoDocInfos);
        const repoDocInfosProvider = () => this.props.repoDocMetaManager.repoDocInfoIndex.values();
        this.docRepoFilters =
            new DocRepoFilters_1.DocRepoFilters(onRefreshed, repoDocInfosProvider);
        const onSelected = (tags) => this.docRepoFilters.onTagged(tags.map(current => Tags_1.Tags.create(current)));
        const onDropped = (tag) => this.onMultiTagged([tag], SelectedDocs_1.DraggingSelectedDocs.get());
        this.treeState = new TreeState_1.TreeState(onSelected, onDropped);
        this.init();
        this.initAsync()
            .catch(err => log.error("Could not init: ", err));
    }
    init() {
        PersistenceLayerManagers_1.PersistenceLayerManagers.onPersistenceManager(this.props.persistenceLayerManager, (persistenceLayer) => {
            this.releaser.register(persistenceLayer.addEventListener(() => this.refresh()));
        });
        this.releaser.register(RepoDocMetaLoaders_1.RepoDocMetaLoaders.addThrottlingEventListener(this.props.repoDocMetaLoader, () => this.refresh()));
        this.releaser.register(this.props.repoDocMetaLoader.addEventListener(event => {
            if (!DocRepoScreen.hasSentInitAnalytics && event.progress.progress === 100) {
                this.emitInitAnalytics(this.props.repoDocMetaManager.repoDocInfoIndex.size());
                DocRepoScreen.hasSentInitAnalytics = true;
            }
        }));
    }
    initAsync() {
        return __awaiter(this, void 0, void 0, function* () {
            const settingProvider = yield SettingsStore_1.SettingsStore.load();
            log.info("Settings loaded: ", settingProvider);
            Optional_1.Optional.of(settingProvider().documentRepository)
                .map(current => current.columns)
                .when(columns => {
                log.info("Loaded columns from settings: ", columns);
                this.setState(Object.assign(Object.assign({}, this.state), { columns }));
                this.refresh();
            });
            this.refresh();
        });
    }
    emitInitAnalytics(nrDocs) {
        RendererAnalytics_1.RendererAnalytics.set({ 'nrDocs': nrDocs });
        const persistenceLayerType = this.persistenceLayerManager.currentType();
        RendererAnalytics_1.RendererAnalytics.event({ category: 'document-repository', action: `docs-loaded-${persistenceLayerType}-${nrDocs}` });
    }
    onMultiTagged(tags, repoDocInfos = this.getSelected()) {
        for (const repoDocInfo of repoDocInfos) {
            const existingTags = Object.values(repoDocInfo.tags || {});
            const effectiveTags = Tags_1.Tags.union(existingTags, tags || []);
            this.onDocTagged(repoDocInfo, effectiveTags)
                .catch(err => log.error(err));
        }
    }
    onRemoveFromFolder(folder, repoDocInfos) {
        for (const repoDocInfo of repoDocInfos) {
            const existingTags = Object.values(repoDocInfo.tags || {});
            const newTags = Tags_1.Tags.difference(existingTags, [folder]);
            this.onDocTagged(repoDocInfo, newTags)
                .catch(err => log.error(err));
        }
    }
    onMultiDeleted() {
        const repoDocInfos = this.getSelected();
        this.onDocDeleteRequested(repoDocInfos);
    }
    clearSelected() {
        setTimeout(() => {
            this.setState(Object.assign(Object.assign({}, this.state), { selected: [] }));
        }, 1);
    }
    getSelected() {
        if (!this.reactTable) {
            return [];
        }
        const resolvedState = this.reactTable.getResolvedState();
        const { sortedData } = resolvedState;
        const offset = (resolvedState.page) * resolvedState.pageSize;
        const result = this.state.selected
            .map(selectedIdx => sortedData[offset + selectedIdx])
            .filter(item => Preconditions_1.isPresent(item))
            .map(item => item._original);
        return result;
    }
    getRow(viewIndex) {
        const resolvedState = this.reactTable.getResolvedState();
        const { sortedData } = resolvedState;
        const offset = (resolvedState.page) * resolvedState.pageSize;
        const idx = offset + viewIndex;
        return sortedData[idx]._original;
    }
    selectRow(selectedIdx, event, type) {
        selectedIdx = Numbers_1.Numbers.toNumber(selectedIdx);
        const computeStrategy = () => {
            if (type === 'checkbox') {
                return 'toggle';
            }
            if (type === 'click') {
                if (event.getModifierState("Shift")) {
                    return 'range';
                }
                if (event.getModifierState("Control") || event.getModifierState("Meta")) {
                    return 'toggle';
                }
            }
            if (type === 'context') {
                if (this.state.selected.includes(selectedIdx)) {
                    return 'none';
                }
            }
            return 'one';
        };
        const doStrategyRange = () => {
            let min = 0;
            let max = 0;
            if (this.state.selected.length > 0) {
                const sorted = [...this.state.selected].sort((a, b) => a - b);
                min = Arrays_1.Arrays.first(sorted);
                max = Arrays_1.Arrays.last(sorted);
            }
            const selected = [...Numbers_1.Numbers.range(Math.min(min, selectedIdx), Math.max(max, selectedIdx))];
            return selected;
        };
        const doStrategyToggle = () => {
            const selected = [...this.state.selected];
            if (selected.includes(selectedIdx)) {
                return SetArrays_1.SetArrays.difference(selected, [selectedIdx]);
            }
            else {
                return SetArrays_1.SetArrays.union(selected, [selectedIdx]);
            }
        };
        const doStrategyOne = () => {
            return [selectedIdx];
        };
        const doStrategy = () => {
            const strategy = computeStrategy();
            switch (strategy) {
                case "one":
                    return doStrategyOne();
                case "range":
                    return doStrategyRange();
                case "toggle":
                    return doStrategyToggle();
                case "none":
                    return undefined;
            }
        };
        const selected = doStrategy();
        if (selected) {
            this.setState(Object.assign(Object.assign({}, this.state), { selected }));
        }
    }
    onSelected(selected) {
        this.setState(Object.assign(Object.assign({}, this.state), { selected }));
    }
    render() {
        const tagsProvider = () => this.props.repoDocMetaManager.repoDocInfoIndex.toTagDescriptors();
        const selectedDocs = this.getSelected();
        const primaryDoc = selectedDocs.length > 0 ? selectedDocs[0] : undefined;
        const docActive = {
            right: 'd-none-mobile',
            splitter: 'd-none-mobile'
        };
        const docInactive = {
            right: 'd-none',
            splitter: 'd-none'
        };
        const rightDocComponentClassNames = this.state.docSidebarVisible ? docActive : docInactive;
        return (React.createElement("div", { id: "doc-repository", className: "", style: {
                height: '100%'
            } },
            React.createElement(FixedNav_1.FixedNav, { id: "doc-repo-table" },
                React.createElement("header", null,
                    React.createElement(RepoHeader_1.RepoHeader, { persistenceLayerManager: this.props.persistenceLayerManager }),
                    React.createElement("div", { id: "header-filter" },
                        React.createElement("div", { style: { display: 'flex' }, className: "p-1" },
                            React.createElement("div", { className: "", style: {
                                    whiteSpace: 'nowrap',
                                    marginTop: 'auto',
                                    marginBottom: 'auto',
                                    display: 'flex'
                                } },
                                React.createElement(DocRepoButtonBar_1.DocRepoButtonBar, { hasSelected: this.state.selected.length > 0, tagsProvider: tagsProvider, onMultiTagged: tags => this.onMultiTagged(tags), onMultiDeleted: () => this.onMultiDeleted() })),
                            React.createElement("div", { style: { marginLeft: 'auto' } },
                                React.createElement(DocRepoFilterBar_1.DocRepoFilterBar, { onToggleFlaggedOnly: value => this.onToggleFlaggedOnly(value), onToggleFilterArchived: value => this.onToggleFilterArchived(value), onFilterByTitle: (title) => this.onFilterByTitle(title), tagsDBProvider: () => this.props.repoDocMetaManager.tagsDB, refresher: () => this.refresh(), filteredTags: this.docRepoFilters.filters.filteredTags, docSidebarVisible: this.state.docSidebarVisible, onDocSidebarVisible: visible => this.onDocSidebarVisible(visible), right: React.createElement("div", { className: "d-mobile-none", style: { whiteSpace: 'nowrap', marginTop: 'auto', marginBottom: 'auto' } },
                                        React.createElement(DocRepoTableDropdown_1.DocRepoTableDropdown, { id: "table-dropdown", options: Object.values(this.state.columns), onSelectedColumns: (selectedColumns) => this.onSelectedColumns(selectedColumns) })) })))),
                    React.createElement(MessageBanner_1.MessageBanner, null)),
                React.createElement(Dock_1.Dock, { componentClassNames: {
                        left: 'd-none-mobile',
                        splitter: 'd-none-mobile'
                    }, side: 'left', initialWidth: 300, left: React.createElement("div", { style: {
                            display: 'flex',
                            flexDirection: 'column',
                            height: '100%',
                            overflow: 'auto'
                        } },
                        React.createElement("div", { className: "p-1 border-top" },
                            React.createElement(TagTree_1.TagTree, { tags: this.state.tags, treeState: this.treeState, rootTitle: "Folders", tagType: 'folder', noCreate: true }),
                            React.createElement(TagTree_1.TagTree, { tags: this.state.tags, treeState: this.treeState, rootTitle: "Tags", tagType: 'regular', filterDisabled: true, noCreate: true }))), right: React.createElement(Dock_1.Dock, { componentClassNames: rightDocComponentClassNames, side: 'right', initialWidth: 300, left: React.createElement(DocRepoTable_1.DocRepoTable, { columns: this.state.columns, selected: this.state.selected, data: this.state.data, relatedTags: this.props.repoDocMetaManager.relatedTags, synchronizingDocLoader: this.synchronizingDocLoader, tagsProvider: () => tagsProvider(), writeDocInfoTags: (repoDocInfo, tags) => this.props.repoDocMetaManager.writeDocInfoTags(repoDocInfo, tags), deleteDocInfo: repoDocInfo => this.props.repoDocMetaManager.deleteDocInfo(repoDocInfo), writeDocInfoTitle: (repoDocInfo, title) => this.props.repoDocMetaManager.writeDocInfoTitle(repoDocInfo, title), writeDocInfo: docInfo => this.props.repoDocMetaManager.writeDocInfo(docInfo), refresh: () => this.refresh(), onDocDeleteRequested: repoDocInfos => this.onDocDeleteRequested(repoDocInfos), onDocDeleted: repoDocInfos => this.onDocDeleted(repoDocInfos), onDocSetTitle: (repoDocInfo, title) => this.onDocSetTitle(repoDocInfo, title), onDocTagged: (repoDocInfo, tags) => this.onDocTagged(repoDocInfo, tags), onMultiDeleted: () => this.onMultiDeleted(), selectRow: (selectedIdx, event1, type) => this.selectRow(selectedIdx, event1, type), onSelected: selected => this.onSelected(selected), onReactTable: reactTable => this.reactTable = reactTable, onDragStart: event => this.onDragStart(event), onDragEnd: () => this.onDragEnd(), filters: this.docRepoFilters.filters, getSelected: () => this.getSelected(), getRow: (viewIndex) => this.getRow(viewIndex), onRemoveFromFolder: (folder, repoDocInfos) => this.onRemoveFromFolder(folder, repoDocInfos) }), right: React.createElement("div", null) }) }))));
    }
    onDragStart(event) {
        const configureDragImage = () => {
            const src = document.createElement("div");
            event.dataTransfer.setDragImage(src, 0, 0);
        };
        configureDragImage();
        const selected = this.getSelected();
        SelectedDocs_1.DraggingSelectedDocs.set(selected);
    }
    onDragEnd() {
        SelectedDocs_1.DraggingSelectedDocs.clear();
    }
    onDocTagged(repoDocInfo, tags) {
        return __awaiter(this, void 0, void 0, function* () {
            RendererAnalytics_1.RendererAnalytics.event({ category: 'user', action: 'doc-tagged' });
            yield this.props.repoDocMetaManager.writeDocInfoTags(repoDocInfo, tags);
            this.refresh();
        });
    }
    onDocDeleteRequested(repoDocInfos) {
        Dialogs_1.Dialogs.confirm({
            title: "Are you sure you want to delete these document(s)?",
            subtitle: "This is a permanent operation and can't be undone.  All associated annotations will also be removed.",
            onCancel: Functions_1.NULL_FUNCTION,
            type: 'danger',
            onConfirm: () => this.onDocDeleted(repoDocInfos),
        });
    }
    onDocSidebarVisible(docSidebarVisible) {
        this.setState(Object.assign(Object.assign({}, this.state), { docSidebarVisible }));
    }
    onDocDeleted(repoDocInfos) {
        const doDeletes = () => __awaiter(this, void 0, void 0, function* () {
            const stats = {
                successes: 0,
                failures: 0
            };
            this.clearSelected();
            const progressTracker = new ProgressTracker_1.ProgressTracker({ total: repoDocInfos.length, id: 'delete' });
            for (const repoDocInfo of repoDocInfos) {
                log.info("Deleting document: ", repoDocInfo);
                try {
                    yield this.props.repoDocMetaManager.deleteDocInfo(repoDocInfo);
                    ++stats.successes;
                    this.refresh();
                }
                catch (e) {
                    ++stats.failures;
                    log.error("Could not delete doc: ", e);
                }
                finally {
                    const progress = progressTracker.incr();
                    ProgressMessages_1.ProgressMessages.broadcast(progress);
                }
            }
            this.clearSelected();
            if (stats.failures === 0) {
                Toaster_1.Toaster.success(`${stats.successes} documents successfully deleted.`);
            }
            else {
                Toaster_1.Toaster.error(`Failed to delete ${stats.failures} with ${stats.successes} successful.`);
            }
        });
        doDeletes()
            .catch(err => log.error("Unable to delete files: ", err));
    }
    onDocSetTitle(repoDocInfo, title) {
        RendererAnalytics_1.RendererAnalytics.event({ category: 'user', action: 'set-doc-title' });
        log.info("Setting doc title: ", title);
        this.props.repoDocMetaManager.writeDocInfoTitle(repoDocInfo, title)
            .catch(err => log.error("Could not write doc title: ", err));
        this.refresh();
    }
    onSelectedColumns(columns) {
        RendererAnalytics_1.RendererAnalytics.event({ category: 'user', action: 'selected-columns' });
        SettingsStore_1.SettingsStore.load()
            .then((settingsProvider) => {
            const currentSettings = settingsProvider();
            const settings = Object.assign(Object.assign({}, currentSettings), { documentRepository: {
                    columns: this.state.columns
                } });
            SettingsStore_1.SettingsStore.write(settings)
                .catch(err => log.error(err));
        })
            .catch(err => log.error("Could not load settings: ", err));
        this.refresh();
    }
    onFilterByTitle(title) {
        RendererAnalytics_1.RendererAnalytics.event({ category: 'user', action: 'filter-by-title' });
        this.docRepoFilters.onFilterByTitle(title);
    }
    refresh() {
        this.docRepoFilters.refresh();
    }
    doRefresh(data) {
        const tags = this.props.repoDocMetaManager.repoDocInfoIndex.toTagDescriptors();
        const state = Object.assign(Object.assign({}, this.state), { data, tags });
        setTimeout(() => {
            this.setState(state);
        }, 1);
    }
    onToggleFlaggedOnly(value) {
        this.docRepoFilters.onToggleFlaggedOnly(value);
    }
    onToggleFilterArchived(value) {
        this.docRepoFilters.onToggleFilterArchived(value);
    }
}
exports.default = DocRepoScreen;
DocRepoScreen.hasSentInitAnalytics = false;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9jUmVwb1NjcmVlbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkRvY1JlcG9TY3JlZW4udHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZDQUErQjtBQUMvQiwyREFBc0Q7QUFJdEQsZ0VBQTJEO0FBQzNELHFEQUE2RDtBQUM3RCxrRUFBeUQ7QUFDekQsK0VBQTBFO0FBQzFFLG9EQUErQztBQUMvQyxpRUFBNEQ7QUFDNUQsK0RBQTBEO0FBQzFELDhFQUF5RTtBQUl6RSw4REFBeUQ7QUFDekQsb0dBQStGO0FBQy9GLDJFQUFzRTtBQUN0RSxtR0FBMkU7QUFDM0UsMERBQXFEO0FBQ3JELDBDQUFxQztBQUVyQywrREFBOEQ7QUFDOUQseURBQW9EO0FBQ3BELHFEQUFtRTtBQUVuRSxtRUFBOEQ7QUFDOUQsMkVBQXNFO0FBQ3RFLDBGQUFxRjtBQUNyRixtRUFBOEQ7QUFDOUQseURBQW9EO0FBQ3BELGlEQUE0QztBQUM1QywwREFBcUQ7QUFFckQsZ0VBQTJEO0FBRTNELHlEQUFvRDtBQUNwRCwyREFBc0Q7QUFDdEQsaURBQW9EO0FBQ3BELG9FQUErRDtBQUUvRCwrREFBMEQ7QUFFMUQsTUFBTSxHQUFHLEdBQUcsZUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBSTVCLE1BQXFCLGFBQWMsU0FBUSxpQ0FBdUM7SUFjOUUsWUFBWSxLQUFhLEVBQUUsT0FBWTtRQUNuQyxLQUFLLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRXRCLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDO1FBQ2xFLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLCtDQUFzQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUU3RixJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMs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LENBQUM7SUFDbEMsQ0FBQztJQUtPLFNBQVMsQ0FBQyxJQUFnQztRQUU5QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFFL0UsTUFBTSxLQUFLLG1DQUFPLElBQUksQ0FBQyxLQUFLLEtBQUUsSUFBSSxFQUFFLElBQUksR0FBQyxDQUFDO1FBRTFDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFJWixJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXpCLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUVWLENBQUM7SUFFTyxtQkFBbUIsQ0FBQyxLQUFjO1FBQ3RDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVPLHNCQUFzQixDQUFDLEtBQWM7UUFDekMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0RCxDQUFDOztBQW5xQkwsZ0NBcXFCQztBQWpxQmtCLGtDQUFvQixHQUFHLEtBQUssQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7TG9nZ2VyfSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL2xvZ2dlci9Mb2dnZXInO1xuaW1wb3J0IHtSZXBvRG9jTWV0YUxvYWRlcn0gZnJvbSAnLi4vUmVwb0RvY01ldGFMb2FkZXInO1xuaW1wb3J0IHtSZXBvRG9jSW5mb30gZnJvbSAnLi4vUmVwb0RvY0luZm8nO1xuaW1wb3J0IHtSZXBvRG9jTWV0YU1hbmFnZXJ9IGZyb20gJy4uL1JlcG9Eb2NNZXRhTWFuYWdlcic7XG5pbXBvcnQge09wdGlvbmFsfSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL3V0aWwvdHMvT3B0aW9uYWwnO1xuaW1wb3J0IHtUYWcsIFRhZ3MsIFRhZ1N0cn0gZnJvbSAncG9sYXItc2hhcmVkL3NyYy90YWdzL1RhZ3MnO1xuaW1wb3J0IHtpc1ByZXNlbnR9IGZyb20gJ3BvbGFyLXNoYXJlZC9zcmMvUHJlY29uZGl0aW9ucyc7XG5pbXBvcnQge1JlbmRlcmVyQW5hbHl0aWNzfSBmcm9tICcuLi8uLi8uLi8uLi93ZWIvanMvZ2EvUmVuZGVyZXJBbmFseXRpY3MnO1xuaW1wb3J0IHtNZXNzYWdlQmFubmVyfSBmcm9tICcuLi9NZXNzYWdlQmFubmVyJztcbmltcG9ydCB7RG9jUmVwb1RhYmxlRHJvcGRvd259IGZyb20gJy4vRG9jUmVwb1RhYmxlRHJvcGRvd24nO1xuaW1wb3J0IHtEb2NSZXBvVGFibGVDb2x1bW5zfSBmcm9tICcuL0RvY1JlcG9UYWJsZUNvbHVtbnMnO1xuaW1wb3J0IHtTZXR0aW5nc1N0b3JlfSBmcm9tICcuLi8uLi8uLi8uLi93ZWIvanMvZGF0YXN0b3JlL1NldHRpbmdzU3RvcmUnO1xuaW1wb3J0IHtJRG9jSW5mb30gZnJvbSAncG9sYXItc2hhcmVkL3NyYy9tZXRhZGF0YS9JRG9jSW5mbyc7XG5pbXBvcnQge0lFdmVudERpc3BhdGNoZXJ9IGZyb20gJy4uLy4uLy4uLy4uL3dlYi9qcy9yZWFjdG9yL1NpbXBsZVJlYWN0b3InO1xuaW1wb3J0IHtQZXJzaXN0ZW5jZUxheWVyTWFuYWdlcn0gZnJvbSAnLi4vLi4vLi4vLi4vd2ViL2pzL2RhdGFzdG9yZS9QZXJzaXN0ZW5jZUxheWVyTWFuYWdlcic7XG5pbXBvcnQge1JlcG9Eb2NNZXRhTG9hZGVyc30gZnJvbSAnLi4vUmVwb0RvY01ldGFMb2FkZXJzJztcbmltcG9ydCB7UGVyc2lzdGVuY2VMYXllck1hbmFnZXJzfSBmcm9tICcuLi8uLi8uLi8uLi93ZWIvanMvZGF0YXN0b3JlL1BlcnNpc3RlbmNlTGF5ZXJNYW5hZ2Vycyc7XG5pbXBvcnQge1N5bmNocm9uaXppbmdEb2NMb2FkZXJ9IGZyb20gJy4uL3V0aWwvU3luY2hyb25pemluZ0RvY0xvYWRlcic7XG5pbXBvcnQgUmVsZWFzaW5nUmVhY3RDb21wb25lbnQgZnJvbSAnLi4vZnJhbWV3b3JrL1JlbGVhc2luZ1JlYWN0Q29tcG9uZW50JztcbmltcG9ydCB7UmVwb0hlYWRlcn0gZnJvbSAnLi4vcmVwb19oZWFkZXIvUmVwb0hlYWRlcic7XG5pbXBvcnQge0ZpeGVkTmF2fSBmcm9tICcuLi9GaXhlZE5hdic7XG5pbXBvcnQge0xpc3RPcHRpb25UeXBlfSBmcm9tICcuLi8uLi8uLi8uLi93ZWIvanMvdWkvbGlzdF9zZWxlY3Rvci9MaXN0U2VsZWN0b3InO1xuaW1wb3J0IHtOVUxMX0ZVTkNUSU9OfSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL3V0aWwvRnVuY3Rpb25zJztcbmltcG9ydCB7RG9jUmVwb0ZpbHRlckJhcn0gZnJvbSAnLi9Eb2NSZXBvRmlsdGVyQmFyJztcbmltcG9ydCB7RG9jUmVwb0ZpbHRlcnMsIFJlZnJlc2hlZENhbGxiYWNrfSBmcm9tICcuL0RvY1JlcG9GaWx0ZXJzJztcbmltcG9ydCB7U2V0dGluZ3N9IGZyb20gJy4uLy4uLy4uLy4uL3dlYi9qcy9kYXRhc3RvcmUvU2V0dGluZ3MnO1xuaW1wb3J0IHtUb2FzdGVyfSBmcm9tICcuLi8uLi8uLi8uLi93ZWIvanMvdWkvdG9hc3Rlci9Ub2FzdGVyJztcbmltcG9ydCB7UHJvZ3Jlc3NUcmFja2VyfSBmcm9tICdwb2xhci1zaGFyZWQvc3JjL3V0aWwvUHJvZ3Jlc3NUcmFja2VyJztcbmltcG9ydCB7UHJvZ3Jlc3NNZXNzYWdlc30gZnJvbSAnLi4vLi4vLi4vLi4vd2ViL2pzL3VpL3Byb2dyZXNzX2Jhci9Qcm9ncmVzc01lc3NhZ2VzJztcbmltcG9ydCB7RGlhbG9nc30gZnJvbSAnLi4vLi4vLi4vLi4vd2ViL2pzL3VpL2RpYWxvZ3MvRGlhbG9ncyc7XG5pbXBvcnQge0RvY1JlcG9CdXR0b25CYXJ9IGZyb20gJy4vRG9jUmVwb0J1dHRvbkJhcic7XG5pbXBvcnQge0RvY1JlcG9UYWJsZX0gZnJvbSAnLi9Eb2NSZXBvVGFibGUnO1xuaW1wb3J0IHtEb2NrfSBmcm9tICcuLi8uLi8uLi8uLi93ZWIvanMvdWkvZG9jay9Eb2NrJztcbmltcG9ydCB7VGFnRGVzY3JpcHRvcn0gZnJvbSAnLi4vLi4vLi4vLi4vd2ViL2pzL3RhZ3MvVGFnTm9kZSc7XG5pbXBvcnQge1RhZ1RyZWV9IGZyb20gJy4uLy4uLy4uLy4uL3dlYi9qcy91aS90cmVlL1RhZ1RyZWUnO1xuaW1wb3J0IHtJbnN0YW5jZX0gZnJvbSBcInJlYWN0LXRhYmxlXCI7XG5pbXBvcnQge0FycmF5c30gZnJvbSBcInBvbGFyLXNoYXJlZC9zcmMvdXRpbC9BcnJheXNcIjtcbmltcG9ydCB7TnVtYmVyc30gZnJvbSBcInBvbGFyLXNoYXJlZC9zcmMvdXRpbC9OdW1iZXJzXCI7XG5pbXBvcnQge0RyYWdnaW5nU2VsZWN0ZWREb2NzfSBmcm9tIFwiLi9TZWxlY3RlZERvY3NcIjtcbmltcG9ydCB7VHJlZVN0YXRlfSBmcm9tIFwiLi4vLi4vLi4vLi4vd2ViL2pzL3VpL3RyZWUvVHJlZVN0YXRlXCI7XG5pbXBvcnQge0RvY1NpZGViYXJ9IGZyb20gXCIuLi8uLi8uLi8uLi93ZWIvc3BlY3Ryb24wL3VpLWNvbXBvbmVudHMvRG9jU2lkZWJhclwiO1xuaW1wb3J0IHtTZXRBcnJheXN9IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL3V0aWwvU2V0QXJyYXlzXCI7XG5cbmNvbnN0IGxvZyA9IExvZ2dlci5jcmVhdGUoKTtcblxuLy8gVE9ETzogZ28gYmFjayB0byBFeHRlbmRlZFJlYWN0VGFibGVcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRG9jUmVwb1NjcmVlbiBleHRlbmRzIFJlbGVhc2luZ1JlYWN0Q29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG5cbiAgICBwcml2YXRlIHJlYWRvbmx5IHRyZWVTdGF0ZTogVHJlZVN0YXRlPFRhZ0Rlc2NyaXB0b3I+O1xuXG4gICAgcHJpdmF0ZSBzdGF0aWMgaGFzU2VudEluaXRBbmFseXRpY3MgPSBmYWxzZTtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgcGVyc2lzdGVuY2VMYXllck1hbmFnZXI6IFBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyO1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBzeW5jaHJvbml6aW5nRG9jTG9hZGVyOiBTeW5jaHJvbml6aW5nRG9jTG9hZGVyO1xuXG4gICAgcHJpdmF0ZSByZWFjdFRhYmxlPzogSW5zdGFuY2U7XG5cbiAgICBwcml2YXRlIHJlYWRvbmx5IGRvY1JlcG9GaWx0ZXJzOiBEb2NSZXBvRmlsdGVycztcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMsIGNvbnRleHQ6IGFueSkge1xuICAgICAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG5cbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlciA9IHRoaXMucHJvcHMucGVyc2lzdGVuY2VMYXllck1hbmFnZXI7XG4gICAgICAgIHRoaXMuc3luY2hyb25pemluZ0RvY0xvYWRlciA9IG5ldyBTeW5jaHJvbml6aW5nRG9jTG9hZGVyKHRoaXMucHJvcHMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIpO1xuXG4gICAgICAgIHRoaXMub25Eb2NEZWxldGVSZXF1ZXN0ZWQgPSB0aGlzLm9uRG9jRGVsZXRlUmVxdWVzdGVkLmJpbmQodGhpcyk7XG5cbiAgICAgICAgdGhpcy5vbkRvY1RhZ2dlZCA9IHRoaXMub25Eb2NUYWdnZWQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5vbkRvY0RlbGV0ZWQgPSB0aGlzLm9uRG9jRGVsZXRlZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm9uRG9jU2V0VGl0bGUgPSB0aGlzLm9uRG9jU2V0VGl0bGUuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5vblNlbGVjdGVkQ29sdW1ucyA9IHRoaXMub25TZWxlY3RlZENvbHVtbnMuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5vbkRvY1NpZGViYXJWaXNpYmxlID0gdGhpcy5vbkRvY1NpZGViYXJWaXNpYmxlLmJpbmQodGhpcyk7XG5cblxuICAgICAgICB0aGlzLm9uRmlsdGVyQnlUaXRsZSA9IHRoaXMub25GaWx0ZXJCeVRpdGxlLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMub25Ub2dnbGVGaWx0ZXJBcmNoaXZlZCA9IHRoaXMub25Ub2dnbGVGaWx0ZXJBcmNoaXZlZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm9uVG9nZ2xlRmxhZ2dlZE9ubHkgPSB0aGlzLm9uVG9nZ2xlRmxhZ2dlZE9ubHkuYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0ZWQgPSB0aGlzLmNsZWFyU2VsZWN0ZWQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5vblNlbGVjdGVkID0gdGhpcy5vblNlbGVjdGVkLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuc2VsZWN0Um93ID0gdGhpcy5zZWxlY3RSb3cuYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLm9uTXVsdGlUYWdnZWQgPSB0aGlzLm9uTXVsdGlUYWdnZWQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5vbk11bHRpRGVsZXRlZCA9IHRoaXMub25NdWx0aURlbGV0ZWQuYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLmdldFNlbGVjdGVkID0gdGhpcy5nZXRTZWxlY3RlZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLmdldFJvdyA9IHRoaXMuZ2V0Um93LmJpbmQodGhpcyk7XG5cbiAgICAgICAgdGhpcy5vbkRyYWdTdGFydCA9IHRoaXMub25EcmFnU3RhcnQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5vbkRyYWdFbmQgPSB0aGlzLm9uRHJhZ0VuZC5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHRoaXMub25SZW1vdmVGcm9tRm9sZGVyID0gdGhpcy5vblJlbW92ZUZyb21Gb2xkZXIuYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICB0YWdzOiBbXSxcbiAgICAgICAgICAgIGNvbHVtbnM6IG5ldyBEb2NSZXBvVGFibGVDb2x1bW5zKCksXG4gICAgICAgICAgICBzZWxlY3RlZDogW10sXG4gICAgICAgICAgICBkb2NTaWRlYmFyVmlzaWJsZTogZmFsc2VcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBvblJlZnJlc2hlZDogUmVmcmVzaGVkQ2FsbGJhY2sgPSByZXBvRG9jSW5mb3MgPT4gdGhpcy5kb1JlZnJlc2gocmVwb0RvY0luZm9zKTtcblxuICAgICAgICBjb25zdCByZXBvRG9jSW5mb3NQcm92aWRlciA9ICgpID0+IHRoaXMucHJvcHMucmVwb0RvY01ldGFNYW5hZ2VyIS5yZXBvRG9jSW5mb0luZGV4LnZhbHVlcygpO1xuXG4gICAgICAgIHRoaXMuZG9jUmVwb0ZpbHRlcnMgPVxuICAgICAgICAgICAgbmV3IERvY1JlcG9GaWx0ZXJzKG9uUmVmcmVzaGVkLCByZXBvRG9jSW5mb3NQcm92aWRlcik7XG5cbiAgICAgICAgY29uc3Qgb25TZWxlY3RlZCA9ICh0YWdzOiBSZWFkb25seUFycmF5PFRhZ1N0cj4pID0+IHRoaXMuZG9jUmVwb0ZpbHRlcnMub25UYWdnZWQodGFncy5tYXAoY3VycmVudCA9PiBUYWdzLmNyZWF0ZShjdXJyZW50KSkpO1xuXG4gICAgICAgIGNvbnN0IG9uRHJvcHBlZCA9ICh0YWc6IFRhZ0Rlc2NyaXB0b3IpID0+IHRoaXMub25NdWx0aVRhZ2dlZChbdGFnXSwgRHJhZ2dpbmdTZWxlY3RlZERvY3MuZ2V0KCkpO1xuXG4gICAgICAgIHRoaXMudHJlZVN0YXRlID0gbmV3IFRyZWVTdGF0ZShvblNlbGVjdGVkLCBvbkRyb3BwZWQpO1xuXG4gICAgICAgIHRoaXMuaW5pdCgpO1xuXG4gICAgICAgIHRoaXMuaW5pdEFzeW5jKClcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gbG9nLmVycm9yKFwiQ291bGQgbm90IGluaXQ6IFwiLCBlcnIpKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdCgpIHtcblxuICAgICAgICAvLyBUT0RPOiB3aGVuIHdlIGdldCBhIE5FVyBwZXJzaXN0ZW5jZSBsYXllciB3ZSBwcm9iYWJseSBuZWVkIHRvIHJlbGVhc2VcbiAgICAgICAgLy8gdGhlIG9sZCBldmVudCBsaXN0ZW5lciBhcyB0aGUgY29tcG9uZW50IGlzIHN0aWxsIG1vdW50ZWQgYnV0IHRoZSBvbGRcbiAgICAgICAgLy8gcGVyc2lzdGVuY2UgbGF5ZXIgaGFzIG5vdyBnb25lIGF3YXkuXG5cbiAgICAgICAgUGVyc2lzdGVuY2VMYXllck1hbmFnZXJzLm9uUGVyc2lzdGVuY2VNYW5hZ2VyKHRoaXMucHJvcHMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIsIChwZXJzaXN0ZW5jZUxheWVyKSA9PiB7XG5cbiAgICAgICAgICAgIHRoaXMucmVsZWFzZXIucmVnaXN0ZXIoXG4gICAgICAgICAgICAgICAgcGVyc2lzdGVuY2VMYXllci5hZGRFdmVudExpc3RlbmVyKCgpID0+IHRoaXMucmVmcmVzaCgpKSk7XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5yZWxlYXNlci5yZWdpc3RlcihcbiAgICAgICAgICAgIFJlcG9Eb2NNZXRhTG9hZGVycy5hZGRUaHJvdHRsaW5nRXZlbnRMaXN0ZW5lcih0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTG9hZGVyLCAoKSA9PiB0aGlzLnJlZnJlc2goKSkpO1xuXG4gICAgICAgIHRoaXMucmVsZWFzZXIucmVnaXN0ZXIoXG4gICAgICAgICAgICB0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQgPT4ge1xuXG4gICAgICAgICAgICAgICAgaWYgKCFEb2NSZXBvU2NyZWVuLmhhc1NlbnRJbml0QW5hbHl0aWNzICYmIGV2ZW50LnByb2dyZXNzLnByb2dyZXNzID09PSAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0SW5pdEFuYWx5dGljcyh0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTWFuYWdlci5yZXBvRG9jSW5mb0luZGV4LnNpemUoKSk7XG4gICAgICAgICAgICAgICAgICAgIERvY1JlcG9TY3JlZW4uaGFzU2VudEluaXRBbmFseXRpY3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgaW5pdEFzeW5jKCk6IFByb21pc2U8dm9pZD4ge1xuXG4gICAgICAgIGNvbnN0IHNldHRpbmdQcm92aWRlciA9IGF3YWl0IFNldHRpbmdzU3RvcmUubG9hZCgpO1xuXG4gICAgICAgIGxvZy5pbmZvKFwiU2V0dGluZ3MgbG9hZGVkOiBcIiwgc2V0dGluZ1Byb3ZpZGVyKTtcblxuICAgICAgICBPcHRpb25hbC5vZihzZXR0aW5nUHJvdmlkZXIoKS5kb2N1bWVudFJlcG9zaXRvcnkpXG4gICAgICAgICAgICAubWFwKGN1cnJlbnQgPT4gY3VycmVudC5jb2x1bW5zKVxuICAgICAgICAgICAgLndoZW4oY29sdW1ucyA9PiB7XG5cbiAgICAgICAgICAgICAgICAvLyBjb2x1bW5zID0gT2JqZWN0LmFzc2lnbiggbmV3IERvY1JlcG9UYWJsZUNvbHVtbnMoKSwgY29sdW1ucyk7XG5cbiAgICAgICAgICAgICAgICBsb2cuaW5mbyhcIkxvYWRlZCBjb2x1bW5zIGZyb20gc2V0dGluZ3M6IFwiLCBjb2x1bW5zKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsuLi50aGlzLnN0YXRlLCBjb2x1bW5zfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBlbWl0SW5pdEFuYWx5dGljcyhuckRvY3M6IG51bWJlcikge1xuXG4gICAgICAgIC8vIFRPRE86IG1vdmUgc29tZSBvZiB0aGVzZSBhbmFseXRpY3MgaW50byB0aGUgbWFpbiBSZXBvYWl0b3J5QXBwLnRzeC5cblxuICAgICAgICBSZW5kZXJlckFuYWx5dGljcy5zZXQoeyduckRvY3MnOiBuckRvY3N9KTtcblxuICAgICAgICBjb25zdCBwZXJzaXN0ZW5jZUxheWVyVHlwZSA9IHRoaXMucGVyc2lzdGVuY2VMYXllck1hbmFnZXIuY3VycmVudFR5cGUoKTtcblxuICAgICAgICBSZW5kZXJlckFuYWx5dGljcy5ldmVudCh7Y2F0ZWdvcnk6ICdkb2N1bWVudC1yZXBvc2l0b3J5JywgYWN0aW9uOiBgZG9jcy1sb2FkZWQtJHtwZXJzaXN0ZW5jZUxheWVyVHlwZX0tJHtuckRvY3N9YH0pO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbk11bHRpVGFnZ2VkKHRhZ3M6IFJlYWRvbmx5QXJyYXk8VGFnPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb0RvY0luZm9zOiBSZWFkb25seUFycmF5PFJlcG9Eb2NJbmZvPiA9IHRoaXMuZ2V0U2VsZWN0ZWQoKSkge1xuXG4gICAgICAgIGZvciAoY29uc3QgcmVwb0RvY0luZm8gb2YgcmVwb0RvY0luZm9zKSB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ1RhZ3MgPSBPYmplY3QudmFsdWVzKHJlcG9Eb2NJbmZvLnRhZ3MgfHwge30pO1xuICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlVGFncyA9IFRhZ3MudW5pb24oZXhpc3RpbmdUYWdzLCB0YWdzIHx8IFtdKTtcblxuICAgICAgICAgICAgdGhpcy5vbkRvY1RhZ2dlZChyZXBvRG9jSW5mbywgZWZmZWN0aXZlVGFncylcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IGxvZy5lcnJvcihlcnIpKTtcblxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uUmVtb3ZlRnJvbUZvbGRlcihmb2xkZXI6IFRhZywgcmVwb0RvY0luZm9zOiBSZWFkb25seUFycmF5PFJlcG9Eb2NJbmZvPikge1xuXG4gICAgICAgIGZvciAoY29uc3QgcmVwb0RvY0luZm8gb2YgcmVwb0RvY0luZm9zKSB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ1RhZ3MgPSBPYmplY3QudmFsdWVzKHJlcG9Eb2NJbmZvLnRhZ3MgfHwge30pO1xuICAgICAgICAgICAgY29uc3QgbmV3VGFncyA9IFRhZ3MuZGlmZmVyZW5jZShleGlzdGluZ1RhZ3MsIFtmb2xkZXJdKTtcblxuICAgICAgICAgICAgdGhpcy5vbkRvY1RhZ2dlZChyZXBvRG9jSW5mbywgbmV3VGFncylcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IGxvZy5lcnJvcihlcnIpKTtcblxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uTXVsdGlEZWxldGVkKCkge1xuICAgICAgICBjb25zdCByZXBvRG9jSW5mb3MgPSB0aGlzLmdldFNlbGVjdGVkKCk7XG4gICAgICAgIHRoaXMub25Eb2NEZWxldGVSZXF1ZXN0ZWQocmVwb0RvY0luZm9zKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNsZWFyU2VsZWN0ZWQoKSB7XG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsuLi50aGlzLnN0YXRlLCBzZWxlY3RlZDogW119KTtcbiAgICAgICAgfSwgMSk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFNlbGVjdGVkKCk6IFJlYWRvbmx5QXJyYXk8UmVwb0RvY0luZm8+IHtcblxuICAgICAgICBpZiAoISB0aGlzLnJlYWN0VGFibGUpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJlc29sdmVkU3RhdGU6IElSZXNvbHZlZFN0YXRlID0gdGhpcy5yZWFjdFRhYmxlIS5nZXRSZXNvbHZlZFN0YXRlKCk7XG5cbiAgICAgICAgY29uc3Qge3NvcnRlZERhdGF9ID0gcmVzb2x2ZWRTdGF0ZTtcblxuICAgICAgICBjb25zdCBvZmZzZXQgPSAocmVzb2x2ZWRTdGF0ZS5wYWdlKSAqIHJlc29sdmVkU3RhdGUucGFnZVNpemU7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0OiBSZXBvRG9jSW5mb1tdID1cbiAgICAgICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICAubWFwKHNlbGVjdGVkSWR4ID0+IHNvcnRlZERhdGFbb2Zmc2V0ICsgc2VsZWN0ZWRJZHhdKVxuICAgICAgICAgICAgICAgIC5maWx0ZXIoaXRlbSA9PiBpc1ByZXNlbnQoaXRlbSkpXG4gICAgICAgICAgICAgICAgLm1hcChpdGVtID0+IGl0ZW0uX29yaWdpbmFsKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRSb3codmlld0luZGV4OiBudW1iZXIpOiBSZXBvRG9jSW5mbyB7XG4gICAgICAgIGNvbnN0IHJlc29sdmVkU3RhdGU6IElSZXNvbHZlZFN0YXRlID0gdGhpcy5yZWFjdFRhYmxlIS5nZXRSZXNvbHZlZFN0YXRlKCk7XG4gICAgICAgIGNvbnN0IHtzb3J0ZWREYXRhfSA9IHJlc29sdmVkU3RhdGU7XG4gICAgICAgIGNvbnN0IG9mZnNldCA9IChyZXNvbHZlZFN0YXRlLnBhZ2UpICogcmVzb2x2ZWRTdGF0ZS5wYWdlU2l6ZTtcbiAgICAgICAgY29uc3QgaWR4ID0gb2Zmc2V0ICsgdmlld0luZGV4O1xuICAgICAgICByZXR1cm4gc29ydGVkRGF0YVtpZHhdLl9vcmlnaW5hbDtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2VsZWN0Um93KHNlbGVjdGVkSWR4OiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICBldmVudDogTW91c2VFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFNlbGVjdFJvd1R5cGUpIHtcblxuICAgICAgICBzZWxlY3RlZElkeCA9IE51bWJlcnMudG9OdW1iZXIoc2VsZWN0ZWRJZHgpO1xuXG4gICAgICAgIC8vIHRoZXJlIGFyZSByZWFsbHkgb25seSB0aHJlZSBzdHJhdGVnaWVzXG4gICAgICAgIC8vXG4gICAgICAgIC8vIC0gb25lOiBzZWxlY3QgT05FIGl0ZW0gYW5kIHVuc2VsZWN0IHRoZSBwcmV2aW91cyBpdGVtKHMpLiAgVGhpcyBpcyBkb25lIHdoZW4gd2UgaGF2ZVxuICAgICAgICAvLyAgICAgICAgYSBzaW5nbGUgY2xpY2sgb24gYW4gaXRlbS4gIEl0IGFsd2F5cyBzZWxlY3RzIGl0IGFuZCBuZXZlciBkZS1zZWxlY3RzIGl0LlxuICAgICAgICAvL1xuICAgICAgICAvLyAtIGFkZCB0aGUgbmV3IHNlbGVjdGVkSW5kZXggdG8gdGhlIGxpc3Qgb2YgY3VycmVudGx5IHNlbGVjdGVkIGl0ZW1zLlxuICAgICAgICAvL1xuICAgICAgICAvLyAgIC0gRklYTUU6IHJlYWxseSB3aGF0IHRoaXMgaXMgaXMganVzdCBzZWxlY3Qtb25lIGJ1dCB3ZSBsZWF2ZSB0aGVcbiAgICAgICAgLy8gICAgIHByZXZpb3VzIGl0ZW1zIGluIHBsYWNlIGFuZCBwZXJmb3JtIG5vIG11dGF0aW9uIG9uIHRoZW0uLi5cblxuICAgICAgICAvLyAtIHRvZ2dsZTogdXNlZCB3aGVuIHRoZSB0eXBlIGlzICdjaGVja2JveCcgYmVjYXVzZSB3ZSdyZSBvbmx5IHRvZ2dsaW5nXG4gICAgICAgIC8vICAgdGhlIHNlbGVjdGlvbiBvZiB0aGF0IG9uZSBpdGVtXG4gICAgICAgIC8vXG4gICAgICAgIC8vIC0gbm9uZTogZG8gbm90aGluZy4gIHRoaXMgaXMgdXNlZCB3aGVuIHRoZSBjb250ZXh0IG1lbnUgaXMgYmVpbmcgdXNlZCBhbmQgbm8gYWRkaXRpb25hbFxuICAgICAgICAvLyAgICAgICAgIGl0ZW1zIGFyZSBiZWluZyBjaGFuZ2VkLlxuXG4gICAgICAgIHR5cGUgU2VsZWN0aW9uU3RyYXRlZ3kgPSAnb25lJyB8ICdyYW5nZScgfCAndG9nZ2xlJyB8ICdub25lJztcblxuICAgICAgICB0eXBlIFNlbGVjdGVkUm93cyA9IFJlYWRvbmx5QXJyYXk8bnVtYmVyPjtcblxuICAgICAgICBjb25zdCBjb21wdXRlU3RyYXRlZ3kgPSAoKTogU2VsZWN0aW9uU3RyYXRlZ3kgPT4ge1xuXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiAndG9nZ2xlJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdjbGljaycpIHtcblxuICAgICAgICAgICAgICAgIGlmIChldmVudC5nZXRNb2RpZmllclN0YXRlKFwiU2hpZnRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdyYW5nZSc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldE1vZGlmaWVyU3RhdGUoXCJDb250cm9sXCIpIHx8IGV2ZW50LmdldE1vZGlmaWVyU3RhdGUoXCJNZXRhXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndG9nZ2xlJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdjb250ZXh0Jykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuc2VsZWN0ZWQuaW5jbHVkZXMoc2VsZWN0ZWRJZHgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbm9uZSc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAnb25lJztcblxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGRvU3RyYXRlZ3lSYW5nZSA9ICgpOiBTZWxlY3RlZFJvd3MgPT4ge1xuXG4gICAgICAgICAgICAvLyBzZWxlY3QgYSByYW5nZVxuXG4gICAgICAgICAgICBsZXQgbWluOiBudW1iZXIgPSAwO1xuICAgICAgICAgICAgbGV0IG1heDogbnVtYmVyID0gMDtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuc2VsZWN0ZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRlZCA9IFsuLi50aGlzLnN0YXRlLnNlbGVjdGVkXS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG4gICAgICAgICAgICAgICAgbWluID0gQXJyYXlzLmZpcnN0KHNvcnRlZCkhO1xuICAgICAgICAgICAgICAgIG1heCA9IEFycmF5cy5sYXN0KHNvcnRlZCkhO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IFsuLi5OdW1iZXJzLnJhbmdlKE1hdGgubWluKG1pbiwgc2VsZWN0ZWRJZHgpLFxuICAgICAgICAgICAgICAgICAgICBNYXRoLm1heChtYXgsIHNlbGVjdGVkSWR4KSldO1xuXG4gICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWQ7XG5cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBkb1N0cmF0ZWd5VG9nZ2xlID0gKCk6IFNlbGVjdGVkUm93cyA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IFsuLi50aGlzLnN0YXRlLnNlbGVjdGVkXTtcblxuICAgICAgICAgICAgaWYgKHNlbGVjdGVkLmluY2x1ZGVzKHNlbGVjdGVkSWR4KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBTZXRBcnJheXMuZGlmZmVyZW5jZShzZWxlY3RlZCwgW3NlbGVjdGVkSWR4XSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBTZXRBcnJheXMudW5pb24oc2VsZWN0ZWQsIFtzZWxlY3RlZElkeF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZG9TdHJhdGVneU9uZSA9ICgpOiBTZWxlY3RlZFJvd3MgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIFtzZWxlY3RlZElkeF07XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZG9TdHJhdGVneSA9ICgpOiBTZWxlY3RlZFJvd3MgfCB1bmRlZmluZWQgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCBzdHJhdGVneSA9IGNvbXB1dGVTdHJhdGVneSgpO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm9uZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9TdHJhdGVneU9uZSgpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJyYW5nZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9TdHJhdGVneVJhbmdlKCk7XG4gICAgICAgICAgICAgICAgY2FzZSBcInRvZ2dsZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9TdHJhdGVneVRvZ2dsZSgpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJub25lXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGRvU3RyYXRlZ3koKTtcblxuICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoey4uLnRoaXMuc3RhdGUsIHNlbGVjdGVkfSk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHB1YmxpYyBvblNlbGVjdGVkKHNlbGVjdGVkOiBSZWFkb25seUFycmF5PG51bWJlcj4pIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IC4uLnRoaXMuc3RhdGUsIHNlbGVjdGVkIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG5cbiAgICAgICAgY29uc3QgdGFnc1Byb3ZpZGVyID0gKCkgPT4gdGhpcy5wcm9wcy5yZXBvRG9jTWV0YU1hbmFnZXIhLnJlcG9Eb2NJbmZvSW5kZXgudG9UYWdEZXNjcmlwdG9ycygpO1xuXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRG9jcyA9IHRoaXMuZ2V0U2VsZWN0ZWQoKTtcbiAgICAgICAgY29uc3QgcHJpbWFyeURvYyA9IHNlbGVjdGVkRG9jcy5sZW5ndGggPiAwID8gc2VsZWN0ZWREb2NzWzBdIDogdW5kZWZpbmVkIDtcblxuICAgICAgICBjb25zdCBkb2NBY3RpdmUgPSB7XG4gICAgICAgICAgICByaWdodDogJ2Qtbm9uZS1tb2JpbGUnLFxuICAgICAgICAgICAgc3BsaXR0ZXI6ICdkLW5vbmUtbW9iaWxlJ1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGRvY0luYWN0aXZlID0ge1xuICAgICAgICAgICAgcmlnaHQ6ICdkLW5vbmUnLFxuICAgICAgICAgICAgc3BsaXR0ZXI6ICdkLW5vbmUnXG4gICAgICAgIH07XG5cblxuICAgICAgICBjb25zdCByaWdodERvY0NvbXBvbmVudENsYXNzTmFtZXMgPSB0aGlzLnN0YXRlLmRvY1NpZGViYXJWaXNpYmxlID8gZG9jQWN0aXZlIDogZG9jSW5hY3RpdmU7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgaWQ9XCJkb2MtcmVwb3NpdG9yeVwiXG4gICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIlwiXG4gICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJ1xuICAgICAgICAgICAgICAgICB9fT5cblxuICAgICAgICAgICAgICAgIDxGaXhlZE5hdiBpZD1cImRvYy1yZXBvLXRhYmxlXCI+XG5cbiAgICAgICAgICAgICAgICAgICAgPGhlYWRlcj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPFJlcG9IZWFkZXIgcGVyc2lzdGVuY2VMYXllck1hbmFnZXI9e3RoaXMucHJvcHMucGVyc2lzdGVuY2VMYXllck1hbmFnZXJ9Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cImhlYWRlci1maWx0ZXJcIj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiAnZmxleCd9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicC0xXCI+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RG9jUmVwb0J1dHRvbkJhciBoYXNTZWxlY3RlZD17dGhpcy5zdGF0ZS5zZWxlY3RlZC5sZW5ndGggPiAwfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc1Byb3ZpZGVyPXt0YWdzUHJvdmlkZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbk11bHRpVGFnZ2VkPXt0YWdzID0+IHRoaXMub25NdWx0aVRhZ2dlZCh0YWdzKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uTXVsdGlEZWxldGVkPXsoKSA9PiB0aGlzLm9uTXVsdGlEZWxldGVkKCl9Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7bWFyZ2luTGVmdDogJ2F1dG8nfX0+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxEb2NSZXBvRmlsdGVyQmFyIG9uVG9nZ2xlRmxhZ2dlZE9ubHk9e3ZhbHVlID0+IHRoaXMub25Ub2dnbGVGbGFnZ2VkT25seSh2YWx1ZSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblRvZ2dsZUZpbHRlckFyY2hpdmVkPXt2YWx1ZSA9PiB0aGlzLm9uVG9nZ2xlRmlsdGVyQXJjaGl2ZWQodmFsdWUpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GaWx0ZXJCeVRpdGxlPXsodGl0bGUpID0+IHRoaXMub25GaWx0ZXJCeVRpdGxlKHRpdGxlKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NEQlByb3ZpZGVyPXsoKSA9PiB0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTWFuYWdlciEudGFnc0RCfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaGVyPXsoKSA9PiB0aGlzLnJlZnJlc2goKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkVGFncz17dGhpcy5kb2NSZXBvRmlsdGVycy5maWx0ZXJzLmZpbHRlcmVkVGFnc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY1NpZGViYXJWaXNpYmxlPXt0aGlzLnN0YXRlLmRvY1NpZGViYXJWaXNpYmxlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Eb2NTaWRlYmFyVmlzaWJsZT17dmlzaWJsZSA9PiB0aGlzLm9uRG9jU2lkZWJhclZpc2libGUodmlzaWJsZSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodD17XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImQtbW9iaWxlLW5vbmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e3doaXRlU3BhY2U6ICdub3dyYXAnLCBtYXJnaW5Ub3A6ICdhdXRvJywgbWFyZ2luQm90dG9tOiAnYXV0byd9fT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxEb2NSZXBvVGFibGVEcm9wZG93biBpZD1cInRhYmxlLWRyb3Bkb3duXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucz17T2JqZWN0LnZhbHVlcyh0aGlzLnN0YXRlLmNvbHVtbnMpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdGVkQ29sdW1ucz17KHNlbGVjdGVkQ29sdW1ucykgPT4gdGhpcy5vblNlbGVjdGVkQ29sdW1ucyhzZWxlY3RlZENvbHVtbnMpfS8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPE1lc3NhZ2VCYW5uZXIvPlxuXG4gICAgICAgICAgICAgICAgICAgIDwvaGVhZGVyPlxuXG4gICAgICAgICAgICAgICAgICAgIDxEb2NrXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRDbGFzc05hbWVzPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogJ2Qtbm9uZS1tb2JpbGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0dGVyOiAnZC1ub25lLW1vYmlsZSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWRlPSdsZWZ0J1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFdpZHRoPXszMDB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0PXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JyAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdhdXRvJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicC0xIGJvcmRlci10b3BcIj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRhZ1RyZWUgdGFncz17dGhpcy5zdGF0ZS50YWdzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZVN0YXRlPXt0aGlzLnRyZWVTdGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RUaXRsZT1cIkZvbGRlcnNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnVHlwZT0nZm9sZGVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9DcmVhdGU9e3RydWV9Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRhZ1RyZWUgdGFncz17dGhpcy5zdGF0ZS50YWdzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZVN0YXRlPXt0aGlzLnRyZWVTdGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RUaXRsZT1cIlRhZ3NcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnVHlwZT0ncmVndWxhcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckRpc2FibGVkPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9DcmVhdGU9e3RydWV9Lz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qPFRhZ0xpc3QgdGFncz17dGhpcy5zdGF0ZS50YWdzfS8+Ki99XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0PXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RG9ja1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRDbGFzc05hbWVzPXtyaWdodERvY0NvbXBvbmVudENsYXNzTmFtZXN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZGU9J3JpZ2h0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsV2lkdGg9ezMwMH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdD17XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxEb2NSZXBvVGFibGUgY29sdW1ucz17dGhpcy5zdGF0ZS5jb2x1bW5zfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZD17dGhpcy5zdGF0ZS5zZWxlY3RlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YT17dGhpcy5zdGF0ZS5kYXRhfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGVkVGFncz17dGhpcy5wcm9wcy5yZXBvRG9jTWV0YU1hbmFnZXIhLnJlbGF0ZWRUYWdzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6aW5nRG9jTG9hZGVyPXt0aGlzLnN5bmNocm9uaXppbmdEb2NMb2FkZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NQcm92aWRlcj17KCkgPT4gdGFnc1Byb3ZpZGVyKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlRG9jSW5mb1RhZ3M9eyhyZXBvRG9jSW5mbywgdGFncykgPT4gdGhpcy5wcm9wcy5yZXBvRG9jTWV0YU1hbmFnZXIhLndyaXRlRG9jSW5mb1RhZ3MocmVwb0RvY0luZm8sIHRhZ3MpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVEb2NJbmZvPXtyZXBvRG9jSW5mbyA9PiB0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTWFuYWdlci5kZWxldGVEb2NJbmZvKHJlcG9Eb2NJbmZvKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVEb2NJbmZvVGl0bGU9eyhyZXBvRG9jSW5mbywgdGl0bGUpID0+IHRoaXMucHJvcHMucmVwb0RvY01ldGFNYW5hZ2VyLndyaXRlRG9jSW5mb1RpdGxlKHJlcG9Eb2NJbmZvLCB0aXRsZSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlRG9jSW5mbz17ZG9jSW5mbyA9PiB0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTWFuYWdlci53cml0ZURvY0luZm8oZG9jSW5mbyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2g9eygpID0+IHRoaXMucmVmcmVzaCgpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkRvY0RlbGV0ZVJlcXVlc3RlZD17cmVwb0RvY0luZm9zID0+IHRoaXMub25Eb2NEZWxldGVSZXF1ZXN0ZWQocmVwb0RvY0luZm9zKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Eb2NEZWxldGVkPXtyZXBvRG9jSW5mb3MgPT4gdGhpcy5vbkRvY0RlbGV0ZWQocmVwb0RvY0luZm9zKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Eb2NTZXRUaXRsZT17KHJlcG9Eb2NJbmZvLCB0aXRsZSkgPT4gdGhpcy5vbkRvY1NldFRpdGxlKHJlcG9Eb2NJbmZvLCB0aXRsZSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRG9jVGFnZ2VkPXsocmVwb0RvY0luZm8sIHRhZ3MpID0+IHRoaXMub25Eb2NUYWdnZWQocmVwb0RvY0luZm8sIHRhZ3MpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbk11bHRpRGVsZXRlZD17KCkgPT4gdGhpcy5vbk11bHRpRGVsZXRlZCgpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RSb3c9eyhzZWxlY3RlZElkeCwgZXZlbnQxLCB0eXBlKSA9PiB0aGlzLnNlbGVjdFJvdyhzZWxlY3RlZElkeCwgZXZlbnQxLCB0eXBlKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TZWxlY3RlZD17c2VsZWN0ZWQgPT4gdGhpcy5vblNlbGVjdGVkKHNlbGVjdGVkKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25SZWFjdFRhYmxlPXtyZWFjdFRhYmxlID0+IHRoaXMucmVhY3RUYWJsZSA9IHJlYWN0VGFibGV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRHJhZ1N0YXJ0PXtldmVudCA9PiB0aGlzLm9uRHJhZ1N0YXJ0KGV2ZW50KX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25EcmFnRW5kPXsoKSA9PiB0aGlzLm9uRHJhZ0VuZCgpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzPXt0aGlzLmRvY1JlcG9GaWx0ZXJzLmZpbHRlcnN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldFNlbGVjdGVkPXsoKSA9PiB0aGlzLmdldFNlbGVjdGVkKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldFJvdz17KHZpZXdJbmRleCkgPT4gdGhpcy5nZXRSb3codmlld0luZGV4KX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25SZW1vdmVGcm9tRm9sZGVyPXsoZm9sZGVyLCByZXBvRG9jSW5mb3MpID0+IHRoaXMub25SZW1vdmVGcm9tRm9sZGVyKGZvbGRlciwgcmVwb0RvY0luZm9zKX0vPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ9e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Lyo8RG9jU2lkZWJhciBtZXRhPXtwcmltYXJ5RG9jID8gcHJpbWFyeURvYy5kb2NJbmZvIDogdW5kZWZpbmVkfSovfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiAgICAgICAgICAgIHBlcnNpc3RlbmNlTGF5ZXJQcm92aWRlcj17KCkgPT4gdGhpcy5wcm9wcy5wZXJzaXN0ZW5jZUxheWVyTWFuYWdlci5nZXQoKX0vPiovfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9Lz5cblxuXG4gICAgICAgICAgICAgICAgPC9GaXhlZE5hdj5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkRyYWdTdGFydChldmVudDogRHJhZ0V2ZW50KSB7XG5cbiAgICAgICAgY29uc3QgY29uZmlndXJlRHJhZ0ltYWdlID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8gVE9ETzogdGhpcyBhY3R1YWxseSBET0VTIE5PVCB3b3JrIGJ1dCBpdCdzIGEgYmV0dGVyIGVmZmVjdCB0aGFuIHRoZVxuICAgICAgICAgICAgLy8gZGVmYXVsdCBhbmQgYSBsb3QgbGVzcyBjb25mdXNpbmcuICBJbiB0aGUgZnV0dXJlIHdlIHNob3VsZCBtaWdyYXRlXG4gICAgICAgICAgICAvLyB0byBzaG93aW5nIHRoZSB0aHVtYm5haWwgb2YgdGhlIGRvYyBvbmNlIHdlIGhhdmUgdGhpcyBmZWF0dXJlXG4gICAgICAgICAgICAvLyBpbXBsZW1lbnRlZC5cblxuICAgICAgICAgICAgY29uc3Qgc3JjOiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICAgICAgICAgIC8vIGh0dHBzOi8va3J5b2dlbml4Lm9yZy9jb2RlL2Jyb3dzZXIvY3VzdG9tLWRyYWctaW1hZ2UuaHRtbFxuICAgICAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5zZXREcmFnSW1hZ2Uoc3JjLCAwLCAwKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25maWd1cmVEcmFnSW1hZ2UoKTtcblxuICAgICAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMuZ2V0U2VsZWN0ZWQoKTtcbiAgICAgICAgRHJhZ2dpbmdTZWxlY3RlZERvY3Muc2V0KHNlbGVjdGVkKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgb25EcmFnRW5kKCkge1xuICAgICAgICBEcmFnZ2luZ1NlbGVjdGVkRG9jcy5jbGVhcigpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgb25Eb2NUYWdnZWQocmVwb0RvY0luZm86IFJlcG9Eb2NJbmZvLCB0YWdzOiBSZWFkb25seUFycmF5PFRhZz4pIHtcblxuICAgICAgICBSZW5kZXJlckFuYWx5dGljcy5ldmVudCh7Y2F0ZWdvcnk6ICd1c2VyJywgYWN0aW9uOiAnZG9jLXRhZ2dlZCd9KTtcblxuICAgICAgICBhd2FpdCB0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTWFuYWdlciEud3JpdGVEb2NJbmZvVGFncyhyZXBvRG9jSW5mbywgdGFncyk7XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkRvY0RlbGV0ZVJlcXVlc3RlZChyZXBvRG9jSW5mb3M6IFJlYWRvbmx5QXJyYXk8UmVwb0RvY0luZm8+KSB7XG5cbiAgICAgICAgRGlhbG9ncy5jb25maXJtKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhlc2UgZG9jdW1lbnQocyk/XCIsXG4gICAgICAgICAgICBzdWJ0aXRsZTogXCJUaGlzIGlzIGEgcGVybWFuZW50IG9wZXJhdGlvbiBhbmQgY2FuJ3QgYmUgdW5kb25lLiAgQWxsIGFzc29jaWF0ZWQgYW5ub3RhdGlvbnMgd2lsbCBhbHNvIGJlIHJlbW92ZWQuXCIsXG4gICAgICAgICAgICBvbkNhbmNlbDogTlVMTF9GVU5DVElPTixcbiAgICAgICAgICAgIHR5cGU6ICdkYW5nZXInLFxuICAgICAgICAgICAgb25Db25maXJtOiAoKSA9PiB0aGlzLm9uRG9jRGVsZXRlZChyZXBvRG9jSW5mb3MpLFxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgb25Eb2NTaWRlYmFyVmlzaWJsZShkb2NTaWRlYmFyVmlzaWJsZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsuLi50aGlzLnN0YXRlLCBkb2NTaWRlYmFyVmlzaWJsZX0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25Eb2NEZWxldGVkKHJlcG9Eb2NJbmZvczogUmVhZG9ubHlBcnJheTxSZXBvRG9jSW5mbz4pIHtcblxuICAgICAgICBjb25zdCBkb0RlbGV0ZXMgPSBhc3luYyAoKSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IHN0YXRzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3NlczogMCxcbiAgICAgICAgICAgICAgICBmYWlsdXJlczogMFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5jbGVhclNlbGVjdGVkKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzVHJhY2tlciA9IG5ldyBQcm9ncmVzc1RyYWNrZXIoe3RvdGFsOiByZXBvRG9jSW5mb3MubGVuZ3RoLCBpZDogJ2RlbGV0ZSd9KTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCByZXBvRG9jSW5mbyBvZiByZXBvRG9jSW5mb3MpIHtcblxuICAgICAgICAgICAgICAgIGxvZy5pbmZvKFwiRGVsZXRpbmcgZG9jdW1lbnQ6IFwiLCByZXBvRG9jSW5mbyk7XG5cbiAgICAgICAgICAgICAgICB0cnkge1xuXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucHJvcHMucmVwb0RvY01ldGFNYW5hZ2VyLmRlbGV0ZURvY0luZm8ocmVwb0RvY0luZm8pO1xuICAgICAgICAgICAgICAgICAgICArK3N0YXRzLnN1Y2Nlc3NlcztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG5cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICsrc3RhdHMuZmFpbHVyZXM7XG4gICAgICAgICAgICAgICAgICAgIGxvZy5lcnJvcihcIkNvdWxkIG5vdCBkZWxldGUgZG9jOiBcIiAsIGUpO1xuICAgICAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gcHJvZ3Jlc3NUcmFja2VyLmluY3IoKTtcbiAgICAgICAgICAgICAgICAgICAgUHJvZ3Jlc3NNZXNzYWdlcy5icm9hZGNhc3QocHJvZ3Jlc3MpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0ZWQoKTtcblxuICAgICAgICAgICAgaWYgKHN0YXRzLmZhaWx1cmVzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgVG9hc3Rlci5zdWNjZXNzKGAke3N0YXRzLnN1Y2Nlc3Nlc30gZG9jdW1lbnRzIHN1Y2Nlc3NmdWxseSBkZWxldGVkLmApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBUb2FzdGVyLmVycm9yKGBGYWlsZWQgdG8gZGVsZXRlICR7c3RhdHMuZmFpbHVyZXN9IHdpdGggJHtzdGF0cy5zdWNjZXNzZXN9IHN1Y2Nlc3NmdWwuYCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICBkb0RlbGV0ZXMoKVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBsb2cuZXJyb3IoXCJVbmFibGUgdG8gZGVsZXRlIGZpbGVzOiBcIiwgZXJyKSk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uRG9jU2V0VGl0bGUocmVwb0RvY0luZm86IFJlcG9Eb2NJbmZvLCB0aXRsZTogc3RyaW5nKSB7XG5cbiAgICAgICAgUmVuZGVyZXJBbmFseXRpY3MuZXZlbnQoe2NhdGVnb3J5OiAndXNlcicsIGFjdGlvbjogJ3NldC1kb2MtdGl0bGUnfSk7XG5cbiAgICAgICAgbG9nLmluZm8oXCJTZXR0aW5nIGRvYyB0aXRsZTogXCIgLCB0aXRsZSk7XG5cbiAgICAgICAgdGhpcy5wcm9wcy5yZXBvRG9jTWV0YU1hbmFnZXIud3JpdGVEb2NJbmZvVGl0bGUocmVwb0RvY0luZm8sIHRpdGxlKVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBsb2cuZXJyb3IoXCJDb3VsZCBub3Qgd3JpdGUgZG9jIHRpdGxlOiBcIiwgZXJyKSk7XG5cbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uU2VsZWN0ZWRDb2x1bW5zKGNvbHVtbnM6IExpc3RPcHRpb25UeXBlW10pIHtcblxuICAgICAgICBSZW5kZXJlckFuYWx5dGljcy5ldmVudCh7Y2F0ZWdvcnk6ICd1c2VyJywgYWN0aW9uOiAnc2VsZWN0ZWQtY29sdW1ucyd9KTtcblxuICAgICAgICAvLyBuZXcgY29sdW1ucyBoYXZlIGJlZW4gc2VsZWN0ZWQuIE5vdGUgdGhhdCB0aGUgVUkgdXBkYXRlcyB0aGUgdmFsdWVzXG4gICAgICAgIC8vIGRpcmVjdGx5IHNvIHdlIGNhbiBqdXN0IHdyaXRlIHdoYXQncyBpbiBtZW1vcnkgdG8gZGlzay4gSSB0aGluayBpdFxuICAgICAgICAvLyB3b3VsZCBiZSBiZXR0ZXIgcHJhY3RpY2UgdG8ga2VlcCB0aGVtIGltbXV0YWJsZS5cblxuICAgICAgICBTZXR0aW5nc1N0b3JlLmxvYWQoKVxuICAgICAgICAgICAgLnRoZW4oKHNldHRpbmdzUHJvdmlkZXIpID0+IHtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTZXR0aW5ncyA9IHNldHRpbmdzUHJvdmlkZXIoKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzOiBTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY3VycmVudFNldHRpbmdzLFxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudFJlcG9zaXRvcnk6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IHRoaXMuc3RhdGUuY29sdW1uc1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIFNldHRpbmdzU3RvcmUud3JpdGUoc2V0dGluZ3MpXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gbG9nLmVycm9yKGVycikpO1xuXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBsb2cuZXJyb3IoXCJDb3VsZCBub3QgbG9hZCBzZXR0aW5nczogXCIsIGVycikpO1xuXG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBvbkZpbHRlckJ5VGl0bGUodGl0bGU6IHN0cmluZykge1xuICAgICAgICBSZW5kZXJlckFuYWx5dGljcy5ldmVudCh7Y2F0ZWdvcnk6ICd1c2VyJywgYWN0aW9uOiAnZmlsdGVyLWJ5LXRpdGxlJ30pO1xuICAgICAgICB0aGlzLmRvY1JlcG9GaWx0ZXJzLm9uRmlsdGVyQnlUaXRsZSh0aXRsZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZWZyZXNoKCkge1xuICAgICAgICB0aGlzLmRvY1JlcG9GaWx0ZXJzLnJlZnJlc2goKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtIHRoZSBhY3R1YWwgcmVmcmVzaC5cbiAgICAgKi9cbiAgICBwcml2YXRlIGRvUmVmcmVzaChkYXRhOiBSZWFkb25seUFycmF5PFJlcG9Eb2NJbmZvPikge1xuXG4gICAgICAgIGNvbnN0IHRhZ3MgPSB0aGlzLnByb3BzLnJlcG9Eb2NNZXRhTWFuYWdlci5yZXBvRG9jSW5mb0luZGV4LnRvVGFnRGVzY3JpcHRvcnMoKTtcblxuICAgICAgICBjb25zdCBzdGF0ZSA9IHsuLi50aGlzLnN0YXRlLCBkYXRhLCB0YWdzfTtcblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcblxuICAgICAgICAgICAgLy8gVGhlIHJlYWN0IHRhYmxlIHdpbGwgbm90IHVwZGF0ZSB3aGVuIEkgY2hhbmdlIHRoZSBzdGF0ZSBmcm9tXG4gICAgICAgICAgICAvLyB3aXRoaW4gdGhlIGV2ZW50IGxpc3RlbmVyXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlKTtcblxuICAgICAgICB9LCAxKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgb25Ub2dnbGVGbGFnZ2VkT25seSh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLmRvY1JlcG9GaWx0ZXJzLm9uVG9nZ2xlRmxhZ2dlZE9ubHkodmFsdWUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25Ub2dnbGVGaWx0ZXJBcmNoaXZlZCh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLmRvY1JlcG9GaWx0ZXJzLm9uVG9nZ2xlRmlsdGVyQXJjaGl2ZWQodmFsdWUpO1xuICAgIH1cblxufVxuXG5pbnRlcmZhY2UgSVByb3BzIHtcblxuICAgIHJlYWRvbmx5IHBlcnNpc3RlbmNlTGF5ZXJNYW5hZ2VyOiBQZXJzaXN0ZW5jZUxheWVyTWFuYWdlcjtcblxuICAgIHJlYWRvbmx5IHVwZGF0ZWREb2NJbmZvRXZlbnREaXNwYXRjaGVyOiBJRXZlbnREaXNwYXRjaGVyPElEb2NJbmZvPjtcblxuICAgIHJlYWRvbmx5IHJlcG9Eb2NNZXRhTWFuYWdlcjogUmVwb0RvY01ldGFNYW5hZ2VyO1xuXG4gICAgcmVhZG9ubHkgcmVwb0RvY01ldGFMb2FkZXI6IFJlcG9Eb2NNZXRhTG9hZGVyO1xuXG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHJlYWRvbmx5IGRhdGE6IFJlYWRvbmx5QXJyYXk8UmVwb0RvY0luZm8+O1xuICAgIHJlYWRvbmx5IHRhZ3M6IFJlYWRvbmx5QXJyYXk8VGFnRGVzY3JpcHRvcj47XG4gICAgcmVhZG9ubHkgY29sdW1uczogRG9jUmVwb1RhYmxlQ29sdW1ucztcbiAgICByZWFkb25seSBzZWxlY3RlZDogUmVhZG9ubHlBcnJheTxudW1iZXI+O1xuICAgIHJlYWRvbmx5IGRvY1NpZGViYXJWaXNpYmxlOiBib29sZWFuO1xufVxuXG4vKipcbiAqIFRoZSB0eXBlIG9mIGV2ZW50IHRoYXQgdHJpZ2dlcmVkIHRoZSByb3cgc2VsZWN0aW9uLiAgRWl0aGVyIGEgbm9ybWFsIGNsaWNrLCBhIGNvbnRleHQgbWVudSBjbGljayAocmlnaHQgY2xpY2spIG9yXG4gKiBhIGNoZWNrYm94IGZvciBzZWxlY3RpbmcgbXVsdGlwbGUuXG4gKi9cbmV4cG9ydCB0eXBlIFNlbGVjdFJvd1R5cGUgPSAnY2xpY2snIHwgJ2NvbnRleHQnIHwgJ2NoZWNrYm94JztcblxuXG5pbnRlcmZhY2UgVGFibGVJdGVtIHtcbiAgICByZWFkb25seSBfb3JpZ2luYWw6IFJlcG9Eb2NJbmZvO1xufVxuXG5pbnRlcmZhY2UgSVJlc29sdmVkU3RhdGUge1xuICAgIHJlYWRvbmx5IHNvcnRlZERhdGE6IFJlYWRvbmx5QXJyYXk8VGFibGVJdGVtPjtcbiAgICByZWFkb25seSBwYWdlOiBudW1iZXI7XG4gICAgcmVhZG9ubHkgcGFnZVNpemU6IG51bWJlcjtcbn1cbiJdfQ==